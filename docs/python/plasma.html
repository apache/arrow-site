


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Plasma In-Memory Object Store &mdash; Apache Arrow v0.15.1</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NumPy Integration" href="numpy.html" />
    <link rel="prev" title="pyarrow.HdfsFile" href="generated/pyarrow.HdfsFile.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache Arrow
          

          
          </a>

          
            
            
              <div class="version">
                0.15.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../format/Guidelines.html">Implementation Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/Layout.html">Physical Memory Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/IPC.html">IPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/Metadata.html">Format Metadata</a></li>
</ul>
<p class="caption"><span class="caption-text">Arrow Specifications and Protocols</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../format/Versioning.html">Format Versioning and Stability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/Columnar.html">Arrow Columnar Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/Flight.html">Arrow Flight RPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/Integration.html">Integration Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/Other.html">Other Data Structures</a></li>
</ul>
<p class="caption"><span class="caption-text">Arrow Libraries</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../cpp/index.html">C++ Implementation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python bindings</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installing PyArrow</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">Memory and IO Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html">Data Types and In-Memory Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipc.html">Streaming, Serialization, and IPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="filesystems.html">File System Interfaces</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Plasma In-Memory Object Store</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-plasma-api">The Plasma API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#starting-the-plasma-store">Starting the Plasma store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-plasma-client">Creating a Plasma client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#object-ids">Object IDs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#putting-and-getting-python-objects">Putting and Getting Python Objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-an-object-buffer">Creating an Object Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-an-object-buffer">Getting an Object Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listing-objects-in-the-store">Listing objects in the store</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-arrow-and-pandas-with-plasma">Using Arrow and Pandas with Plasma</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#storing-arrow-objects-in-plasma">Storing Arrow Objects in Plasma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-arrow-objects-from-plasma">Getting Arrow Objects from Plasma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#storing-pandas-dataframes-in-plasma">Storing Pandas DataFrames in Plasma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-pandas-dataframes-from-plasma">Getting Pandas DataFrames from Plasma</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-plasma-with-huge-pages">Using Plasma with Huge Pages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="numpy.html">NumPy Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="pandas.html">Pandas Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestamps.html">Timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="csv.html">Reading CSV files</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html">Reading JSON files</a></li>
<li class="toctree-l2"><a class="reference internal" href="parquet.html">Reading and Writing the Apache Parquet Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="cuda.html">CUDA Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending_types.html">Extending pyarrow</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html">Using pyarrow from C++ and Cython Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_involved.html">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Development and Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers/contributing.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/cpp.html">C++ Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/python.html">Python Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/integration.html">Integration Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/crossbow.html">Packaging and Testing with Crossbow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/documentation.html">Building the Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache Arrow</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Python bindings</a> &raquo;</li>
        
      <li>The Plasma In-Memory Object Store</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/python/plasma.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-plasma-in-memory-object-store">
<span id="plasma"></span><h1><a class="toc-backref" href="#id1">The Plasma In-Memory Object Store</a><a class="headerlink" href="#the-plasma-in-memory-object-store" title="Permalink to this headline">Â¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#the-plasma-in-memory-object-store" id="id1">The Plasma In-Memory Object Store</a></p>
<ul>
<li><p><a class="reference internal" href="#the-plasma-api" id="id2">The Plasma API</a></p>
<ul>
<li><p><a class="reference internal" href="#starting-the-plasma-store" id="id3">Starting the Plasma store</a></p></li>
<li><p><a class="reference internal" href="#creating-a-plasma-client" id="id4">Creating a Plasma client</a></p></li>
<li><p><a class="reference internal" href="#object-ids" id="id5">Object IDs</a></p></li>
<li><p><a class="reference internal" href="#putting-and-getting-python-objects" id="id6">Putting and Getting Python Objects</a></p></li>
<li><p><a class="reference internal" href="#creating-an-object-buffer" id="id7">Creating an Object Buffer</a></p></li>
<li><p><a class="reference internal" href="#getting-an-object-buffer" id="id8">Getting an Object Buffer</a></p></li>
<li><p><a class="reference internal" href="#listing-objects-in-the-store" id="id9">Listing objects in the store</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-arrow-and-pandas-with-plasma" id="id10">Using Arrow and Pandas with Plasma</a></p>
<ul>
<li><p><a class="reference internal" href="#storing-arrow-objects-in-plasma" id="id11">Storing Arrow Objects in Plasma</a></p></li>
<li><p><a class="reference internal" href="#getting-arrow-objects-from-plasma" id="id12">Getting Arrow Objects from Plasma</a></p></li>
<li><p><a class="reference internal" href="#storing-pandas-dataframes-in-plasma" id="id13">Storing Pandas DataFrames in Plasma</a></p></li>
<li><p><a class="reference internal" href="#getting-pandas-dataframes-from-plasma" id="id14">Getting Pandas DataFrames from Plasma</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-plasma-with-huge-pages" id="id15">Using Plasma with Huge Pages</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As present, Plasma is only supported for use on Linux and macOS.</p>
</div>
<div class="section" id="the-plasma-api">
<h2><a class="toc-backref" href="#id2">The Plasma API</a><a class="headerlink" href="#the-plasma-api" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="starting-the-plasma-store">
<h3><a class="toc-backref" href="#id3">Starting the Plasma store</a><a class="headerlink" href="#starting-the-plasma-store" title="Permalink to this headline">Â¶</a></h3>
<p>You can start the Plasma store by issuing a terminal command similar to the
following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>plasma_store -m <span class="m">1000000000</span> -s /tmp/plasma
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-m</span></code> flag specifies the size of the store in bytes, and the <code class="docutils literal notranslate"><span class="pre">-s</span></code> flag
specifies the socket that the store will listen at. Thus, the above command
allows the Plasma store to use up to 1GB of memory, and sets the socket to
<code class="docutils literal notranslate"><span class="pre">/tmp/plasma</span></code>.</p>
<p>Leaving the current terminal window open as long as Plasma store should keep
running. Messages, concerning such as disconnecting clients, may occasionally be
printed to the screen. To stop running the Plasma store, you can press
<code class="docutils literal notranslate"><span class="pre">Ctrl-C</span></code> in the terminal.</p>
</div>
<div class="section" id="creating-a-plasma-client">
<h3><a class="toc-backref" href="#id4">Creating a Plasma client</a><a class="headerlink" href="#creating-a-plasma-client" title="Permalink to this headline">Â¶</a></h3>
<p>To start a Plasma client from Python, call <code class="docutils literal notranslate"><span class="pre">plasma.connect</span></code> using the same
socket name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyarrow.plasma</span> <span class="kn">as</span> <span class="nn">plasma</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;/tmp/plasma&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the following error occurs from running the above Python code, that
means that either the socket given is incorrect, or the <code class="docutils literal notranslate"><span class="pre">./plasma_store</span></code> is
not currently running. Check to see if the Plasma store is still running.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="nv">client</span> <span class="o">=</span> plasma.connect<span class="o">(</span><span class="s2">&quot;/tmp/plasma&quot;</span><span class="o">)</span>
Connection to socket failed <span class="k">for</span> pathname /tmp/plasma
Could not connect to socket /tmp/plasma
</pre></div>
</div>
</div>
<div class="section" id="object-ids">
<h3><a class="toc-backref" href="#id5">Object IDs</a><a class="headerlink" href="#object-ids" title="Permalink to this headline">Â¶</a></h3>
<p>Each object in the Plasma store should be associated with a unique ID. The
Object ID then serves as a key that any client can use to retrieve that object
from the Plasma store. You can form an <code class="docutils literal notranslate"><span class="pre">ObjectID</span></code> object from a byte string of
length 20.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an ObjectID.</span>
&gt;&gt;&gt; <span class="nv">id</span> <span class="o">=</span> plasma.ObjectID<span class="o">(</span><span class="m">20</span> * b<span class="s2">&quot;a&quot;</span><span class="o">)</span>

<span class="c1"># The character &quot;a&quot; is encoded as 61 in hex.</span>
&gt;&gt;&gt; id
ObjectID<span class="o">(</span><span class="m">6161616161616161616161616161616161616161</span><span class="o">)</span>
</pre></div>
</div>
<p>The random generation of Object IDs is often good enough to ensure unique IDs.
You can easily create a helper function that randomly generates object IDs as
follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">random_object_id</span><span class="p">():</span>
  <span class="k">return</span> <span class="n">plasma</span><span class="o">.</span><span class="n">ObjectID</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="putting-and-getting-python-objects">
<h3><a class="toc-backref" href="#id6">Putting and Getting Python Objects</a><a class="headerlink" href="#putting-and-getting-python-objects" title="Permalink to this headline">Â¶</a></h3>
<p>Plasma supports two APIs for creating and accessing objects: A high level
API that allows storing and retrieving Python objects and a low level
API that allows creating, writing and sealing buffers and operating on
the binary data directly. In this section we describe the high level API.</p>
<p>This is how you can put and get a Python object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a python object.</span>
<span class="n">object_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;hello, world&quot;</span><span class="p">)</span>

<span class="c1"># Get the object.</span>
<span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">object_id</span><span class="p">)</span>
</pre></div>
</div>
<p>This works with all Python objects supported by the Arrow Python object
serialization.</p>
<p>You can also get multiple objects at the same time (which can be more
efficient since it avoids IPC round trips):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create multiple python objects.</span>
<span class="n">object_id1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">object_id2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">object_id3</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Get the objects.</span>
<span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">object_id1</span><span class="p">,</span> <span class="n">object_id2</span><span class="p">,</span> <span class="n">object_id3</span><span class="p">])</span>
</pre></div>
</div>
<p>Furthermore, it is possible to provide a timeout for the get call. If the
object is not available within the timeout, the special object
<cite>pyarrow.ObjectNotAvailable</cite> will be returned.</p>
</div>
<div class="section" id="creating-an-object-buffer">
<h3><a class="toc-backref" href="#id7">Creating an Object Buffer</a><a class="headerlink" href="#creating-an-object-buffer" title="Permalink to this headline">Â¶</a></h3>
<p>Objects are created in Plasma in two stages. First, they are <strong>created</strong>, which
allocates a buffer for the object. At this point, the client can write to the
buffer and construct the object within the allocated buffer.</p>
<p>To create an object for Plasma, you need to create an object ID, as well as
give the objectâs maximum size in bytes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an object buffer.</span>
<span class="n">object_id</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">ObjectID</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="sa">b</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">object_size</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">object_size</span><span class="p">))</span>

<span class="c1"># Write to the buffer.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
  <span class="nb">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">128</span>
</pre></div>
</div>
<p>When the client is done, the client <strong>seals</strong> the buffer, making the object
immutable, and making it available to other Plasma clients.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seal the object. This makes the object immutable and available to other clients.</span>
<span class="n">client</span><span class="o">.</span><span class="n">seal</span><span class="p">(</span><span class="n">object_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-an-object-buffer">
<h3><a class="toc-backref" href="#id8">Getting an Object Buffer</a><a class="headerlink" href="#getting-an-object-buffer" title="Permalink to this headline">Â¶</a></h3>
<p>After an object has been sealed, any client who knows the object ID can get
the object buffer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a different client. Note that this second client could be</span>
<span class="c1"># created in the same or in a separate, concurrent Python session.</span>
<span class="n">client2</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;/tmp/plasma&quot;</span><span class="p">)</span>

<span class="c1"># Get the object in the second client. This blocks until the object has been sealed.</span>
<span class="n">object_id2</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">ObjectID</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="sa">b</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="n">buffer2</span><span class="p">]</span> <span class="o">=</span> <span class="n">client2</span><span class="o">.</span><span class="n">get_buffers</span><span class="p">([</span><span class="n">object_id</span><span class="p">])</span>
</pre></div>
</div>
<p>If the object has not been sealed yet, then the call to client.get_buffers will
block until the object has been sealed by the client constructing the object.
Using the <code class="docutils literal notranslate"><span class="pre">timeout_ms</span></code> argument to get, you can specify a timeout for this (in
milliseconds). After the timeout, the interpreter will yield control back.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; buffer
&lt;memory at 0x7fdbdc96e708&gt;
&gt;&gt;&gt; buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span>
<span class="m">1</span>
&gt;&gt;&gt; buffer2
&lt;plasma.plasma.PlasmaBuffer object at 0x7fdbf2770e88&gt;
&gt;&gt;&gt; <span class="nv">view2</span> <span class="o">=</span> memoryview<span class="o">(</span>buffer2<span class="o">)</span>
&gt;&gt;&gt; view2<span class="o">[</span><span class="m">1</span><span class="o">]</span>
<span class="m">1</span>
&gt;&gt;&gt; view2<span class="o">[</span><span class="m">129</span><span class="o">]</span>
<span class="m">1</span>
&gt;&gt;&gt; bytes<span class="o">(</span>buffer<span class="o">[</span><span class="m">1</span>:4<span class="o">])</span>
b<span class="s1">&#39;\x01\x02\x03&#39;</span>
&gt;&gt;&gt; bytes<span class="o">(</span>view2<span class="o">[</span><span class="m">1</span>:4<span class="o">])</span>
b<span class="s1">&#39;\x01\x02\x03&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-objects-in-the-store">
<h3><a class="toc-backref" href="#id9">Listing objects in the store</a><a class="headerlink" href="#listing-objects-in-the-store" title="Permalink to this headline">Â¶</a></h3>
<p>The objects in the store can be listed in the following way (note that
this functionality is currently experimental and the concrete representation
of the object info might change in the future):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyarrow.plasma</span> <span class="kn">as</span> <span class="nn">plasma</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;/tmp/plasma&quot;</span><span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;hello, world&quot;</span><span class="p">)</span>
<span class="c1"># Sleep a little so we get different creation times</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;another object&quot;</span><span class="p">)</span>
<span class="c1"># Create an object that is not sealed yet</span>
<span class="n">object_id</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">ObjectID</span><span class="o">.</span><span class="n">from_random</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>

<span class="o">&gt;&gt;&gt;</span> <span class="p">{</span><span class="n">ObjectID</span><span class="p">(</span><span class="mi">4</span><span class="n">cba8f80c54c6d265b46c2cdfcee6e32348b12be</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;construct_duration&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;create_time&#39;</span><span class="p">:</span> <span class="mi">1535223642</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;data_size&#39;</span><span class="p">:</span> <span class="mi">460</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;metadata_size&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;ref_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;sealed&#39;</span><span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ObjectID</span><span class="p">(</span><span class="n">a7598230b0c26464c9d9c99ae14773ee81485428</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;construct_duration&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;create_time&#39;</span><span class="p">:</span> <span class="mi">1535223644</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;data_size&#39;</span><span class="p">:</span> <span class="mi">460</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;metadata_size&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;ref_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;sealed&#39;</span><span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ObjectID</span><span class="p">(</span><span class="n">e603ab0c92098ebf08f90bfcea33ff98f6476870</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;construct_duration&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;create_time&#39;</span><span class="p">:</span> <span class="mi">1535223644</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;data_size&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;metadata_size&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;ref_count&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-arrow-and-pandas-with-plasma">
<h2><a class="toc-backref" href="#id10">Using Arrow and Pandas with Plasma</a><a class="headerlink" href="#using-arrow-and-pandas-with-plasma" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="storing-arrow-objects-in-plasma">
<h3><a class="toc-backref" href="#id11">Storing Arrow Objects in Plasma</a><a class="headerlink" href="#storing-arrow-objects-in-plasma" title="Permalink to this headline">Â¶</a></h3>
<p>To store an Arrow object in Plasma, we must first <strong>create</strong> the object and then
<strong>seal</strong> it. However, Arrow objects such as <code class="docutils literal notranslate"><span class="pre">Tensors</span></code> may be more complicated
to write than simple binary data.</p>
<p>To create the object in Plasma, you still need an <code class="docutils literal notranslate"><span class="pre">ObjectID</span></code> and a size to
pass in. To find out the size of your Arrow object, you can use pyarrow
API such as <code class="docutils literal notranslate"><span class="pre">pyarrow.get_tensor_size</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyarrow</span> <span class="kn">as</span> <span class="nn">pa</span>

<span class="c1"># Create a pyarrow.Tensor object from a numpy random 2-dimensional array</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">tensor</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Create the object in Plasma</span>
<span class="n">object_id</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">ObjectID</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="n">data_size</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">get_tensor_size</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">data_size</span><span class="p">)</span>
</pre></div>
</div>
<p>To write the Arrow <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> object into the buffer, you can use Plasma to
convert the <code class="docutils literal notranslate"><span class="pre">memoryview</span></code> buffer into a <code class="docutils literal notranslate"><span class="pre">pyarrow.FixedSizeBufferWriter</span></code>
object. A <code class="docutils literal notranslate"><span class="pre">pyarrow.FixedSizeBufferWriter</span></code> is a format suitable for Arrowâs
<code class="docutils literal notranslate"><span class="pre">pyarrow.write_tensor</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write the tensor into the Plasma-allocated buffer</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedSizeBufferWriter</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">pa</span><span class="o">.</span><span class="n">write_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>  <span class="c1"># Writes tensor&#39;s 552 bytes to Plasma stream</span>
</pre></div>
</div>
<p>To finish storing the Arrow object in Plasma, call <code class="docutils literal notranslate"><span class="pre">seal</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seal the Plasma object</span>
<span class="n">client</span><span class="o">.</span><span class="n">seal</span><span class="p">(</span><span class="n">object_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-arrow-objects-from-plasma">
<h3><a class="toc-backref" href="#id12">Getting Arrow Objects from Plasma</a><a class="headerlink" href="#getting-arrow-objects-from-plasma" title="Permalink to this headline">Â¶</a></h3>
<p>To read the object, first retrieve it as a <code class="docutils literal notranslate"><span class="pre">PlasmaBuffer</span></code> using its object ID.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the arrow object by ObjectID.</span>
<span class="p">[</span><span class="n">buf2</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_buffers</span><span class="p">([</span><span class="n">object_id</span><span class="p">])</span>
</pre></div>
</div>
<p>To convert the <code class="docutils literal notranslate"><span class="pre">PlasmaBuffer</span></code> back into an Arrow <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, first create a
pyarrow <code class="docutils literal notranslate"><span class="pre">BufferReader</span></code> object from it. You can then pass the <code class="docutils literal notranslate"><span class="pre">BufferReader</span></code>
into <code class="docutils literal notranslate"><span class="pre">pyarrow.read_tensor</span></code> to reconstruct the Arrow <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reconstruct the Arrow tensor object.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">BufferReader</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span>
<span class="n">tensor2</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">read_tensor</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can use <code class="docutils literal notranslate"><span class="pre">pyarrow.read_tensor</span></code> to convert the Arrow object
back into numpy data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert back to numpy</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">tensor2</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="storing-pandas-dataframes-in-plasma">
<h3><a class="toc-backref" href="#id13">Storing Pandas DataFrames in Plasma</a><a class="headerlink" href="#storing-pandas-dataframes-in-plasma" title="Permalink to this headline">Â¶</a></h3>
<p>Storing a Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> still follows the <strong>create</strong> then <strong>seal</strong>
process of storing an object in the Plasma store, however one cannot directly
write the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to Plasma with Pandas alone. Plasma also needs to know
the size of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to allocate a buffer for.</p>
<p>See <a class="reference internal" href="pandas.html#pandas-interop"><span class="std std-ref">Pandas Integration</span></a> for more information on using Arrow with Pandas.</p>
<p>You can create the pyarrow equivalent of a Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by using
<code class="docutils literal notranslate"><span class="pre">pyarrow.from_pandas</span></code> to convert it to a <code class="docutils literal notranslate"><span class="pre">RecordBatch</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyarrow</span> <span class="kn">as</span> <span class="nn">pa</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="c1"># Create a Pandas DataFrame</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;one&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]),</span>
     <span class="s1">&#39;two&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="c1"># Convert the Pandas DataFrame into a PyArrow RecordBatch</span>
<span class="n">record_batch</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatch</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<p>Creating the Plasma object requires an <code class="docutils literal notranslate"><span class="pre">ObjectID</span></code> and the size of the
data. Now that we have converted the Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> into a PyArrow
<code class="docutils literal notranslate"><span class="pre">RecordBatch</span></code>, use the <code class="docutils literal notranslate"><span class="pre">MockOutputStream</span></code> to determine the
size of the Plasma object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the Plasma object from the PyArrow RecordBatch. Most of the work here</span>
<span class="c1"># is done to determine the size of buffer to request from the object store.</span>
<span class="n">object_id</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">ObjectID</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="n">mock_sink</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MockOutputStream</span><span class="p">()</span>
<span class="n">stream_writer</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchStreamWriter</span><span class="p">(</span><span class="n">mock_sink</span><span class="p">,</span> <span class="n">record_batch</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
<span class="n">stream_writer</span><span class="o">.</span><span class="n">write_batch</span><span class="p">(</span><span class="n">record_batch</span><span class="p">)</span>
<span class="n">stream_writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">data_size</span> <span class="o">=</span> <span class="n">mock_sink</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">data_size</span><span class="p">)</span>
</pre></div>
</div>
<p>The DataFrame can now be written to the buffer as follows.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write the PyArrow RecordBatch to Plasma</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedSizeBufferWriter</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">stream_writer</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchStreamWriter</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">record_batch</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
<span class="n">stream_writer</span><span class="o">.</span><span class="n">write_batch</span><span class="p">(</span><span class="n">record_batch</span><span class="p">)</span>
<span class="n">stream_writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, seal the finished object for use by all clients:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seal the Plasma object</span>
<span class="n">client</span><span class="o">.</span><span class="n">seal</span><span class="p">(</span><span class="n">object_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-pandas-dataframes-from-plasma">
<h3><a class="toc-backref" href="#id14">Getting Pandas DataFrames from Plasma</a><a class="headerlink" href="#getting-pandas-dataframes-from-plasma" title="Permalink to this headline">Â¶</a></h3>
<p>Since we store the Pandas DataFrame as a PyArrow <code class="docutils literal notranslate"><span class="pre">RecordBatch</span></code> object,
to get the object back from the Plasma store, we follow similar steps
to those specified in <a class="reference internal" href="#getting-arrow-objects-from-plasma">Getting Arrow Objects from Plasma</a>.</p>
<p>We first have to convert the <code class="docutils literal notranslate"><span class="pre">PlasmaBuffer</span></code> returned from
<code class="docutils literal notranslate"><span class="pre">client.get_buffers</span></code> into an Arrow <code class="docutils literal notranslate"><span class="pre">BufferReader</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch the Plasma object</span>
<span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_buffers</span><span class="p">([</span><span class="n">object_id</span><span class="p">])</span>  <span class="c1"># Get PlasmaBuffer from ObjectID</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">BufferReader</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>From the <code class="docutils literal notranslate"><span class="pre">BufferReader</span></code>, we can create a specific <code class="docutils literal notranslate"><span class="pre">RecordBatchStreamReader</span></code>
in Arrow to reconstruct the stored PyArrow <code class="docutils literal notranslate"><span class="pre">RecordBatch</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert object back into an Arrow RecordBatch</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchStreamReader</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span>
<span class="n">record_batch</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_next_batch</span><span class="p">()</span>
</pre></div>
</div>
<p>The last step is to convert the PyArrow <code class="docutils literal notranslate"><span class="pre">RecordBatch</span></code> object back into
the original Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> structure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert back into Pandas</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">record_batch</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-plasma-with-huge-pages">
<h2><a class="toc-backref" href="#id15">Using Plasma with Huge Pages</a><a class="headerlink" href="#using-plasma-with-huge-pages" title="Permalink to this headline">Â¶</a></h2>
<p>On Linux it is possible to use the Plasma store with huge pages for increased
throughput. You first need to create a file system and activate huge pages with</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /mnt/hugepages
<span class="nv">gid</span><span class="o">=</span><span class="sb">`</span>id -g<span class="sb">`</span>
<span class="nv">uid</span><span class="o">=</span><span class="sb">`</span>id -u<span class="sb">`</span>
sudo mount -t hugetlbfs -o <span class="nv">uid</span><span class="o">=</span><span class="nv">$uid</span> -o <span class="nv">gid</span><span class="o">=</span><span class="nv">$gid</span> none /mnt/hugepages
sudo bash -c <span class="s2">&quot;echo </span><span class="nv">$gid</span><span class="s2"> &gt; /proc/sys/vm/hugetlb_shm_group&quot;</span>
sudo bash -c <span class="s2">&quot;echo 20000 &gt; /proc/sys/vm/nr_hugepages&quot;</span>
</pre></div>
</div>
<p>Note that you only need root access to create the file system, not for
running the object store. You can then start the Plasma store with the <code class="docutils literal notranslate"><span class="pre">-d</span></code>
flag for the mount point of the huge page file system and the <code class="docutils literal notranslate"><span class="pre">-h</span></code> flag
which indicates that huge pages are activated:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>plasma_store -s /tmp/plasma -m <span class="m">10000000000</span> -d /mnt/hugepages -h
</pre></div>
</div>
<p>You can test this with the following script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyarrow</span> <span class="kn">as</span> <span class="nn">pa</span>
<span class="kn">import</span> <span class="nn">pyarrow.plasma</span> <span class="kn">as</span> <span class="nn">plasma</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;/tmp/plasma&quot;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span>
<span class="n">tensor</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">object_id</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">ObjectID</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">get_tensor_size</span><span class="p">(</span><span class="n">tensor</span><span class="p">))</span>

<span class="n">stream</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedSizeBufferWriter</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">set_memcopy_threads</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">pa</span><span class="o">.</span><span class="n">write_tensor</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Writing took &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="numpy.html" class="btn btn-neutral float-right" title="NumPy Integration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generated/pyarrow.HdfsFile.html" class="btn btn-neutral float-left" title="pyarrow.HdfsFile" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019 Apache Software Foundation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107500873-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107500873-1');
</script>


</body>
</html>