<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arrow R Developer Guide • Arrow R Package</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Arrow R Developer Guide">
<meta property="og:description" content="arrow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107500873-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107500873-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Arrow R Package</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://arrow.apache.org/">❯❯❯</a>
</li>
<li>
  <a href="../articles/arrow.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/install.html">Installing the Arrow Package on Linux</a>
    </li>
    <li>
      <a href="../articles/dataset.html">Working with Arrow Datasets and dplyr</a>
    </li>
    <li>
      <a href="../articles/fs.html">Working with Cloud Storage (S3)</a>
    </li>
    <li>
      <a href="../articles/python.html">Apache Arrow in Python and R with reticulate</a>
    </li>
    <li>
      <a href="../articles/flight.html">Connecting to Flight RPC Servers</a>
    </li>
    <li>
      <a href="../articles/developing.html">Arrow R Developer Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Project docs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://arrow.apache.org/docs/format/README.html">Specification</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/c_glib">C GLib</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/cpp">C++</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/java">Java</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/js">JavaScript</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/python">Python</a>
    </li>
    <li>
      <a href="../index.html">R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="developing_files/header-attrs-2.7/header-attrs.js"></script><script src="developing_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Arrow R Developer Guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apache/arrow/blob/master/r/vignettes/developing.Rmd"><code>vignettes/developing.Rmd</code></a></small>
      <div class="hidden name"><code>developing.Rmd</code></div>

    </div>

    
    
<p>If you’re looking to contribute to <code>arrow</code>, this document can help you set up a development environment that will enable you to write code and run tests locally. It outlines how to build the various components that make up the Arrow project and R package, as well as some common troubleshooting and workflows developers use. Many contributions can be accomplished with the instructions in <a href="#r-only-development">R-only development</a>. But if you’re working on both the C++ library and the R package, the <a href="#-developer-environment-setup">Developer environment setup</a> section will guide you through setting up a developer environment.</p>
<p>This document is intended only for developers of Apache Arrow or the Arrow R package. Users of the package in R do not need to do any of this setup. If you’re looking for how to install Arrow, see <a href="https://arrow.apache.org/docs/r/#installation">the instructions in the readme</a>; Linux users can find more details on building from source at <code><a href="../articles/install.html">vignette("install", package = "arrow")</a></code>.</p>
<p>This document is a work in progress and will grow + change as the Apache Arrow project grows and changes. We have tried to make these steps as robust as possible (in fact, we even test exactly these instructions on our nightly CI to ensure they don’t become stale!), but certain custom configurations might conflict with these instructions and there are differences of opinion across developers about if and what the one true way to set up development environments like this is. We also solicit any feedback you have about things that are confusing or additions you would like to see here. Please <a href="https://issues.apache.org/jira/projects/ARROW/issues">report an issue</a> if there you see anything that is confusing, odd, or just plain wrong.</p>
<div id="r-only-development" class="section level2">
<h2 class="hasAnchor">
<a href="#r-only-development" class="anchor"></a>R-only development</h2>
<p>Windows and macOS users who wish to contribute to the R package and don’t need to alter the Arrow C++ library may be able to obtain a recent version of the library without building from source. On macOS, you may install the C++ library using <a href="https://brew.sh/">Homebrew</a>:</p>
<pre class="shell"><code># For the released version:
brew install apache-arrow
# Or for a development version, you can try:
brew install apache-arrow --HEAD</code></pre>
<p>On Windows and Linux, you can download a .zip file with the arrow dependencies from the nightly repository. Windows users then can set the <code>RWINLIB_LOCAL</code> environment variable to point to that zip file before installing the <code>arrow</code> R package. On Linux, you’ll need to create a <code>libarrow</code> directory inside the R package directory and unzip that file into it. Version numbers in that repository correspond to dates, and you will likely want the most recent.</p>
<p>To see what nightlies are available, you can use Arrow’s (or any other S3 client’s) S3 listing functionality to see what is in the bucket <code>s3://arrow-r-nightly/libarrow/bin</code>:</p>
<pre><code>nightly &lt;- s3_bucket("arrow-r-nightly")
nightly$ls("libarrow/bin")</code></pre>
</div>
<div id="developer-environment-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#developer-environment-setup" class="anchor"></a>Developer environment setup</h2>
<p>If you need to alter both the Arrow C++ library and the R package code, or if you can’t get a binary version of the latest C++ library elsewhere, you’ll need to build it from source too. This section discusses how to set up a C++ build configured to work with the R package. For more general resources, see the <a href="https://arrow.apache.org/docs/developers/cpp/building.html">Arrow C++ developer guide</a>.</p>
<p>There are four major steps to the process — the first three are relevant to all Arrow developers, and the last one is specific to the R bindings:</p>
<ol style="list-style-type: decimal">
<li>Configuring the Arrow library build (using <code>cmake</code>) — this specifies how you want the build to go, what features to include, etc.</li>
<li>Building the Arrow library — this actually compiles the Arrow library</li>
<li>Install the Arrow library — this organizes and moves the compiled Arrow library files into the location specified in the configuration</li>
<li>Building the R package — this builds the C++ code in the R package, and installs the R package for you</li>
</ol>
<div id="install-dependencies" class="section level3 tabset">
<h3 class="hasAnchor">
<a href="#install-dependencies" class="anchor"></a>Install dependencies</h3>
<p>The Arrow C++ library will by default use system dependencies if suitable versions are found; if they are not present, it will build them during its own build process. The only dependencies that one needs to install outside of the build process are <code>cmake</code> (for configuring the build) and <code>openssl</code> if you are building with S3 support.</p>
<p>For a faster build, you may choose to install on the system more C++ library dependencies (such as <code>lz4</code>, <code>zstd</code>, etc.) so that they don’t need to be built from source in the Arrow build. This is optional.</p>
<div id="macos" class="section level4">
<h4 class="hasAnchor">
<a href="#macos" class="anchor"></a>macOS</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="ex">brew</span> install cmake openssl</span></code></pre></div>
</div>
<div id="ubuntu" class="section level4">
<h4 class="hasAnchor">
<a href="#ubuntu" class="anchor"></a>Ubuntu</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="fu">sudo</span> apt install -y cmake libcurl4-openssl-dev libssl-dev</span></code></pre></div>
</div>
</div>
<div id="configure-the-arrow-build" class="section level3 tabset">
<h3 class="hasAnchor">
<a href="#configure-the-arrow-build" class="anchor"></a>Configure the Arrow build</h3>
<p>You can choose to build and then install the Arrow library into a user-defined directory or into a system-level directory. You only need to do one of these two options.</p>
<p>It is recommended that you install the arrow library to a user-level directory to be used in development. This is so that the development version you are using doesn’t overwrite a released version of Arrow you may have installed. You are also able to have more than one version of the Arrow library to link to with this approach (by using different <code>ARROW_HOME</code> directories for the different versions). This approach also matches the recommendations for other Arrow bindings like <a href="http://arrow.apache.org/docs/developers/python.html">Python</a>.</p>
<div id="configure-for-installing-to-a-user-directory" class="section level4">
<h4 class="hasAnchor">
<a href="#configure-for-installing-to-a-user-directory" class="anchor"></a>Configure for installing to a user directory</h4>
<p>In this example we will install it to a directory called <code>dist</code> that has the same parent as our <code>arrow</code> checkout, but it could be named or located anywhere you would like. However, note that your installation of the Arrow R package will point to this directory and need it to remain intact for the package to continue to work. This is one reason we recommend <em>not</em> placing it inside of the arrow git checkout.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="bu">export</span> <span class="va">ARROW_HOME=$(</span><span class="bu">pwd</span><span class="va">)</span>/dist</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="fu">mkdir</span> <span class="va">$ARROW_HOME</span></span></code></pre></div>
<p><em>Special instructions on Linux:</em> You will need to set <code>LD_LIBRARY_PATH</code> to the <code>lib</code> directory that will is under where we set <code>$ARROW_HOME</code>, before launching R and using Arrow. One way to do this is to add it to your profile (we use <code>~/.bash_profile</code> here, but you might need to put this in a different file depending on your setup, e.g. if you use a shell other than <code>bash</code>). On macOS we do not need to do this because the macOS shared library paths are hardcoded to their locations during build time.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="bu">export</span> <span class="va">LD_LIBRARY_PATH=$ARROW_HOME</span>/lib:<span class="va">$LD_LIBRARY_PATH</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="bu">echo</span> <span class="st">"export LD_LIBRARY_PATH=</span><span class="va">$ARROW_HOME</span><span class="st">/lib:</span><span class="va">$LD_LIBRARY_PATH</span><span class="st">"</span> <span class="op">&gt;&gt;</span> ~/.bash_profile</span></code></pre></div>
<p>Now we can move into the arrow repository to start the build process. You will need to create a directory into which the C++ build will put its contents. It is recommended to make a <code>build</code> directory inside of the <code>cpp</code> directory of the Arrow git repository (it is git-ignored, so you won’t accidentally check it in). And then, change directories to be inside <code>cpp/build</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="bu">pushd</span> arrow</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="fu">mkdir</span> -p cpp/build</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="bu">pushd</span> cpp/build</span></code></pre></div>
<p>You’ll first call <code>cmake</code> to configure the build and then <code>make install</code>. For the R package, you’ll need to enable several features in the C++ library using <code>-D</code> flags:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="fu">cmake</span> <span class="kw">\</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>  <span class="ex">-DCMAKE_INSTALL_PREFIX</span>=<span class="va">$ARROW_HOME</span> <span class="kw">\</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>  <span class="ex">-DCMAKE_INSTALL_LIBDIR</span>=lib <span class="kw">\</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>  <span class="ex">-DARROW_COMPUTE</span>=ON <span class="kw">\</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>  <span class="ex">-DARROW_CSV</span>=ON <span class="kw">\</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>  <span class="ex">-DARROW_DATASET</span>=ON <span class="kw">\</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>  <span class="ex">-DARROW_FILESYSTEM</span>=ON <span class="kw">\</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>  <span class="ex">-DARROW_JEMALLOC</span>=ON <span class="kw">\</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>  <span class="ex">-DARROW_JSON</span>=ON <span class="kw">\</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>  <span class="ex">-DARROW_PARQUET</span>=ON <span class="kw">\</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>  <span class="ex">-DARROW_WITH_SNAPPY</span>=ON <span class="kw">\</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>  <span class="ex">-DARROW_WITH_ZLIB</span>=ON <span class="kw">\</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>  <span class="ex">-DARROW_INSTALL_NAME_RPATH</span>=OFF <span class="kw">\</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>  <span class="ex">-DARROW_EXTRA_ERROR_CONTEXT</span>=ON <span class="kw">\</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>  <span class="ex">..</span></span></code></pre></div>
<p><code>..</code> refers to the C++ source directory: we’re in <code>cpp/build</code>, and the source is in <code>cpp</code>.</p>
</div>
<div id="configure-to-install-to-a-system-directory" class="section level4">
<h4 class="hasAnchor">
<a href="#configure-to-install-to-a-system-directory" class="anchor"></a>Configure to install to a system directory</h4>
<p>If you would like to install Arrow as a system library you can do that as well. This is in some respects simpler, but if you already have Arrow libraries installed there, it would disrupt them and possibly require <code>sudo</code> permissions.</p>
<p>Now we can move into the arrow repository to start the build process. You will need to create a directory into which the C++ build will put its contents. It is recommended to make a <code>build</code> directory inside of the <code>cpp</code> directory of the Arrow git repository (it is git-ignored, so you won’t accidentally check it in). And then, change directories to be inside <code>cpp/build</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="bu">pushd</span> arrow</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="fu">mkdir</span> -p cpp/build</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="bu">pushd</span> cpp/build</span></code></pre></div>
<p>You’ll first call <code>cmake</code> to configure the build and then <code>make install</code>. For the R package, you’ll need to enable several features in the C++ library using <code>-D</code> flags:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="fu">cmake</span> <span class="kw">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>  <span class="ex">-DARROW_COMPUTE</span>=ON <span class="kw">\</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>  <span class="ex">-DARROW_CSV</span>=ON <span class="kw">\</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>  <span class="ex">-DARROW_DATASET</span>=ON <span class="kw">\</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>  <span class="ex">-DARROW_FILESYSTEM</span>=ON <span class="kw">\</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>  <span class="ex">-DARROW_JEMALLOC</span>=ON <span class="kw">\</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>  <span class="ex">-DARROW_JSON</span>=ON <span class="kw">\</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>  <span class="ex">-DARROW_PARQUET</span>=ON <span class="kw">\</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>  <span class="ex">-DARROW_WITH_SNAPPY</span>=ON <span class="kw">\</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>  <span class="ex">-DARROW_WITH_ZLIB</span>=ON <span class="kw">\</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>  <span class="ex">-DARROW_INSTALL_NAME_RPATH</span>=OFF <span class="kw">\</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>  <span class="ex">-DARROW_EXTRA_ERROR_CONTEXT</span>=ON <span class="kw">\</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>  <span class="ex">..</span></span></code></pre></div>
<p><code>..</code> refers to the C++ source directory: we’re in <code>cpp/build</code>, and the source is in <code>cpp</code>.</p>
</div>
</div>
<div id="more-arrow-features" class="section level3">
<h3 class="hasAnchor">
<a href="#more-arrow-features" class="anchor"></a>More Arrow features</h3>
<p>To enable optional features including: S3 support, an alternative memory allocator, and additional compression libraries, add some or all of these flags (the trailing <code>\</code> makes them easier to paste into a bash shell on a new line):</p>
<pre class="shell"><code>  -DARROW_MIMALLOC=ON \
  -DARROW_WITH_BROTLI=ON \
  -DARROW_WITH_BZ2=ON \
  -DARROW_WITH_LZ4=ON \
  -DARROW_WITH_SNAPPY=ON \
  -DARROW_WITH_ZSTD=ON \</code></pre>
<p>Other flags that may be useful:</p>
<ul>
<li>
<code>-DBoost_SOURCE=BUNDLED</code> and <code>-DThrift_SOURCE=bundled</code>, for example, or any other dependency <code>*_SOURCE</code>, if you have a system version of a C++ dependency that doesn’t work correctly with Arrow. This tells the build to compile its own version of the dependency from source.</li>
<li>
<code>-DCMAKE_BUILD_TYPE=debug</code> or <code>-DCMAKE_BUILD_TYPE=relwithdebinfo</code> can be useful for debugging. You probably don’t want to do this generally because a debug build is much slower at runtime than the default <code>release</code> build.</li>
</ul>
<p><em>Note</em> <code>cmake</code> is particularly sensitive to whitespacing, if you see errors, check that you don’t have any errant whitespace around</p>
</div>
<div id="build-arrow" class="section level3">
<h3 class="hasAnchor">
<a href="#build-arrow" class="anchor"></a>Build Arrow</h3>
<p>You can add <code>-j#</code> between <code>make</code> and <code>install</code> here too to speed up compilation by running in parallel (where <code>#</code> is the number of cores you have available).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="fu">make</span> -j8 install</span></code></pre></div>
<p>If you are installing on linux, and you are installing to the system, you may need to use <code>sudo</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="fu">sudo</span> make install</span></code></pre></div>
</div>
<div id="build-the-arrow-r-package" class="section level3">
<h3 class="hasAnchor">
<a href="#build-the-arrow-r-package" class="anchor"></a>Build the Arrow R package</h3>
<p>Once you’ve built the C++ library, you can install the R package and its dependencies, along with additional dev dependencies, from the git checkout:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="bu">popd</span> <span class="co"># To go back to the root directory of the project, from cpp/build</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a><span class="bu">pushd</span> r</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="ex">R</span> -e <span class="st">'install.packages("remotes"); remotes::install_deps(dependencies = TRUE)'</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a><span class="ex">R</span> CMD INSTALL .</span></code></pre></div>
</div>
<div id="compilation-flags" class="section level3">
<h3 class="hasAnchor">
<a href="#compilation-flags" class="anchor"></a>Compilation flags</h3>
<p>If you need to set any compilation flags while building the C++ extensions, you can use the <code>ARROW_R_CXXFLAGS</code> environment variable. For example, if you are using <code>perf</code> to profile the R extensions, you may need to set</p>
<pre class="shell"><code>export ARROW_R_CXXFLAGS=-fno-omit-frame-pointer</code></pre>
</div>
<div id="developer-experience" class="section level3">
<h3 class="hasAnchor">
<a href="#developer-experience" class="anchor"></a>Developer Experience</h3>
<p>With the setups described here, you should not need to rebuild the Arrow library or even the C++ source in the R package as you iterated and work on the R package. The only time those should need to be rebuilt is if you have changed the C++ in the R package (and even then, <code>R CMD INSTALL .</code> should only need to recompile the files that have changed) <em>or</em> if the Arrow library C++ has changed and there is a mismatch between the Arrow Library and the R package. If you find yourself rebuilding either or both each time you install the package or run tests, something is probably wrong with your set up.</p>
<details><summary>For a full build: a <code>cmake</code> command with all of the R-relevant optional dependencies turned on</summary><p>
</p>
<pre class="shell"><code>cmake \
  -DCMAKE_INSTALL_PREFIX=$ARROW_HOME \
  -DCMAKE_INSTALL_LIBDIR=lib \
  -DARROW_COMPUTE=ON \
  -DARROW_CSV=ON \
  -DARROW_DATASET=ON \
  -DARROW_FILESYSTEM=ON \
  -DARROW_JEMALLOC=ON \
  -DARROW_JSON=ON \
  -DARROW_PARQUET=ON \
  -DARROW_WITH_SNAPPY=ON \
  -DARROW_WITH_ZLIB=ON \
  -DARROW_INSTALL_NAME_RPATH=OFF \
  -DARROW_EXTRA_ERROR_CONTEXT=ON \
  -DARROW_MIMALLOC=ON \
  -DARROW_WITH_BROTLI=ON \
  -DARROW_WITH_BZ2=ON \
  -DARROW_WITH_LZ4=ON \
  -DARROW_WITH_SNAPPY=ON \
  -DARROW_WITH_ZSTD=ON \
  ..</code></pre>

</details>
</div>
</div>
<div id="troublshooting" class="section level2">
<h2 class="hasAnchor">
<a href="#troublshooting" class="anchor"></a>Troublshooting</h2>
<p>Note that after any change to the C++ library, you must reinstall it and run <code>make clean</code> or <code>git clean -fdx .</code> to remove any cached object code in the <code>r/src/</code> directory before reinstalling the R package. This is only necessary if you make changes to the C++ library source; you do not need to manually purge object files if you are only editing R or C++ code inside <code>r/</code>.</p>
<div id="arrow-library-r-package-mismatches" class="section level3">
<h3 class="hasAnchor">
<a href="#arrow-library-r-package-mismatches" class="anchor"></a>Arrow library-R package mismatches</h3>
<p>If the Arrow library and the R package have diverged, you will see errors like:</p>
<pre><code>Error: package or namespace load failed for ‘arrow’ in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-r/00new/arrow/libs/arrow.so':
  dlopen(/Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-r/00new/arrow/libs/arrow.so, 6): Symbol not found: __ZN5arrow2io16RandomAccessFile9ReadAsyncERKNS0_9IOContextExx
  Referenced from: /Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-r/00new/arrow/libs/arrow.so
  Expected in: flat namespace
 in /Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-r/00new/arrow/libs/arrow.so
Error: loading failed
Execution halted
ERROR: loading failed</code></pre>
<p>To resolve this, try rebuilding the Arrow library from <a href="#building-arrow">Building Arrow above</a>.</p>
</div>
<div id="multiple-versions-of-arrow-library" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-versions-of-arrow-library" class="anchor"></a>Multiple versions of Arrow library</h3>
<p>If rebuilding the Arrow library doesn’t work and you are <a href="#installing-to-another-directory">installing from a user-level directory</a> and you already have a previous installation of libarrow in a system directory or you get you may get errors like the following when you install the R package:</p>
<pre><code>Error: package or namespace load failed for ‘arrow’ in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-r/00new/arrow/libs/arrow.so':
  dlopen(/Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-r/00new/arrow/libs/arrow.so, 6): Library not loaded: /usr/local/lib/libarrow.400.dylib
  Referenced from: /usr/local/lib/libparquet.400.dylib
  Reason: image not found</code></pre>
<p>You need to make sure that you don’t let R link to your system library when building arrow. You can do this a number of different ways:</p>
<ul>
<li>Setting the <code>MAKEFLAGS</code> environment variable to <code>"LDFLAGS="</code> (see below for an example) this is the recommended way to accomplish this</li>
<li>Using {withr}’s <code>with_makevars(list(LDFLAGS = ""), ...)</code>
</li>
<li>adding <code>LDFLAGS=</code> to your <code>~/.R/Makevars</code> file (the least recommended way, though it is a common debugging approach suggested online)</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="va">MAKEFLAGS=</span><span class="st">"LDFLAGS="</span> <span class="ex">R</span> CMD INSTALL .</span></code></pre></div>
</div>
<div id="rpath-issues" class="section level3">
<h3 class="hasAnchor">
<a href="#rpath-issues" class="anchor"></a><code>rpath</code> issues</h3>
<p>If the package fails to install/load with an error like this:</p>
<pre><code>  ** testing if installed package can be loaded from temporary location
  Error: package or namespace load failed for 'arrow' in dyn.load(file, DLLpath = DLLpath, ...):
  unable to load shared object '/Users/you/R/00LOCK-r/00new/arrow/libs/arrow.so':
  dlopen(/Users/you/R/00LOCK-r/00new/arrow/libs/arrow.so, 6): Library not loaded: @rpath/libarrow.14.dylib</code></pre>
<p>ensure that <code>-DARROW_INSTALL_NAME_RPATH=OFF</code> was passed (this is important on macOS to prevent problems at link time and is a no-op on other platforms). Alternatively, try setting the environment variable <code>R_LD_LIBRARY_PATH</code> to wherever Arrow C++ was put in <code>make install</code>, e.g. <code>export R_LD_LIBRARY_PATH=/usr/local/lib</code>, and retry installing the R package.</p>
<p>When installing from source, if the R and C++ library versions do not match, installation may fail. If you’ve previously installed the libraries and want to upgrade the R package, you’ll need to update the Arrow C++ library first.</p>
<p>For any other build/configuration challenges, see the <a href="https://arrow.apache.org/docs/developers/cpp/building.html">C++ developer guide</a>.</p>
</div>
</div>
<div id="using-remotesinstall_github---" class="section level2">
<h2 class="hasAnchor">
<a href="#using-remotesinstall_github---" class="anchor"></a>Using <code>remotes::install_github(...)</code>
</h2>
<p>If you need an Arrow installation from a specific repository or at a specific ref, <code><a href="https://remotes.r-lib.org/reference/install_github.html">remotes::install_github("apache/arrow/r", build = FALSE)</a></code> should work on most platforms (with the notable exception of Windows). The <code>build = FALSE</code> argument is important so that the installation can access the C++ source in the <code>cpp/</code> directory in <code>apache/arrow</code>.</p>
<p>As with other installation methods, setting the environment variables <code>LIBARROW_MINIMAL=false</code> and <code>ARROW_R_DEV=true</code> will provide a more full-featured version of Arrow and provide more verbose output, respectively.</p>
<p>For example, to install from the (fictional) branch <code>bugfix</code> from <code>apache/arrow</code> one could:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>LIBARROW_MINIMAL<span class="op">=</span><span class="st">"false"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"apache/arrow/r@bugfix"</span>, build <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Developers may wish to use this method of installing a specific commit separate from another Arrow development environment or system installation (e.g. we use this in <a href="https://github.com/ursacomputing/arrowbench">arrowbench</a> to install development versions of arrow isolated from the system install). If you already have Arrow C++ libraries installed system-wide, you may need to set some additional variables in order to isolate this build from your system libraries:</p>
<ul>
<li>Setting the environment variable <code>FORCE_BUNDLED_BUILD</code> to <code>true</code> will skip the <code>pkg-config</code> search for Arrow libraries and attempt to build from the same source at the repository+ref given.</li>
<li>You may also need to set the Makevars <code>CPPFLAGS</code> and <code>LDFLAGS</code> to <code>""</code> in order to prevent the installation process from attempting to link to already installed system versions of Arrow. One way to do this temporarily is wrapping your <code><a href="https://remotes.r-lib.org/reference/install_github.html">remotes::install_github()</a></code> call like so: <code><a href="https://withr.r-lib.org/reference/with_makevars.html">withr::with_makevars(list(CPPFLAGS = "", LDFLAGS = ""), remotes::install_github(...))</a></code>.</li>
</ul>
</div>
<div id="what-happens-when-you-r-cmd-install" class="section level2">
<h2 class="hasAnchor">
<a href="#what-happens-when-you-r-cmd-install" class="anchor"></a>What happens when you <code>R CMD INSTALL</code>?</h2>
<p>There are a number of scripts that are triggered when <code>R CMD INSTALL .</code>. For Arrow users, these should all just work without configuration and pull in the most complete pieces (e.g. official binaries that we host) so the installation process is easy. However knowing about these scripts can help troubleshoot if things go wrong in them or things go wrong in an install:</p>
<ul>
<li>
<code>configure</code> and <code>configure.win</code> These scripts are triggered during <code>R CMD INSTALL .</code> on non-Windows and Windows platforms, respectively. They handle finding the Arrow library, setting up the build variables necessary, and writing the package Makevars file that is used to compile the C++ code in the R package.</li>
<li>
<code>tools/nixlibs.R</code> This script is sometimes called by <code>configure</code> on Linux (or on any non-windows OS with the environment variable <code>FORCE_BUNDLED_BUILD=true</code>). This sets up the build process for our bundled builds (which is the default on linux). The operative logic is at the end of the script, but it will do the following (and it will stop with the first one that succeeds and some of the steps are only checked if they are enabled via an environment variable):
<ul>
<li>Check if there is an already built libarrow in <code>arrow/r/libarrow-{version}</code>, use that to link against if it exists.</li>
<li>Check if a binary is available from our hosted unofficial builds.</li>
<li>Download the Arrow source and build the Arrow Library from source.</li>
<li>
<code>*** Proceed without C++</code> dependencies (this is an error and the package will not work, but if you see this message you know the previous steps have not succeeded/were not enabled)</li>
</ul>
</li>
<li>
<code>inst/build_arrow_static.sh</code> this script builds Arrow for a bundled, static build. It is called by <code>tools/nixlibs.R</code> when the Arrow library is being built. (If you’re looking at this script, and you’ve gotten this far, it should look <em>incredibly</em> familiar: it’s basically the contents of this guide in script form — with a few important changes)</li>
</ul>
</div>
<div id="editing-c-code-in-the-r-package" class="section level2">
<h2 class="hasAnchor">
<a href="#editing-c-code-in-the-r-package" class="anchor"></a>Editing C++ code in the R package</h2>
<p>The <code>arrow</code> package uses some customized tools on top of <code>cpp11</code> to prepare its C++ code in <code>src/</code>. This is because we have some features that are only enabled and built conditionally during build time. If you change C++ code in the R package, you will need to set the <code>ARROW_R_DEV</code> environment variable to <code>true</code> (optionally, add it to your <code>~/.Renviron</code> file to persist across sessions) so that the <code>data-raw/codegen.R</code> file is used for code generation. The <code>Makefile</code> commands also handles this automatically.</p>
<p>We use Google C++ style in our C++ code. The easiest way to accomplish this is use an editors/IDE that formats your code for you. Many popular editors/IDEs have support for running <code>clang-format</code> on C++ files when you save them. Installing/enabling the appropriate plugin may save you much frustration.</p>
<p>Check for style errors with</p>
<pre class="shell"><code>./lint.sh</code></pre>
<p>Fix any style issues before committing with</p>
<pre class="shell"><code>./lint.sh --fix</code></pre>
<p>The lint script requires Python 3 and <code>clang-format-8</code>. If the command isn’t found, you can explicitly provide the path to it like <code>CLANG_FORMAT=$(which clang-format-8) ./lint.sh</code>. On macOS, you can get this by installing LLVM via Homebrew and running the script as <code>CLANG_FORMAT=$(brew --prefix llvm@8)/bin/clang-format ./lint.sh</code></p>
<p><em>Note</em> that the lint script requires Python 3 and the Python dependencies (note that `cmake_format is pinned to a specific version):</p>
<ul>
<li>autopep8</li>
<li>flake8</li>
<li>cmake_format==0.5.2</li>
</ul>
</div>
<div id="running-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#running-tests" class="anchor"></a>Running tests</h2>
<p>Some tests are conditionally enabled based on the availability of certain features in the package build (S3 support, compression libraries, etc.). Others are generally skipped by default but can be enabled with environment variables or other settings:</p>
<ul>
<li>All tests are skipped on Linux if the package builds without the C++ libarrow. To make the build fail if libarrow is not available (as in, to test that the C++ build was successful), set <code>TEST_R_WITH_ARROW=true</code>
</li>
<li>Some tests are disabled unless <code>ARROW_R_DEV=true</code>
</li>
<li>Tests that require allocating &gt;2GB of memory to test Large types are disabled unless <code>ARROW_LARGE_MEMORY_TESTS=true</code>
</li>
<li>Integration tests against a real S3 bucket are disabled unless credentials are set in <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>; these are available on request</li>
<li>S3 tests using <a href="https://min.io/">MinIO</a> locally are enabled if the <code>minio server</code> process is found running. If you’re running MinIO with custom settings, you can set <code>MINIO_ACCESS_KEY</code>, <code>MINIO_SECRET_KEY</code>, and <code>MINIO_PORT</code> to override the defaults.</li>
</ul>
</div>
<div id="github-workflows" class="section level2">
<h2 class="hasAnchor">
<a href="#github-workflows" class="anchor"></a>Github workflows</h2>
<p>On a pull request, there are some actions you can trigger by commenting on the PR. We have additional CI checks that run nightly and can be requested on demand using an internal tool called <a href="https://arrow.apache.org/docs/developers/crossbow.html">crosssbow</a>. A few important GitHub comment commands include:</p>
<ul>
<li>
<code>@github-actions crossbow submit -g r</code> for all extended R CI tests</li>
<li>
<code>@github-actions crossbow submit {task-name}</code> for running a specific task. See the <code>r:</code> group definition near the beginning of the <a href="https://github.com/apache/arrow/blob/master/dev/tasks/tasks.yml">crossbow configuration</a> for a list of glob expression patterns that match names of items in the <code>tasks:</code> list below it.</li>
<li>
<code>@github-actions autotune</code> will run and fix lint c++ linting errors + run R documentation (among other cleanup tasks) and commit them to the branch</li>
</ul>
</div>
<div id="useful-functions-for-arrow-developers" class="section level2">
<h2 class="hasAnchor">
<a href="#useful-functions-for-arrow-developers" class="anchor"></a>Useful functions for Arrow developers</h2>
<p>Within an R session, these can help with package development:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="co"># Load the dev package</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>devtools<span class="op">::</span><span class="kw">load_all</span>()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a><span class="co"># Run the test suite, optionally filtering file names</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>devtools<span class="op">::</span><span class="kw">test</span>(<span class="dt">filter=</span><span class="st">"^regexp$"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a><span class="co"># or the Makefile alternative from the arrow/r directory in a shell:</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>make test file=regexp</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a><span class="co"># Update roxygen documentation</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a>devtools<span class="op">::</span><span class="kw">document</span>()</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a><span class="co"># To preview the documentation website</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a>pkgdown<span class="op">::</span><span class="kw">build_site</span>()</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a><span class="co"># All package checks; see also below</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a>devtools<span class="op">::</span><span class="kw">check</span>()</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true"></a><span class="co"># See test coverage statistics</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true"></a>covr<span class="op">::</span><span class="kw">report</span>()</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true"></a>covr<span class="op">::</span><span class="kw">package_coverage</span>()</span></code></pre></div>
<p>Any of those can be run from the command line by wrapping them in <code>R -e '$COMMAND'</code>. There’s also a <code>Makefile</code> to help with some common tasks from the command line (<code>make test</code>, <code>make doc</code>, <code>make clean</code>, etc.)</p>
<div id="full-package-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#full-package-validation" class="anchor"></a>Full package validation</h3>
<pre class="shell"><code>R CMD build .
R CMD check arrow_*.tar.gz --as-cran</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Neal Richardson, Ian Cook, Jonathan Keane, Romain François, Jeroen Ooms, Apache Arrow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
