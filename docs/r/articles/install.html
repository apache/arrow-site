<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Installing the Arrow Package on Linux • Arrow R Package</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Installing the Arrow Package on Linux">
<meta property="og:description" content="arrow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107500873-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107500873-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Arrow R Package</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">6.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://arrow.apache.org/">❯❯❯</a>
</li>
<li>
  <a href="../articles/arrow.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/install.html">Installing the Arrow Package on Linux</a>
    </li>
    <li>
      <a href="../articles/dataset.html">Working with Arrow Datasets and dplyr</a>
    </li>
    <li>
      <a href="../articles/fs.html">Working with Cloud Storage (S3)</a>
    </li>
    <li>
      <a href="../articles/python.html">Apache Arrow in Python and R with reticulate</a>
    </li>
    <li>
      <a href="../articles/flight.html">Connecting to Flight RPC Servers</a>
    </li>
    <li>
      <a href="../articles/developing.html">Arrow R Developer Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Project docs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://arrow.apache.org/docs/format/README.html">Specification</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/c_glib">C GLib</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/cpp">C++</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/java">Java</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/js">JavaScript</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/python">Python</a>
    </li>
    <li>
      <a href="../index.html">R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Installing the Arrow Package on Linux</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apache/arrow/blob/master/r/vignettes/install.Rmd"><code>vignettes/install.Rmd</code></a></small>
      <div class="hidden name"><code>install.Rmd</code></div>

    </div>

    
    
<p>On macOS and Windows, when you <code>install.packages("arrow")</code>, you get a binary package that contains Arrow’s C++ dependencies along with it. On Linux, <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> retrieves a source package that has to be compiled locally, and C++ dependencies need to be resolved as well. Generally for R packages with C++ dependencies, this requires either installing system packages, which you may not have privileges to do, or building the C++ dependencies separately, which introduces all sorts of additional ways for things to go wrong.</p>
<p>Our goal is to make <code>install.packages("arrow")</code> “just work” for as many Linux distributions, versions, and configurations as possible. This document describes how it works and the options for fine-tuning Linux installation. The intended audience for this document is <code>arrow</code> R package users on Linux, not developers. If you’re contributing to the Arrow project, see `vignette(“developing”, package = “arrow”) for guidance on setting up your development environment.</p>
<p>Note also that if you use <code>conda</code> to manage your R environment, this document does not apply. You can <code>conda install -c conda-forge --strict-channel-priority r-arrow</code> and you’ll get the latest official release of the R package along with any C++ dependencies.</p>
<blockquote>
<p>Having trouble installing <code>arrow</code>? See the “Troubleshooting” section below.</p>
</blockquote>
<div id="installation-basics" class="section level1">
<h1 class="hasAnchor">
<a href="#installation-basics" class="anchor"></a>Installation basics</h1>
<p>Install the latest release of <code>arrow</code> from CRAN with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"arrow"</span><span class="op">)</span></code></pre></div>
<p>Daily development builds, which are not official releases, can be installed from the Ursa Labs repository:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"arrow"</span>, repos <span class="op">=</span> <span class="st">"https://arrow-r-nightly.s3.amazonaws.com"</span><span class="op">)</span></code></pre></div>
<p>or for conda users via:</p>
<pre><code>conda install -c arrow-nightlies -c conda-forge --strict-channel-priority r-arrow</code></pre>
<p>You can also install the R package from a git checkout:</p>
<pre class="shell"><code>git clone https://github.com/apache/arrow
cd arrow/r
R CMD INSTALL .</code></pre>
<p>If you don’t already have the Arrow C++ libraries on your system, when installing the R package from source, it will also download and build the Arrow C++ libraries for you. To speed installation up, you can set</p>
<pre class="shell"><code>export LIBARROW_BINARY=true</code></pre>
<p>to look for C++ binaries prebuilt for your Linux distribution/version. Alternatively, you can set</p>
<pre class="shell"><code>export LIBARROW_MINIMAL=false</code></pre>
<p>to build the Arrow libraries from source with optional features such as compression libraries enabled. This will increase the build time but provides many useful features. Prebuilt binaries are built with this flag enabled, so you get the full functionality by using them as well.</p>
<p>Both of these variables are also set this way if you have the <code>NOT_CRAN=true</code> environment variable set.</p>
<div id="helper-function-install_arrow" class="section level2">
<h2 class="hasAnchor">
<a href="#helper-function-install_arrow" class="anchor"></a>Helper function: install_arrow()</h2>
<p>If you already have <code>arrow</code> installed and want to upgrade to a different version, install a development build, or try to reinstall and fix issues with Linux C++ binaries, you can call <code><a href="../reference/install_arrow.html">install_arrow()</a></code>. <code><a href="../reference/install_arrow.html">install_arrow()</a></code> provides some convenience wrappers around the various environment variables described below. This function is part of the <code>arrow</code> package, and it is also available as a standalone script, so you can access it for convenience without first installing the package:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/apache/arrow/master/r/R/install-arrow.R"</span><span class="op">)</span></code></pre></div>
<p><code><a href="../reference/install_arrow.html">install_arrow()</a></code> will install from CRAN, while <code>install_arrow(nightly = TRUE)</code> will give you a development build. <code><a href="../reference/install_arrow.html">install_arrow()</a></code> does not require environment variables to be set in order to satisfy C++ dependencies.</p>
<blockquote>
<p>Note that, unlike packages like <code>tensorflow</code>, <code>blogdown</code>, and others that require external dependencies, you do not need to run <code><a href="../reference/install_arrow.html">install_arrow()</a></code> after a successful <code>arrow</code> installation.</p>
</blockquote>
</div>
<div id="offline-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#offline-installation" class="anchor"></a>Offline installation</h2>
<p>The <code>install-arrow.R</code> file also includes the <code><a href="../reference/create_package_with_all_dependencies.html">create_package_with_all_dependencies()</a></code> function. Normally, when installing on a computer with internet access, the build process will download third-party dependencies as needed. This function provides a way to download them in advance. Doing so may be useful when installing Arrow on a computer without internet access. Note that Arrow <em>can</em> be installed on a computer without internet access without doing this, but many useful features will be disabled, as they depend on third-party components. More precisely, <code>arrow::arrow_info()$capabilities()</code> will be <code>FALSE</code> for every capability. One approach to add more capabilities in an offline install is to prepare a package with pre-downloaded dependencies. The <code><a href="../reference/create_package_with_all_dependencies.html">create_package_with_all_dependencies()</a></code> function does this preparation.</p>
<p>If you’re using binary packages you shouldn’t need to follow these steps. You should download the appropriate binary from your package repository, transfer that to the offline computer, and install that. Any OS can create the source bundle, but it cannot be installed on Windows. (Instead, use a standard Windows binary package.)</p>
<p>Note if you’re using RStudio Package Manager on Linux: If you still want to make a source bundle with this function, make sure to set the first repo in <code>options("repos")</code> to be a mirror that contains source packages (that is: something other than the RSPM binary mirror URLs).</p>
<div id="using-a-computer-with-internet-access-pre-download-the-dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#using-a-computer-with-internet-access-pre-download-the-dependencies" class="anchor"></a>Using a computer with internet access, pre-download the dependencies:</h3>
<ul>
<li>Install the <code>arrow</code> package <em>or</em> run <code>source("https://raw.githubusercontent.com/apache/arrow/master/r/R/install-arrow.R")</code>
</li>
<li>Run <code>create_package_with_all_dependencies("my_arrow_pkg.tar.gz")</code>
</li>
<li>Copy the newly created <code>my_arrow_pkg.tar.gz</code> to the computer without internet access</li>
</ul>
</div>
<div id="on-the-computer-without-internet-access-install-the-prepared-package" class="section level3">
<h3 class="hasAnchor">
<a href="#on-the-computer-without-internet-access-install-the-prepared-package" class="anchor"></a>On the computer without internet access, install the prepared package:</h3>
<ul>
<li>Install the <code>arrow</code> package from the copied file
<ul>
<li><code>install.packages("my_arrow_pkg.tar.gz", dependencies = c("Depends", "Imports", "LinkingTo"))</code></li>
<li>This installation will build from source, so <code>cmake</code> must be available</li>
</ul>
</li>
<li>Run <code><a href="../reference/arrow_info.html">arrow_info()</a></code> to check installed capabilities</li>
</ul>
<div id="alternative-hands-on-approach" class="section level4">
<h4 class="hasAnchor">
<a href="#alternative-hands-on-approach" class="anchor"></a>Alternative, hands-on approach</h4>
<ul>
<li>Download the dependency files (<code>cpp/thirdparty/download_dependencies.sh</code> may be helpful)</li>
<li>Copy the directory of dependencies to the offline computer</li>
<li>Create the environment variable <code>ARROW_THIRDPARTY_DEPENDENCY_DIR</code> on the offline computer, pointing to the copied directory.</li>
<li>Install the <code>arrow</code> package as usual.</li>
</ul>
</div>
</div>
</div>
<div id="s3-support" class="section level2">
<h2 class="hasAnchor">
<a href="#s3-support" class="anchor"></a>S3 support</h2>
<p>The <code>arrow</code> package allows you to work with data in AWS S3 or in other cloud storage system that emulate S3. However, support for working with S3 is not enabled in the default build, and it has additional system requirements. To enable it, set the environment variable <code>LIBARROW_MINIMAL=false</code> or <code>NOT_CRAN=true</code> to choose the full-featured build, or more selectively set <code>ARROW_S3=ON</code>. You also need the following system dependencies:</p>
<ul>
<li>
<code>gcc</code> &gt;= 4.9 or <code>clang</code> &gt;= 3.3; note that the default compiler on CentOS 7 is gcc 4.8.5, which is not sufficient</li>
<li>CURL: install <code>libcurl-devel</code> (rpm) or <code>libcurl4-openssl-dev</code> (deb)</li>
<li>OpenSSL &gt;= 1.0.2: install <code>openssl-devel</code> (rpm) or <code>libssl-dev</code> (deb)</li>
</ul>
<p>The prebuilt C++ binaries come with S3 support enabled, so you will need to meet these system requirements in order to use them–the package will not install without them. If you’re building everything from source, the install script will check for the presence of these dependencies and turn off S3 support in the build if the prerequisites are not met–installation will succeed but without S3 functionality. If afterwards you install the missing system requirements, you’ll need to reinstall the package in order to enable S3 support.</p>
</div>
</div>
<div id="how-dependencies-are-resolved" class="section level1">
<h1 class="hasAnchor">
<a href="#how-dependencies-are-resolved" class="anchor"></a>How dependencies are resolved</h1>
<p>In order for the <code>arrow</code> R package to work, it needs the Arrow C++ library. There are a number of ways you can get it: a system package; a library you’ve built yourself outside of the context of installing the R package; or, if you don’t already have it, the R package will attempt to resolve it automatically when it installs.</p>
<p>If you are authorized to install system packages and you’re installing a CRAN release, you may want to use the official Apache Arrow release packages corresponding to the R package version (though there are some drawbacks: see “Troubleshooting” below). See the <a href="https://arrow.apache.org/install/">Arrow project installation page</a> to find pre-compiled binary packages for some common Linux distributions, including Debian, Ubuntu, and CentOS. You’ll need to install <code>libparquet-dev</code> on Debian and Ubuntu, or <code>parquet-devel</code> on CentOS. This will also automatically install the Arrow C++ library as a dependency.</p>
<p>When you install the <code>arrow</code> R package on Linux, it will first attempt to find the Arrow C++ libraries on your system using the <code>pkg-config</code> command. This will find either installed system packages or libraries you’ve built yourself. In order for <code>install.packages("arrow")</code> to work with these system packages, you’ll need to install them before installing the R package.</p>
<p>If no Arrow C++ libraries are found on the system, the R package installation script will next attempt to download prebuilt static Arrow C++ libraries that match your both your local operating system and <code>arrow</code> R package version. C++ binaries will only be retrieved if you have set the environment variable <code>LIBARROW_BINARY</code> or <code>NOT_CRAN</code>. If found, they will be downloaded and bundled when your R package compiles. For a list of supported distributions and versions, see the <a href="https://github.com/ursa-labs/arrow-r-nightly/blob/master/README.md">arrow-r-nightly</a> project.</p>
<p>If no C++ library binary is found, it will attempt to build it locally. First, it will also look to see if you are in a checkout of the <code>apache/arrow</code> git repository and thus have the C++ source there. Otherwise, it builds from the C++ files included in the package. Depending on your system, building Arrow C++ from source may be slow.</p>
<p>For the specific mechanics of how all this works, see the R package <code>configure</code> script, which calls <code>tools/nixlibs.R</code>.</p>
<p>If the C++ library is built from source, <code>inst/build_arrow_static.sh</code> is executed. This build script is also what is used to generate the prebuilt binaries.</p>
<div id="how-the-package-is-installed---advanced" class="section level2">
<h2 class="hasAnchor">
<a href="#how-the-package-is-installed---advanced" class="anchor"></a>How the package is installed - advanced</h2>
<p>This subsection contains information which is likely to be most relevant mostly to Arrow developers and is not necessary for Arrow users to install Arrow.</p>
<p>There are a number of scripts that are triggered when <code>R CMD INSTALL .</code> is run. For Arrow users, these should all just work without configuration and pull in the most complete pieces (e.g. official binaries that we host).</p>
<p>An overview of these scripts is shown below:</p>
<ul>
<li><p><code>configure</code> and <code>configure.win</code> - these scripts are triggered during <code>R CMD INSTALL .</code> on non-Windows and Windows platforms, respectively. They handle finding the Arrow library, setting up the build variables necessary, and writing the package Makevars file that is used to compile the C++ code in the R package.</p></li>
<li>
<code>tools/nixlibs.R</code> - this script is sometimes called by <code>configure</code> on Linux (or on any non-windows OS with the environment variable <code>FORCE_BUNDLED_BUILD=true</code>). This sets up the build process for our bundled builds (which is the default on linux). The operative logic is at the end of the script, but it will do the following (and it will stop with the first one that succeeds and some of the steps are only checked if they are enabled via an environment variable):
<ul>
<li>Check if there is an already built libarrow in <code>arrow/r/libarrow-{version}</code>, use that to link against if it exists.</li>
<li>Check if a binary is available from our hosted unofficial builds.</li>
<li>Download the Arrow source and build the Arrow Library from source.</li>
<li>
<code>*** Proceed without C++</code> dependencies (this is an error and the package will not work, but if you see this message you know the previous steps have not succeeded/were not enabled)</li>
</ul>
</li>
<li><p><code>inst/build_arrow_static.sh</code> - called by <code>tools/nixlibs.R</code> when the Arrow library is being built. It builds Arrow for a bundled, static build, and mirrors the steps described in the <a href="./developing.html">“Arrow R Developer Guide” vignette</a></p></li>
</ul>
</div>
</div>
<div id="troubleshooting" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting" class="anchor"></a>Troubleshooting</h1>
<p>The intent is that <code>install.packages("arrow")</code> will just work and handle all C++ dependencies, but depending on your system, you may have better results if you tune one of several parameters. Here are some known complications and ways to address them.</p>
<div id="package-failed-to-build-c-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#package-failed-to-build-c-dependencies" class="anchor"></a>Package failed to build C++ dependencies</h2>
<p>If you see a message like</p>
<pre><code>------------------------- NOTE ---------------------------
There was an issue preparing the Arrow C++ libraries.
See https://arrow.apache.org/docs/r/articles/install.html
---------------------------------------------------------</code></pre>
<p>in the output when the package fails to install, that means that installation failed to retrieve or build C++ libraries compatible with the current version of the R package.</p>
<p>It is expected that C++ dependencies should be built successfully on all Linux distributions, so you should not see this message. If you do, please check the “Known installation issues” below to see if any apply. If none apply, set the environment variable <code>ARROW_R_DEV=TRUE</code> so that details on what failed are shown, and try installing again. Then, please <a href="https://issues.apache.org/jira/projects/ARROW/issues">report an issue</a> and include the full verbose installation output.</p>
</div>
<div id="using-system-libraries" class="section level2">
<h2 class="hasAnchor">
<a href="#using-system-libraries" class="anchor"></a>Using system libraries</h2>
<p>If a system library or other installed Arrow is found but it doesn’t match the R package version (for example, you have libarrow 1.0.0 on your system and are installing R package 2.0.0), it is likely that the R bindings will fail to compile. Because the Apache Arrow project is under active development, is it essential that versions of the C++ and R libraries match. When <code>install.packages("arrow")</code> has to download the C++ libraries, the install script ensures that you fetch the C++ libraries that correspond to your R package version. However, if you are using Arrow libraries already on your system, version match isn’t guaranteed.</p>
<p>To fix version mismatch, you can either update your system packages to match the R package version, or set the environment variable <code>ARROW_USE_PKG_CONFIG=FALSE</code> to tell the configure script not to look for system Arrow packages. (The latter is the default of <code><a href="../reference/install_arrow.html">install_arrow()</a></code>.) System packages are available corresponding to all CRAN releases but not for nightly or dev versions, so depending on the R package version you’re installing, system packages may not be an option.</p>
<p>Note also that once you have a working R package installation based on system (shared) libraries, if you update your system Arrow, you’ll need to reinstall the R package to match its version. Similarly, if you’re using Arrow system libraries, running <code><a href="https://rdrr.io/r/utils/update.packages.html">update.packages()</a></code> after a new release of the <code>arrow</code> package will likely fail unless you first update the system packages.</p>
</div>
<div id="using-prebuilt-binaries" class="section level2">
<h2 class="hasAnchor">
<a href="#using-prebuilt-binaries" class="anchor"></a>Using prebuilt binaries</h2>
<p>If the R package finds and downloads a prebuilt binary of the C++ library, but then the <code>arrow</code> package can’t be loaded, perhaps with “undefined symbols” errors, please <a href="https://issues.apache.org/jira/projects/ARROW/issues">report an issue</a>. This is likely a compiler mismatch and may be resolvable by setting some environment variables to instruct R to compile the packages to match the C++ library.</p>
<p>A workaround would be to set the environment variable <code>LIBARROW_BINARY=FALSE</code> and retry installation: this value instructs the package to build the C++ library from source instead of downloading the prebuilt binary. That should guarantee that the compiler settings match.</p>
<p>If a prebuilt binary wasn’t found for your operating system but you think it should have been, check the logs for a message that says <code>*** Unable to identify current OS/version</code>, or a message that says <code>*** No C++ binaries found for</code> an invalid OS. If you see either, please <a href="https://issues.apache.org/jira/projects/ARROW/issues">report an issue</a>. You may also set the environment variable <code>ARROW_R_DEV=TRUE</code> for additional debug messages.</p>
<p>A workaround would be to set the environment variable <code>LIBARROW_BINARY</code> to a <code>distribution-version</code> that exists in the Ursa Labs repository. Setting <code>LIBARROW_BINARY</code> is also an option when there’s not an exact match for your OS but a similar version would work, such as if you’re on <code>ubuntu-18.10</code> and there’s only a binary for <code>ubuntu-18.04</code>.</p>
<p>If that workaround works for you, and you believe that it should work for everyone else too, you may propose <a href="https://github.com/ursa-labs/arrow-r-nightly/edit/master/linux/distro-map.csv">adding an entry to this lookup table</a>. This table is checked during the installation process and tells the script to use binaries built on a different operating system/version because they’re known to work.</p>
</div>
<div id="building-c-from-source" class="section level2">
<h2 class="hasAnchor">
<a href="#building-c-from-source" class="anchor"></a>Building C++ from source</h2>
<p>If building the C++ library from source fails, check the error message. (If you don’t see an error message, only the <code>----- NOTE -----</code>, set the environment variable <code>ARROW_R_DEV=TRUE</code> to increase verbosity and retry installation.) The install script should work everywhere, so if the C++ library fails to compile, please <a href="https://issues.apache.org/jira/projects/ARROW/issues">report an issue</a> so that we can improve the script.</p>
</div>
<div id="known-installation-issues" class="section level2">
<h2 class="hasAnchor">
<a href="#known-installation-issues" class="anchor"></a>Known installation issues</h2>
<ul>
<li><p>On CentOS, if you are using a more modern <code>devtoolset</code>, you may need to set the environment variables <code>CC</code> and <code>CXX</code> either in the shell or in R’s <code>Makeconf</code>. For CentOS 7 and above, both the Arrow system packages and the C++ binaries for R are built with the default system compilers. If you want to use either of these and you have a <code>devtoolset</code> installed, set <code>CC=/usr/bin/gcc CXX=/usr/bin/g++</code> to use the system compilers instead of the <code>devtoolset</code>. Alternatively, if you want to build <code>arrow</code> with the newer <code>devtoolset</code> compilers, set both <code>ARROW_USE_PKG_CONFIG</code> and <code>LIBARROW_BINARY</code> to <code>false</code> so that you build the Arrow C++ from source using those compilers. Compiler mismatch between the arrow system libraries and the R package may cause R to segfault when <code>arrow</code> package functions are used. See discussions <a href="https://issues.apache.org/jira/browse/ARROW-8586">here</a> and <a href="https://issues.apache.org/jira/browse/ARROW-10780">here</a>.</p></li>
<li><p>If you have multiple versions of <code>zstd</code> installed on your system, installation by building the C++ from source may fail with an undefined symbols error. Workarounds include (1) setting <code>LIBARROW_BINARY</code> to use a C++ binary; (2) setting <code>ARROW_WITH_ZSTD=OFF</code> to build without <code>zstd</code>; or (3) uninstalling the conflicting <code>zstd</code>. See discussion <a href="https://issues.apache.org/jira/browse/ARROW-8556">here</a>.</p></li>
</ul>
</div>
<div id="summary-of-build-environment-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-of-build-environment-variables" class="anchor"></a>Summary of build environment variables</h2>
<p>Some features are optional when you build Arrow from source. With the exception of <code>ARROW_S3</code>, these are all <code>ON</code> by default in the bundled C++ build, but you can set them to <code>OFF</code> to disable them.</p>
<ul>
<li>
<code>ARROW_S3</code>: If set to <code>ON</code> S3 support will be built as long as the dependencies are met; if they are not met, the build script will turn this <code>OFF</code>
</li>
<li>
<code>ARROW_JEMALLOC</code> for the <code>jemalloc</code> memory allocator</li>
<li>
<code>ARROW_MIMALLOC</code> for the <code>mimalloc</code> memmory allocator</li>
<li><code>ARROW_PARQUET</code></li>
<li><code>ARROW_DATASET</code></li>
<li>
<code>ARROW_JSON</code> for the JSON parsing library</li>
<li>
<code>ARROW_WITH_RE2</code> for the RE2 regular expression library, used in some string compute functions</li>
<li>
<code>ARROW_WITH_UTF8PROC</code> for the UTF8Proc string library, used in many other string compute functions</li>
<li>
<code>ARROW_JSON</code> for JSON parsing</li>
<li>
<code>ARROW_WITH_BROTLI</code>, <code>ARROW_WITH_BZ2</code>, <code>ARROW_WITH_LZ4</code>, <code>ARROW_WITH_SNAPPY</code>, <code>ARROW_WITH_ZLIB</code>, and <code>ARROW_WITH_ZSTD</code> for various compression algorithms</li>
</ul>
<p>There are a number of other variables that affect the <code>configure</code> script and the bundled build script. By default, these are all unset. All boolean variables are case-insensitive.</p>
<ul>
<li>
<code>ARROW_USE_PKG_CONFIG</code>: If set to <code>false</code>, the configure script won’t look for Arrow libraries on your system and instead will look to download/build them. Use this if you have a version mismatch between installed system libraries and the version of the R package you’re installing.</li>
<li>
<code>LIBARROW_BINARY</code>: If set to <code>true</code>, the script will try to download a binary C++ library built for your operating system. You may also set it to some other string, a related “distro-version” that has binaries built that work for your OS. If no binary is found, installation will fall back to building C++ dependencies from source.</li>
<li>
<code>LIBARROW_BUILD</code>: If set to <code>false</code>, the build script will not attempt to build the C++ from source. This means you will only get a working <code>arrow</code> R package if a prebuilt binary is found. Use this if you want to avoid compiling the C++ library, which may be slow and resource-intensive, and ensure that you only use a prebuilt binary.</li>
<li>
<code>LIBARROW_MINIMAL</code>: If set to <code>false</code>, the build script will enable some optional features, including compression libraries, S3 support, and additional alternative memory allocators. This will increase the source build time but results in a more fully functional library.</li>
<li>
<code>NOT_CRAN</code>: If this variable is set to <code>true</code>, as the <code>devtools</code> package does, the build script will set <code>LIBARROW_BINARY=true</code> and <code>LIBARROW_MINIMAL=false</code> unless those environment variables are already set. This provides for a more complete and fast installation experience for users who already have <code>NOT_CRAN=true</code> as part of their workflow, without requiring additional environment variables to be set.</li>
<li>
<code>ARROW_R_DEV</code>: If set to <code>true</code>, more verbose messaging will be printed in the build script. <code>arrow::install_arrow(verbose = TRUE)</code> sets this. This variable also is needed if you’re modifying C++ code in the package: see the developer guide vignette.</li>
<li>
<code>LIBARROW_DEBUG_DIR</code>: If the C++ library building from source fails (<code>cmake</code>), there may be messages telling you to check some log file in the build directory. However, when the library is built during R package installation, that location is in a temp directory that is already deleted. To capture those logs, set this variable to an absolute (not relative) path and the log files will be copied there. The directory will be created if it does not exist.</li>
<li>
<code>CMAKE</code>: When building the C++ library from source, you can specify a <code>/path/to/cmake</code> to use a different version than whatever is found on the <code>$PATH</code>
</li>
</ul>
</div>
</div>
<div id="contributing" class="section level1">
<h1 class="hasAnchor">
<a href="#contributing" class="anchor"></a>Contributing</h1>
<p>As mentioned above, please <a href="https://issues.apache.org/jira/projects/ARROW/issues">report an issue</a> if you encounter ways to improve this. If you find that your Linux distribution or version is not supported, we welcome the contribution of Docker images (hosted on Docker Hub) that we can use in our continuous integration. These Docker images should be minimal, containing only R and the dependencies it requires. (For reference, see the images that <a href="https://github.com/r-hub/rhub-linux-builders">R-hub</a> uses.)</p>
<p>You can test the <code>arrow</code> R package installation using the <code>docker-compose</code> setup included in the <code>apache/arrow</code> git repository. For example,</p>
<pre><code>R_ORG=rhub R_IMAGE=ubuntu-gcc-release R_TAG=latest docker-compose build r
R_ORG=rhub R_IMAGE=ubuntu-gcc-release R_TAG=latest docker-compose run r</code></pre>
<p>installs the <code>arrow</code> R package, including the C++ source build, on the <a href="https://hub.docker.com/r/rhub/ubuntu-gcc-release">rhub/ubuntu-gcc-release</a> image.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Neal Richardson, Ian Cook, Nic Crane, Jonathan Keane, Romain François, Jeroen Ooms, Apache Arrow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
