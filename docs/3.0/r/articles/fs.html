<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Cloud Storage (S3) • Arrow R Package</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with Cloud Storage (S3)">
<meta property="og:description" content="arrow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107500873-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107500873-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Arrow R Package</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://arrow.apache.org/">❯❯❯</a>
</li>
<li>
  <a href="../articles/arrow.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dataset.html">Working with Arrow Datasets and dplyr</a>
    </li>
    <li>
      <a href="../articles/flight.html">Connecting to Flight RPC Servers</a>
    </li>
    <li>
      <a href="../articles/fs.html">Working with Cloud Storage (S3)</a>
    </li>
    <li>
      <a href="../articles/install.html">Installing the Arrow Package on Linux</a>
    </li>
    <li>
      <a href="../articles/python.html">Apache Arrow in Python and R with reticulate</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Project docs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://arrow.apache.org/docs/format/README.html">Specification</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/c_glib">C GLib</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/cpp">C++</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/java">Java</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/js">JavaScript</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/python">Python</a>
    </li>
    <li>
      <a href="../index.html">R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with Cloud Storage (S3)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apache/arrow/blob/master/r/vignettes/fs.Rmd"><code>vignettes/fs.Rmd</code></a></small>
      <div class="hidden name"><code>fs.Rmd</code></div>

    </div>

    
    
<p>The Arrow C++ library includes a generic filesystem interface and specific implementations for some cloud storage systems. This setup allows various parts of the project to be able to read and write data with different storage backends. In the <code>arrow</code> R package, support has been enabled for AWS S3. This vignette provides an overview of working with S3 data using Arrow.</p>
<blockquote>
<p>In Windows and macOS binary packages, S3 support is included. On Linux when installing from source, S3 support is not enabled by default, and it has additional system requirements. See <code><a href="../articles/install.html">vignette("install", package = "arrow")</a></code> for details.</p>
</blockquote>
<div id="uris" class="section level2">
<h2 class="hasAnchor">
<a href="#uris" class="anchor"></a>URIs</h2>
<p>File readers and writers (<code><a href="../reference/read_parquet.html">read_parquet()</a></code>, <code><a href="../reference/write_feather.html">write_feather()</a></code>, et al.) accept an S3 URI as the source or destination file, as do <code><a href="../reference/open_dataset.html">open_dataset()</a></code> and <code><a href="../reference/write_dataset.html">write_dataset()</a></code>. An S3 URI looks like:</p>
<pre><code>s3://[access_key:secret_key@]bucket/path[?region=]</code></pre>
<p>For example, one of the NYC taxi data files used in <code><a href="../articles/dataset.html">vignette("dataset", package = "arrow")</a></code> is found at</p>
<pre><code>s3://ursa-labs-taxi-data/2019/06/data.parquet</code></pre>
<p>Given this URI, we can pass it to <code><a href="../reference/read_parquet.html">read_parquet()</a></code> just as if it were a local file path:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_parquet.html">read_parquet</a></span><span class="op">(</span><span class="st">"s3://ursa-labs-taxi-data/2019/06/data.parquet"</span><span class="op">)</span></code></pre></div>
<p>Note that this will be slower to read than if the file were local, though if you're running on a machine in the same AWS region as the file in S3, the cost of reading the data over the network should be much lower.</p>
</div>
<div id="creating-a-filesystem-object" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-filesystem-object" class="anchor"></a>Creating a FileSystem object</h2>
<p>Another way to connect to S3 is to create a <code>FileSystem</code> object once and pass that to the read/write functions. <code>S3FileSystem</code> objects can be created with the <code><a href="../reference/s3_bucket.html">s3_bucket()</a></code> function, which automatically detects the bucket's AWS region. Additionally, the resulting <code>FileSystem</code> will consider paths relative to the bucket's path (so for example you don't need to prefix the bucket path when listing a directory). This may be convenient when dealing with long URIs, and it's necessary for some options and authentication methods that aren't supported in the URI format.</p>
<p>With a <code>FileSystem</code> object, we can point to specific files in it with the <code>$path()</code> method. In the previous example, this would look like:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bucket</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/s3_bucket.html">s3_bucket</a></span><span class="op">(</span><span class="st">"ursa-labs-taxi-data"</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_parquet.html">read_parquet</a></span><span class="op">(</span><span class="va">bucket</span><span class="op">$</span><span class="fu">path</span><span class="op">(</span><span class="st">"2019/06/data.parquet"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>See the help for <code>FileSystem</code> for a list of options that <code><a href="../reference/s3_bucket.html">s3_bucket()</a></code> and <code>S3FileSystem$create()</code> can take. <code>region</code>, <code>scheme</code>, and <code>endpoint_override</code> can be encoded as query parameters in the URI (though <code>region</code> will be auto-detected in <code><a href="../reference/s3_bucket.html">s3_bucket()</a></code> or from the URI if omitted). <code>access_key</code> and <code>secret_key</code> can also be included, but other options are not supported in the URI.</p>
<p>The object that <code><a href="../reference/s3_bucket.html">s3_bucket()</a></code> returns is technically a <code>SubTreeFileSystem</code>, which holds a path and a file system to which it corresponds. <code>SubTreeFileSystem</code>s can be useful for holding a reference to a subdirectory somewhere, on S3 or elsewhere.</p>
<p>One way to get a subtree is to call the <code>$cd()</code> method on a <code>FileSystem</code></p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">june2019</span> <span class="op">&lt;-</span> <span class="va">bucket</span><span class="op">$</span><span class="fu">cd</span><span class="op">(</span><span class="st">"2019/06"</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_parquet.html">read_parquet</a></span><span class="op">(</span><span class="va">june2019</span><span class="op">$</span><span class="fu">path</span><span class="op">(</span><span class="st">"data.parquet"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><code>SubTreeFileSystem</code> can also be made from a URI:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">june2019</span> <span class="op">&lt;-</span> <span class="va">SubTreeFileSystem</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span><span class="st">"s3://ursa-labs-taxi-data/2019/06"</span><span class="op">)</span></code></pre></div>
</div>
<div id="authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#authentication" class="anchor"></a>Authentication</h2>
<p>To access private S3 buckets, you need typically need two secret parameters: a <code>access_key</code>, which is like a user id, and <code>secret_key</code>, like a token. There are a few options for passing these credentials:</p>
<ol style="list-style-type: decimal">
<li><p>Include them in the URI, like <code>s3://access_key:secret_key@bucket-name/path/to/file</code>. Be sure to <a href="https://en.wikipedia.org/wiki/Percent-encoding">URL-encode</a> your secrets if they contain special characters like "/".</p></li>
<li><p>Pass them as <code>access_key</code> and <code>secret_key</code> to <code>S3FileSystem$create()</code> or <code><a href="../reference/s3_bucket.html">s3_bucket()</a></code></p></li>
<li><p>Set them as environment variables named <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>, respectively.</p></li>
<li><p>Define them in a <code>~/.aws/credentials</code> file, according to the <a href="https://docs.aws.amazon.com/sdk-for-cpp/v1/developer-guide/credentials.html">AWS documentation</a>.</p></li>
</ol>
<p>You can also use an <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html">AccessRole</a> for temporary access by passing the <code>role_arn</code> identifier to <code>S3FileSystem$create()</code> or <code><a href="../reference/s3_bucket.html">s3_bucket()</a></code>.</p>
</div>
<div id="file-systems-that-emulate-s3" class="section level2">
<h2 class="hasAnchor">
<a href="#file-systems-that-emulate-s3" class="anchor"></a>File systems that emulate S3</h2>
<p>The <code>S3FileSystem</code> machinery enables you to work with any file system that provides an S3-compatible interface. For example, <a href="https://min.io/">MinIO</a> is and object-storage server that emulates the S3 API. If you were to run <code>minio server</code> locally with its default settings, you could connect to it with <code>arrow</code> using <code>S3FileSystem</code> like this:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">minio</span> <span class="op">&lt;-</span> <span class="va">S3FileSystem</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span>
  access_key <span class="op">=</span> <span class="st">"minioadmin"</span>,
  secret_key <span class="op">=</span> <span class="st">"minioadmin"</span>,
  scheme <span class="op">=</span> <span class="st">"http"</span>,
  endpoint_override <span class="op">=</span> <span class="st">"localhost:9000"</span>
<span class="op">)</span></code></pre></div>
<p>or, as a URI, it would be</p>
<pre><code>s3://minioadmin:minioadmin@?scheme=http&amp;endpoint_override=localhost%3A9000</code></pre>
<p>(note the URL escaping of the <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code> in <code>endpoint_override</code>).</p>
<p>Among other applications, this can be useful for testing out code locally before running on a remote S3 bucket.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Romain François, Jeroen Ooms, Neal Richardson, Apache Arrow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


<script type="text/javascript" src="/docs/_static/versionwarning.js"></script>  </body>
</html>
