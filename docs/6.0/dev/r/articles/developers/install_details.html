<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How the R package is installed - advanced • Arrow R Package</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><script src="../../extra.js"></script><meta property="og:title" content="How the R package is installed - advanced">
<meta property="og:description" content="arrow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107500873-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107500873-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">Arrow R Package</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">6.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://arrow.apache.org/" class="external-link">❯❯❯</a>
</li>
<li>
  <a href="../../articles/arrow.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/install.html">Installing the Arrow Package on Linux</a>
    </li>
    <li>
      <a href="../../articles/dataset.html">Working with Arrow Datasets and dplyr</a>
    </li>
    <li>
      <a href="../../articles/fs.html">Working with Cloud Storage (S3)</a>
    </li>
    <li>
      <a href="../../articles/python.html">Apache Arrow in Python and R with reticulate</a>
    </li>
    <li>
      <a href="../../articles/flight.html">Connecting to Flight RPC Servers</a>
    </li>
    <li>
      <a href="../../articles/developing.html">Arrow R Developer Guide</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Developers</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../../articles/developers/setup.html">Developer Environment Setup</a>
        </li>
        <li>
          <a href="../../articles/developers/workflow.html">Common Workflow Tasks</a>
        </li>
        <li>
          <a href="../../articles/developers/debugging.html">Debugging</a>
        </li>
        <li>
          <a href="../../articles/developers/install_details.html">Package Installation Details</a>
        </li>
        <li>
          <a href="../../articles/developers/docker.html">Docker</a>
        </li>
        <li>
          <a href="../../articles/developers/bindings.html">Writing Bindings</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Project docs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://arrow.apache.org/docs/format/Columnar.html" class="external-link">Specification</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/c_glib" class="external-link">C GLib</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/cpp" class="external-link">C++</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/java" class="external-link">Java</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/js" class="external-link">JavaScript</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/python" class="external-link">Python</a>
    </li>
    <li>
      <a href="../../index.html">R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How the R package is installed - advanced</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apache/arrow/blob/master/r/vignettes/developers/install_details.Rmd" class="external-link"><code>vignettes/developers/install_details.Rmd</code></a></small>
      <div class="hidden name"><code>install_details.Rmd</code></div>

    </div>

    
    
<p>This document is intended specifically for arrow <em>developers</em> who wish to know more about these scripts. If you are an arrow <em>user</em> looking for help with installing arrow, please see <a href="../install.html">the installation guide</a></p>
<p>The arrow R package requires that Arrow C++ library (also known as libarrow) to be installed in order to work properly. There are a number of different ways in which libarrow could be installed:</p>
<ul>
<li>as part of the R package installation process</li>
<li>a system package</li>
<li>a library you’ve built yourself outside of the context of installing the R package</li>
</ul>
<p>Below, we discuss each of these setups in turn.</p>
<div class="section level2">
<h2 id="installing-libarrow-during-r-package-installation">Installing libarrow during R package installation<a class="anchor" aria-label="anchor" href="#installing-libarrow-during-r-package-installation"></a>
</h2>
<p>There are a number of scripts that are triggered when <code>R CMD INSTALL .</code> is run and for Arrow users, these should all just work without configuration and pull in the most complete pieces (e.g. official binaries that we host). One of the jobs of these scripts is to work out if libarrow is installed, and if not, install it.</p>
<p>An overview of these scripts is shown below:</p>
<ul>
<li><p><code>configure</code> and <code>configure.win</code> - these scripts are triggered during <code>R CMD INSTALL .</code> on non-Windows and Windows platforms, respectively. They handle finding the libarrow, setting up the build variables necessary, and writing the package Makevars file that is used to compile the C++ code in the R package.</p></li>
<li><p><code>tools/nixlibs.R</code> - this script is sometimes called by <code>configure</code> on Linux (or on any non-windows OS with the environment variable <code>FORCE_BUNDLED_BUILD=true</code>) if an existing libarrow installation cannot be found. This sets up the build process for our bundled builds (which is the default on linux) and checks for binaries or downloads libarrow from source depending on dependency availability and build configuration.</p></li>
<li><p><code>tools/winlibs.R</code> - this script is sometimes called by <code>configure.win</code> on Windows when environment variable <code>ARROW_HOME</code> is not set. It looks for an existing libarrow installation, and if it can’t find one downloads an appropriate libarrow binary.</p></li>
<li><p><code>inst/build_arrow_static.sh</code> - called by <code>tools/nixlibs.R</code> when libarrow<br>
needs to be built. It builds libarrow for a bundled, static build, and mirrors the steps described in the <a href="./setup.html">“Arrow R Developer Guide” vignette</a> This build script is also what is used to generate our prebuilt binaries.</p></li>
</ul>
<p>The actions taken by these scripts to resolve dependencies and install the correct components are described below.</p>
<div class="section level3">
<h3 id="how-the-r-package-finds-libarrow">How the R package finds libarrow<a class="anchor" aria-label="anchor" href="#how-the-r-package-finds-libarrow"></a>
</h3>
<div class="section level4">
<h4 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h4>
<p>The diagram below shows how the R package finds a libarrow installation on Windows.</p>
<p><img src="install_diagram_windows.png" title="Flowchart of libarrow installation on Windows systems - find full descriptions in sections 'Checking for existing libarrow installations' and 'Downloading libarrow' below" alt="Flowchart of libarrow installation on Windows systems - find full descriptions in sections 'Checking for existing libarrow installations' and 'Downloading libarrow' below" width="70%"></p>
<div class="section level5">
<h5 id="checking-for-existing-libarrow-installations">Checking for existing libarrow installations<a class="anchor" aria-label="anchor" href="#checking-for-existing-libarrow-installations"></a>
</h5>
<p>When you install the arrow R package on Windows, if the <code>ARROW_HOME</code> environment variable has not been set, the install script looks for an existing libarrow installation. If this cannot be find, it then checks whether the <code>R_WINLIB_LOCAL</code> environment variable has been set to point to a local installation.</p>
</div>
<div class="section level5">
<h5 id="downloading-libarrow">Downloading libarrow<a class="anchor" aria-label="anchor" href="#downloading-libarrow"></a>
</h5>
<p>If no existing libarrow installations can be found, the script proceeds to try to download the required version of libarrow, first from the nightly builds repository and then from Rwinlib. The script first tries to find a version of libarrow which is matches the most components according to semantic versioning, and in the case of a failure becomes less specific (i.e. if there are no binaries found for version 0.14.1.1, then try to find one for 0.14.1).</p>
</div>
</div>
<div class="section level4">
<h4 id="non-windows">Non-Windows<a class="anchor" aria-label="anchor" href="#non-windows"></a>
</h4>
<p>The diagram below shows how the R package finds a libarrow installation on non-Windows systems.</p>
<p><img src="install_nix.png" title="Flowchart of libarrow installation on non-Windows systems - find full description in sections 'Using pkg-config', 'Prebuilt binaries' and 'Building from source' below" alt="Flowchart of libarrow installation on non-Windows systems - find full description in sections 'Using pkg-config', 'Prebuilt binaries' and 'Building from source' below" width="70%"></p>
<p>More information about these steps can be found below.</p>
<div class="section level5">
<h5 id="using-pkg-config">Using pkg-config<a class="anchor" aria-label="anchor" href="#using-pkg-config"></a>
</h5>
<p>When you install the arrow R package on non-Windows systems, if no environment variables relating to the location of an existing libarrow installation have already by set, the installation code will attempt to find libarrow on your system using the <code>pkg-config</code> command.</p>
<p>This will find either installed system packages or libraries you’ve built yourself. In order for <code>install.packages("arrow")</code> to work with these system packages, you’ll need to install them before installing the R package.</p>
</div>
<div class="section level5">
<h5 id="prebuilt-binaries">Prebuilt binaries<a class="anchor" aria-label="anchor" href="#prebuilt-binaries"></a>
</h5>
<p>If libarrow is not found on the system, the R package installation script will next attempt to download prebuilt libarrow binaries that match your both your local operating system and arrow R package version. The libarrow binaries will only be retrieved if you have set the environment variable <code>LIBARROW_BINARY</code> or <code>NOT_CRAN</code>.</p>
<p>If found, they will be downloaded and bundled when your R package compiles. For a list of supported distributions and versions, see the <a href="https://github.com/ursa-labs/arrow-r-nightly/blob/master/README.md" class="external-link">arrow-r-nightly</a> project.</p>
</div>
<div class="section level5">
<h5 id="building-from-source">Building from source<a class="anchor" aria-label="anchor" href="#building-from-source"></a>
</h5>
<p>If no libarrow binary is found, it will attempt to build it locally. First, it will also look to see if you are in a checkout of the <code>apache/arrow</code> git repository and thus have the libarrow source files there. Otherwise, it builds from the source files included in the package. Depending on your system, building libarrow from source may be slow. If libarrow is built from source, <code>inst/build_arrow_static.sh</code> is executed.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="using-the-r-package-with-libarrow-installed-as-a-system-package">Using the R package with libarrow installed as a system package<a class="anchor" aria-label="anchor" href="#using-the-r-package-with-libarrow-installed-as-a-system-package"></a>
</h2>
<p>If you are authorized to install system packages and you’re installing a CRAN release, you may want to use the official Apache Arrow release packages corresponding to the R package version via software distribution tools such as <code>apt</code> or <code>yum</code> (though there are some drawbacks: see the <a href="%22../install.html">“Troubleshooting” section in the main installation docs</a>). See the <a href="https://arrow.apache.org/install/" class="external-link">Arrow project installation page</a> to find pre-compiled binary packages for some common Linux distributions, including Debian, Ubuntu, and CentOS.</p>
<p>Generally, we do not recommend this method of working with libarrow with the R package unless you have a specific reason to do so.</p>
</div>
<div class="section level2">
<h2 id="using-the-r-package-with-an-existing-libarrow-build">Using the R package with an existing libarrow build<a class="anchor" aria-label="anchor" href="#using-the-r-package-with-an-existing-libarrow-build"></a>
</h2>
<p>This setup is much more common for arrow developers, who may be needing to make changes to both the R package and libarrow source code. See the <a href="./setup.html">developer setup docs</a> for more information.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Neal Richardson, Ian Cook, Nic Crane, Jonathan Keane, Romain François, Jeroen Ooms, Apache Arrow.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
