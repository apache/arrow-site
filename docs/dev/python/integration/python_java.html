

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Integrating PyArrow with Java &#8212; Apache Arrow v21.0.0.dev188</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python/integration/python_java';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '/docs/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev/';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <link rel="canonical" href="https://arrow.apache.org/docs/python/integration/python_java.html" />
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="21.0.0.dev188" />

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    /* We explicitly disable cookie tracking to avoid privacy issues */
    _paq.push(['disableCookies']);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://analytics.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '20']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/arrow.png" class="logo__image only-light" alt="Apache Arrow v21.0.0.dev188 - Home"/>
    <img src="../../_static/arrow-dark.png" class="logo__image only-dark pst-js-only" alt="Apache Arrow v21.0.0.dev188 - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="substrait.html">Substrait</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_r.html">Integrating PyArrow with R</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Integrating PyArrow with Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Using pyarrow from C++ and Cython Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">CUDA Integration</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Integrating PyArrow with Java</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="integrating-pyarrow-with-java">
<h1>Integrating PyArrow with Java<a class="headerlink" href="#integrating-pyarrow-with-java" title="Permalink to this heading">#</a></h1>
<p>Arrow supports exchanging data within the same process through the
<a class="reference internal" href="../../format/CDataInterface.html#c-data-interface"><span class="std std-ref">The Arrow C data interface</span></a>.</p>
<p>This can be used to exchange data between Python and Java functions and
methods so that the two languages can interact without any cost of
marshaling and unmarshaling data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The article takes for granted that you have a <code class="docutils literal notranslate"><span class="pre">Python</span></code> environment
with <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> correctly installed and a <code class="docutils literal notranslate"><span class="pre">Java</span></code> environment with
<code class="docutils literal notranslate"><span class="pre">arrow</span></code> library correctly installed.
The <code class="docutils literal notranslate"><span class="pre">Arrow</span> <span class="pre">Java</span></code> version must have been compiled with <code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">-Parrow-c-data</span></code> to
ensure CData exchange support is enabled.
See <a class="reference external" href="https://arrow.apache.org/docs/python/install.html">Python Install Instructions</a>
and <a class="reference external" href="https://arrow.apache.org/docs/java/">Java Documentation</a>
for further details.</p>
</div>
<section id="invoking-java-methods-from-python">
<h2>Invoking Java methods from Python<a class="headerlink" href="#invoking-java-methods-from-python" title="Permalink to this heading">#</a></h2>
<p>Suppose we have a simple Java class providing a number as its output:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Simple</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We would save such class in the <code class="docutils literal notranslate"><span class="pre">Simple.java</span></code> file and proceed with
compiling it to <code class="docutils literal notranslate"><span class="pre">Simple.class</span></code> using <code class="docutils literal notranslate"><span class="pre">javac</span> <span class="pre">Simple.java</span></code>.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">Simple.class</span></code> file is created we can use the class
from Python using the
<a class="reference external" href="https://jpype.readthedocs.io/">JPype</a> library which
enables a Java runtime within the Python interpreter.</p>
<p><code class="docutils literal notranslate"><span class="pre">jpype1</span></code> can be installed using <code class="docutils literal notranslate"><span class="pre">pip</span></code> like most Python libraries</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>jpype1
</pre></div>
</div>
<p>The most basic thing we can do with our <code class="docutils literal notranslate"><span class="pre">Simple</span></code> class is to
use the <code class="docutils literal notranslate"><span class="pre">Simple.getNumber</span></code> method from Python and see
if it will return the result.</p>
<p>To do so, we can create a <code class="docutils literal notranslate"><span class="pre">simple.py</span></code> file which uses <code class="docutils literal notranslate"><span class="pre">jpype</span></code> to
import the <code class="docutils literal notranslate"><span class="pre">Simple</span></code> class from <code class="docutils literal notranslate"><span class="pre">Simple.class</span></code> file and invoke
the <code class="docutils literal notranslate"><span class="pre">Simple.getNumber</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jpype</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jpype.types</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">jpype</span><span class="o">.</span><span class="n">startJVM</span><span class="p">(</span><span class="n">classpath</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./&quot;</span><span class="p">])</span>

<span class="n">Simple</span> <span class="o">=</span> <span class="n">JClass</span><span class="p">(</span><span class="s1">&#39;Simple&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Simple</span><span class="o">.</span><span class="n">getNumber</span><span class="p">())</span>
</pre></div>
</div>
<p>Running the <code class="docutils literal notranslate"><span class="pre">simple.py</span></code> file will show how our Python code is able
to access the <code class="docutils literal notranslate"><span class="pre">Java</span></code> method and print the expected result:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>simple.py
<span class="go">4</span>
</pre></div>
</div>
</section>
<section id="java-to-python-using-pyarrow-jvm">
<h2>Java to Python using pyarrow.jvm<a class="headerlink" href="#java-to-python-using-pyarrow-jvm" title="Permalink to this heading">#</a></h2>
<p>PyArrow provides a <code class="docutils literal notranslate"><span class="pre">pyarrow.jvm</span></code> module that makes easier to
interact with Java classes and convert the Java objects to actual
Python objects.</p>
<p>To showcase <code class="docutils literal notranslate"><span class="pre">pyarrow.jvm</span></code> we could create a more complex
class, named <code class="docutils literal notranslate"><span class="pre">FillTen.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.memory.RootAllocator</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.vector.BigIntVector</span><span class="p">;</span>


<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FillTen</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">RootAllocator</span><span class="w"> </span><span class="n">allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RootAllocator</span><span class="p">();</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">BigIntVector</span><span class="w"> </span><span class="nf">createArray</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">BigIntVector</span><span class="w"> </span><span class="n">intVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigIntVector</span><span class="p">(</span><span class="s">&quot;ints&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">allocator</span><span class="p">);</span>
<span class="w">        </span><span class="n">intVector</span><span class="p">.</span><span class="na">allocateNew</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="w">        </span><span class="n">intVector</span><span class="p">.</span><span class="na">setValueCount</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="w">        </span><span class="n">FillTen</span><span class="p">.</span><span class="na">fillVector</span><span class="p">(</span><span class="n">intVector</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">intVector</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fillVector</span><span class="p">(</span><span class="n">BigIntVector</span><span class="w"> </span><span class="n">iv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This class provides a public <code class="docutils literal notranslate"><span class="pre">createArray</span></code> method that anyone can invoke
to get back an array containing numbers from 1 to 10.</p>
<p>Given that this class now has a dependency on a bunch of packages,
compiling it with <code class="docutils literal notranslate"><span class="pre">javac</span></code> is not enough anymore. We need to create
a dedicated <code class="docutils literal notranslate"><span class="pre">pom.xml</span></code> file where we can collect the dependencies:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;project&gt;</span>
<span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.arrow.py2java<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>FillTen<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>

<span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<span class="w">        </span><span class="nt">&lt;maven.compiler.source&gt;</span>8<span class="nt">&lt;/maven.compiler.source&gt;</span>
<span class="w">        </span><span class="nt">&lt;maven.compiler.target&gt;</span>8<span class="nt">&lt;/maven.compiler.target&gt;</span>
<span class="w">    </span><span class="nt">&lt;/properties&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.arrow<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>arrow-memory<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>8.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.arrow<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>arrow-memory-netty<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>8.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>jar<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.arrow<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>arrow-vector<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>8.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.arrow<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>arrow-c-data<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>8.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>jar<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<p>Once the <code class="docutils literal notranslate"><span class="pre">FillTen.java</span></code> file with the class is created
as <code class="docutils literal notranslate"><span class="pre">src/main/java/FillTen.java</span></code> we can use <code class="docutils literal notranslate"><span class="pre">maven</span></code> to
compile the project with <code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">package</span></code> and get it
available in the <code class="docutils literal notranslate"><span class="pre">target</span></code> directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mvn<span class="w"> </span>package
<span class="go">[INFO] Scanning for projects...</span>
<span class="go">[INFO]</span>
<span class="go">[INFO] ------------------&lt; org.apache.arrow.py2java:FillTen &gt;------------------</span>
<span class="go">[INFO] Building FillTen 1</span>
<span class="go">[INFO] --------------------------------[ jar ]---------------------------------</span>
<span class="go">[INFO]</span>
<span class="go">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ FillTen ---</span>
<span class="go">[INFO] Changes detected - recompiling the module!</span>
<span class="go">[INFO] Compiling 1 source file to /experiments/java2py/target/classes</span>
<span class="go">[INFO]</span>
<span class="go">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ FillTen ---</span>
<span class="go">[INFO] Building jar: /experiments/java2py/target/FillTen-1.jar</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] BUILD SUCCESS</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>Now that we have the package built, we can make it available to Python.
To do so, we need to make sure that not only the package itself is available,
but that also its dependencies are.</p>
<p>We can use <code class="docutils literal notranslate"><span class="pre">maven</span></code> to collect all dependencies and make them available in a single place
(the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> directory) so that we can more easily load them from Python:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mvn<span class="w"> </span>org.apache.maven.plugins:maven-dependency-plugin:2.7:copy-dependencies<span class="w"> </span>-DoutputDirectory<span class="o">=</span>dependencies
<span class="go">[INFO] Scanning for projects...</span>
<span class="go">[INFO]</span>
<span class="go">[INFO] ------------------&lt; org.apache.arrow.py2java:FillTen &gt;------------------</span>
<span class="go">[INFO] Building FillTen 1</span>
<span class="go">[INFO] --------------------------------[ jar ]---------------------------------</span>
<span class="go">[INFO]</span>
<span class="go">[INFO] --- maven-dependency-plugin:2.7:copy-dependencies (default-cli) @ FillTen ---</span>
<span class="go">[INFO] Copying jsr305-3.0.2.jar to /experiments/java2py/dependencies/jsr305-3.0.2.jar</span>
<span class="go">[INFO] Copying netty-common-4.1.72.Final.jar to /experiments/java2py/dependencies/netty-common-4.1.72.Final.jar</span>
<span class="go">[INFO] Copying arrow-memory-core-8.0.0-SNAPSHOT.jar to /experiments/java2py/dependencies/arrow-memory-core-8.0.0-SNAPSHOT.jar</span>
<span class="go">[INFO] Copying arrow-vector-8.0.0-SNAPSHOT.jar to /experiments/java2py/dependencies/arrow-vector-8.0.0-SNAPSHOT.jar</span>
<span class="go">[INFO] Copying arrow-c-data-8.0.0-SNAPSHOT.jar to /experiments/java2py/dependencies/arrow-c-data-8.0.0-SNAPSHOT.jar</span>
<span class="go">[INFO] Copying arrow-vector-8.0.0-SNAPSHOT.pom to /experiments/java2py/dependencies/arrow-vector-8.0.0-SNAPSHOT.pom</span>
<span class="go">[INFO] Copying jackson-core-2.11.4.jar to /experiments/java2py/dependencies/jackson-core-2.11.4.jar</span>
<span class="go">[INFO] Copying jackson-annotations-2.11.4.jar to /experiments/java2py/dependencies/jackson-annotations-2.11.4.jar</span>
<span class="go">[INFO] Copying slf4j-api-1.7.25.jar to /experiments/java2py/dependencies/slf4j-api-1.7.25.jar</span>
<span class="go">[INFO] Copying arrow-memory-netty-8.0.0-SNAPSHOT.jar to /experiments/java2py/dependencies/arrow-memory-netty-8.0.0-SNAPSHOT.jar</span>
<span class="go">[INFO] Copying arrow-format-8.0.0-SNAPSHOT.jar to /experiments/java2py/dependencies/arrow-format-8.0.0-SNAPSHOT.jar</span>
<span class="go">[INFO] Copying flatbuffers-java-1.12.0.jar to /experiments/java2py/dependencies/flatbuffers-java-1.12.0.jar</span>
<span class="go">[INFO] Copying arrow-memory-8.0.0-SNAPSHOT.pom to /experiments/java2py/dependencies/arrow-memory-8.0.0-SNAPSHOT.pom</span>
<span class="go">[INFO] Copying netty-buffer-4.1.72.Final.jar to /experiments/java2py/dependencies/netty-buffer-4.1.72.Final.jar</span>
<span class="go">[INFO] Copying jackson-databind-2.11.4.jar to /experiments/java2py/dependencies/jackson-databind-2.11.4.jar</span>
<span class="go">[INFO] Copying commons-codec-1.10.jar to /experiments/java2py/dependencies/commons-codec-1.10.jar</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] BUILD SUCCESS</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Instead of manually collecting dependencies, you could also rely on the
<code class="docutils literal notranslate"><span class="pre">maven-assembly-plugin</span></code> to build a single <code class="docutils literal notranslate"><span class="pre">jar</span></code> with all dependencies.</p>
</div>
<p>Once our package and all its dependencies are available,
we can invoke it from <code class="docutils literal notranslate"><span class="pre">fillten_pyarrowjvm.py</span></code> script that will
import the <code class="docutils literal notranslate"><span class="pre">FillTen</span></code> class and print out the result of invoking <code class="docutils literal notranslate"><span class="pre">FillTen.createArray</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jpype</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jpype.imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jpype.types</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Start a JVM making available all dependencies we collected</span>
<span class="c1"># and our class from target/FillTen-1.jar</span>
<span class="n">jpype</span><span class="o">.</span><span class="n">startJVM</span><span class="p">(</span><span class="n">classpath</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./dependencies/*&quot;</span><span class="p">,</span> <span class="s2">&quot;./target/*&quot;</span><span class="p">])</span>

<span class="n">FillTen</span> <span class="o">=</span> <span class="n">JClass</span><span class="p">(</span><span class="s1">&#39;FillTen&#39;</span><span class="p">)</span>

<span class="n">array</span> <span class="o">=</span> <span class="n">FillTen</span><span class="o">.</span><span class="n">createArray</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ARRAY&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">array</span><span class="p">)</span>

<span class="c1"># Convert the proxied BigIntVector to an actual pyarrow array</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.jvm</span>
<span class="n">pyarray</span> <span class="o">=</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ARRAY&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">pyarray</span><span class="p">),</span> <span class="n">pyarray</span><span class="p">)</span>
<span class="k">del</span> <span class="n">pyarray</span>
</pre></div>
</div>
<p>Running the python script will lead to two lines getting printed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ARRAY &lt;java class &#39;org.apache.arrow.vector.BigIntVector&#39;&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
ARRAY &lt;class &#39;pyarrow.lib.Int64Array&#39;&gt; [
    1,
    2,
    3,
    4,
    5,
    6,
    7,
    8,
    9,
    10
]
</pre></div>
</div>
<p>The first line is the raw result of invoking the <code class="docutils literal notranslate"><span class="pre">FillTen.createArray</span></code> method.
The resulting object is a proxy to the actual Java object, so it’s not really a pyarrow
Array, it will lack most of its capabilities and methods.
That’s why we subsequently use <code class="docutils literal notranslate"><span class="pre">pyarrow.jvm.array</span></code> to convert it to an actual
<code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> array. That allows us to treat it like any other <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> array.
The result is the second line in the output where the array is correctly reported
as being of type <code class="docutils literal notranslate"><span class="pre">pyarrow.lib.Int64Array</span></code> and is printed using the <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> style.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the moment the <code class="docutils literal notranslate"><span class="pre">pyarrow.jvm</span></code> module is fairly limited in capabilities,
nested types like structs are not supported and it only works on a JVM running
within the same process like JPype.</p>
</div>
</section>
<section id="java-to-python-communication-using-the-c-data-interface">
<h2>Java to Python communication using the C Data Interface<a class="headerlink" href="#java-to-python-communication-using-the-c-data-interface" title="Permalink to this heading">#</a></h2>
<p>The C Data Interface is a protocol implemented in Arrow to exchange data within different
environments without the cost of marshaling and copying data.</p>
<p>This allows to expose data coming from Python or Java to functions that are implemented
in the other language.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the future the <code class="docutils literal notranslate"><span class="pre">pyarrow.jvm</span></code> will be implemented to leverage the C Data
interface, at the moment is instead specifically written for JPype</p>
</div>
<p>To showcase how C Data works, we are going to tweak a bit both our <code class="docutils literal notranslate"><span class="pre">FillTen</span></code> Java
class and our <code class="docutils literal notranslate"><span class="pre">fillten.py</span></code> Python script. Given a PyArrow array, we are going to
expose a function in Java that sets its content to by the numbers from 1 to 10.</p>
<p>Using C Data interface in <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> at the moment requires installing <code class="docutils literal notranslate"><span class="pre">cffi</span></code>
explicitly, like most Python distributions it can be installed with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>cffi
</pre></div>
</div>
<p>The first thing we would have to do is to tweak the Python script so that it
sends to Java the exported references to the Array and its Schema according to the
C Data interface:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jpype</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jpype.imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jpype.types</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Init the JVM and make FillTen class available to Python.</span>
<span class="n">jpype</span><span class="o">.</span><span class="n">startJVM</span><span class="p">(</span><span class="n">classpath</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./dependencies/*&quot;</span><span class="p">,</span> <span class="s2">&quot;./target/*&quot;</span><span class="p">])</span>
<span class="n">FillTen</span> <span class="o">=</span> <span class="n">JClass</span><span class="p">(</span><span class="s1">&#39;FillTen&#39;</span><span class="p">)</span>

<span class="c1"># Create a Python array of 10 elements</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyarrow.cffi</span><span class="w"> </span><span class="kn">import</span> <span class="n">ffi</span> <span class="k">as</span> <span class="n">arrow_c</span>

<span class="c1"># Export the Python array through C Data</span>
<span class="n">c_array</span> <span class="o">=</span> <span class="n">arrow_c</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;struct ArrowArray*&quot;</span><span class="p">)</span>
<span class="n">c_array_ptr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrow_c</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;uintptr_t&quot;</span><span class="p">,</span> <span class="n">c_array</span><span class="p">))</span>
<span class="n">array</span><span class="o">.</span><span class="n">_export_to_c</span><span class="p">(</span><span class="n">c_array_ptr</span><span class="p">)</span>

<span class="c1"># Export the Schema of the Array through C Data</span>
<span class="n">c_schema</span> <span class="o">=</span> <span class="n">arrow_c</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;struct ArrowSchema*&quot;</span><span class="p">)</span>
<span class="n">c_schema_ptr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrow_c</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;uintptr_t&quot;</span><span class="p">,</span> <span class="n">c_schema</span><span class="p">))</span>
<span class="n">array</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_export_to_c</span><span class="p">(</span><span class="n">c_schema_ptr</span><span class="p">)</span>

<span class="c1"># Send Array and its Schema to the Java function</span>
<span class="c1"># that will populate the array with numbers from 1 to 10</span>
<span class="n">FillTen</span><span class="o">.</span><span class="n">fillCArray</span><span class="p">(</span><span class="n">c_array_ptr</span><span class="p">,</span> <span class="n">c_schema_ptr</span><span class="p">)</span>

<span class="c1"># See how the content of our Python array was changed from Java</span>
<span class="c1"># while it remained of the Python type.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ARRAY&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Changing content of arrays is not a safe operation, it was done
for the purpose of creating this example, and it mostly works only
because the array hasn’t changed size, type or nulls.</p>
</div>
<p>In the FillTen Java class, we already have the <code class="docutils literal notranslate"><span class="pre">fillVector</span></code>
method, but that method is private and even if we made it public it
would only accept a <code class="docutils literal notranslate"><span class="pre">BigIntVector</span></code> object and not the C Data array
and schema references.</p>
<p>So we have to expand our <code class="docutils literal notranslate"><span class="pre">FillTen</span></code> class adding a <code class="docutils literal notranslate"><span class="pre">fillCArray</span></code>
method that is able to perform the work of <code class="docutils literal notranslate"><span class="pre">fillVector</span></code> but
on the C Data exchanged entities instead of the <code class="docutils literal notranslate"><span class="pre">BigIntVector</span></code> one:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.c.ArrowArray</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.c.ArrowSchema</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.c.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.memory.RootAllocator</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.vector.FieldVector</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.vector.BigIntVector</span><span class="p">;</span>


<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FillTen</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">RootAllocator</span><span class="w"> </span><span class="n">allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RootAllocator</span><span class="p">();</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fillCArray</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">c_array_ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">c_schema_ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ArrowArray</span><span class="w"> </span><span class="n">arrow_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArrowArray</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">c_array_ptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ArrowSchema</span><span class="w"> </span><span class="n">arrow_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArrowSchema</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">c_schema_ptr</span><span class="p">);</span>

<span class="w">        </span><span class="n">FieldVector</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">importVector</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="n">arrow_array</span><span class="p">,</span><span class="w"> </span><span class="n">arrow_schema</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">        </span><span class="n">FillTen</span><span class="p">.</span><span class="na">fillVector</span><span class="p">((</span><span class="n">BigIntVector</span><span class="p">)</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fillVector</span><span class="p">(</span><span class="n">BigIntVector</span><span class="w"> </span><span class="n">iv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">);</span>
<span class="w">        </span><span class="n">iv</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The goal of the <code class="docutils literal notranslate"><span class="pre">fillCArray</span></code> method is to get the Array and Schema received in
C Data exchange format and turn them back to an object of type <code class="docutils literal notranslate"><span class="pre">FieldVector</span></code>
so that Arrow Java knows how to deal with it.</p>
<p>If we run again <code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">package</span></code>, update the maven dependencies
and then our Python script, we should be able to see how the
values printed by the Python script have been properly changed by the Java code:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mvn<span class="w"> </span>package
<span class="gp">$ </span>mvn<span class="w"> </span>org.apache.maven.plugins:maven-dependency-plugin:2.7:copy-dependencies<span class="w"> </span>-DoutputDirectory<span class="o">=</span>dependencies
<span class="gp">$ </span>python<span class="w"> </span>fillten.py
<span class="go">ARRAY &lt;class &#39;pyarrow.lib.Int64Array&#39;&gt; [</span>
<span class="go">    1,</span>
<span class="go">    2,</span>
<span class="go">    3,</span>
<span class="go">    4,</span>
<span class="go">    5,</span>
<span class="go">    6,</span>
<span class="go">    7,</span>
<span class="go">    8,</span>
<span class="go">    9,</span>
<span class="go">    10</span>
<span class="go">]</span>
</pre></div>
</div>
<p>We can also use the C Stream Interface to exchange
<a class="reference internal" href="../generated/pyarrow.RecordBatchReader.html#pyarrow.RecordBatchReader" title="pyarrow.RecordBatchReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyarrow.RecordBatchReader</span></code></a> between Java and Python.  We’ll
use this Java class as a demo, which lets you read an Arrow IPC file
via Java’s implementation, or write data to a JSON file:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.File</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.file.Files</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.file.Paths</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.c.ArrowArrayStream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.c.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.memory.BufferAllocator</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.memory.RootAllocator</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.vector.ipc.ArrowFileReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.vector.ipc.ArrowReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.arrow.vector.ipc.JsonFileWriter</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PythonInteropDemo</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AutoCloseable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BufferAllocator</span><span class="w"> </span><span class="n">allocator</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">PythonInteropDemo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RootAllocator</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exportStream</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">cStreamPointer</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">ArrowArrayStream</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArrowArrayStream</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">cStreamPointer</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">ArrowFileReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrowFileReader</span><span class="p">(</span><span class="n">Files</span><span class="p">.</span><span class="na">newByteChannel</span><span class="p">(</span><span class="n">Paths</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">path</span><span class="p">)),</span><span class="w"> </span><span class="n">allocator</span><span class="p">);</span>
<span class="w">      </span><span class="n">Data</span><span class="p">.</span><span class="na">exportArrayStream</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">importStream</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">cStreamPointer</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">ArrowArrayStream</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArrowArrayStream</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">cStreamPointer</span><span class="p">);</span>
<span class="w">         </span><span class="kd">final</span><span class="w"> </span><span class="n">ArrowReader</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="na">importArrayStream</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">);</span>
<span class="w">         </span><span class="n">JsonFileWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonFileWriter</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">writer</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getVectorSchemaRoot</span><span class="p">().</span><span class="na">getSchema</span><span class="p">(),</span><span class="w"> </span><span class="n">input</span><span class="p">);</span>
<span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">loadNextBatch</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">writer</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getVectorSchemaRoot</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">allocator</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On the Python side, we’ll use JPype as before, except this time we’ll
send RecordBatchReaders back and forth:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jpype</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jpype.imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jpype.types</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Init the JVM and make demo class available to Python.</span>
<span class="n">jpype</span><span class="o">.</span><span class="n">startJVM</span><span class="p">(</span><span class="n">classpath</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./dependencies/*&quot;</span><span class="p">,</span> <span class="s2">&quot;./target/*&quot;</span><span class="p">])</span>
<span class="n">PythonInteropDemo</span> <span class="o">=</span> <span class="n">JClass</span><span class="p">(</span><span class="s2">&quot;PythonInteropDemo&quot;</span><span class="p">)</span>
<span class="n">demo</span> <span class="o">=</span> <span class="n">PythonInteropDemo</span><span class="p">()</span>

<span class="c1"># Create a Python record batch reader</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">schema</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;ints&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">int64</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;strs&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">string</span><span class="p">())</span>
<span class="p">])</span>
<span class="n">batches</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">pa</span><span class="o">.</span><span class="n">record_batch</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">],</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">),</span>
    <span class="n">pa</span><span class="o">.</span><span class="n">record_batch</span><span class="p">([</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">],</span>
    <span class="p">],</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchReader</span><span class="o">.</span><span class="n">from_batches</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">batches</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyarrow.cffi</span><span class="w"> </span><span class="kn">import</span> <span class="n">ffi</span> <span class="k">as</span> <span class="n">arrow_c</span>

<span class="c1"># Export the Python reader through C Data</span>
<span class="n">c_stream</span> <span class="o">=</span> <span class="n">arrow_c</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;struct ArrowArrayStream*&quot;</span><span class="p">)</span>
<span class="n">c_stream_ptr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrow_c</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;uintptr_t&quot;</span><span class="p">,</span> <span class="n">c_stream</span><span class="p">))</span>
<span class="n">reader</span><span class="o">.</span><span class="n">_export_to_c</span><span class="p">(</span><span class="n">c_stream_ptr</span><span class="p">)</span>

<span class="c1"># Send reader to the Java function that writes a JSON file</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp</span><span class="p">:</span>
    <span class="n">demo</span><span class="o">.</span><span class="n">importStream</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c_stream_ptr</span><span class="p">)</span>

    <span class="c1"># Read the JSON file back</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">source</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JSON file written by Java:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>


<span class="c1"># Write an Arrow IPC file for Java to read</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">pa</span><span class="o">.</span><span class="n">ipc</span><span class="o">.</span><span class="n">new_file</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">sink</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="n">sink</span><span class="o">.</span><span class="n">write_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

    <span class="n">demo</span><span class="o">.</span><span class="n">exportStream</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c_stream_ptr</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchReader</span><span class="o">.</span><span class="n">_import_from_c</span><span class="p">(</span><span class="n">c_stream_ptr</span><span class="p">)</span> <span class="k">as</span> <span class="n">source</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IPC file read by Java:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read_all</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mvn<span class="w"> </span>package
<span class="gp">$ </span>mvn<span class="w"> </span>org.apache.maven.plugins:maven-dependency-plugin:2.7:copy-dependencies<span class="w"> </span>-DoutputDirectory<span class="o">=</span>dependencies
<span class="gp">$ </span>python<span class="w"> </span>demo.py
<span class="go">JSON file written by Java:</span>
<span class="go">{&quot;schema&quot;:{&quot;fields&quot;:[{&quot;name&quot;:&quot;ints&quot;,&quot;nullable&quot;:true,&quot;type&quot;:{&quot;name&quot;:&quot;int&quot;,&quot;bitWidth&quot;:64,&quot;isSigned&quot;:true},&quot;children&quot;:[]},{&quot;name&quot;:&quot;strs&quot;,&quot;nullable&quot;:true,&quot;type&quot;:{&quot;name&quot;:&quot;utf8&quot;},&quot;children&quot;:[]}]},&quot;batches&quot;:[{&quot;count&quot;:4,&quot;columns&quot;:[{&quot;name&quot;:&quot;ints&quot;,&quot;count&quot;:4,&quot;VALIDITY&quot;:[1,1,1,1],&quot;DATA&quot;:[&quot;0&quot;,&quot;2&quot;,&quot;4&quot;,&quot;8&quot;]},{&quot;name&quot;:&quot;strs&quot;,&quot;count&quot;:4,&quot;VALIDITY&quot;:[1,1,1,0],&quot;OFFSET&quot;:[0,1,2,3,3],&quot;DATA&quot;:[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;&quot;]}]},{&quot;count&quot;:4,&quot;columns&quot;:[{&quot;name&quot;:&quot;ints&quot;,&quot;count&quot;:4,&quot;VALIDITY&quot;:[0,1,1,0],&quot;DATA&quot;:[&quot;0&quot;,&quot;32&quot;,&quot;64&quot;,&quot;0&quot;]},{&quot;name&quot;:&quot;strs&quot;,&quot;count&quot;:4,&quot;VALIDITY&quot;:[1,0,0,1],&quot;OFFSET&quot;:[0,1,1,1,2],&quot;DATA&quot;:[&quot;e&quot;,&quot;&quot;,&quot;&quot;,&quot;h&quot;]}]}]}</span>
<span class="go">IPC file read by Java:</span>
<span class="go">pyarrow.Table</span>
<span class="go">ints: int64</span>
<span class="go">strs: string</span>
<span class="go">----</span>
<span class="go">ints: [[0,2,4,8],[null,32,64,null]]</span>
<span class="go">strs: [[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,null],[&quot;e&quot;,null,null,&quot;h&quot;]]</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#invoking-java-methods-from-python">Invoking Java methods from Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#java-to-python-using-pyarrow-jvm">Java to Python using pyarrow.jvm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#java-to-python-communication-using-the-c-data-interface">Java to Python communication using the C Data Interface</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow/edit/main/docs/source/python/integration/python_java.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2016-2025 Apache Software Foundation.
Apache Arrow, Arrow, Apache, the Apache feather logo, and the Apache Arrow project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>