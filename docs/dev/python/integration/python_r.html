

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Integrating PyArrow with R &#8212; Apache Arrow v21.0.0.dev194</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python/integration/python_r';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '/docs/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev/';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <link rel="canonical" href="https://arrow.apache.org/docs/python/integration/python_r.html" />
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="21.0.0.dev194" />

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    /* We explicitly disable cookie tracking to avoid privacy issues */
    _paq.push(['disableCookies']);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://analytics.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '20']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/arrow.png" class="logo__image only-light" alt="Apache Arrow v21.0.0.dev194 - Home"/>
    <img src="../../_static/arrow-dark.png" class="logo__image only-dark pst-js-only" alt="Apache Arrow v21.0.0.dev194 - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="substrait.html">Substrait</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Integrating PyArrow with R</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_java.html">Integrating PyArrow with Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Using pyarrow from C++ and Cython Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">CUDA Integration</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Integrating PyArrow with R</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="integrating-pyarrow-with-r">
<h1>Integrating PyArrow with R<a class="headerlink" href="#integrating-pyarrow-with-r" title="Permalink to this heading">#</a></h1>
<p>Arrow supports exchanging data within the same process through the
<a class="reference internal" href="../../format/CDataInterface.html#c-data-interface"><span class="std std-ref">The Arrow C data interface</span></a>.</p>
<p>This can be used to exchange data between Python and R functions and
methods so that the two languages can interact without any cost of
marshaling and unmarshaling data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The article takes for granted that you have a <code class="docutils literal notranslate"><span class="pre">Python</span></code> environment
with <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> correctly installed and an <code class="docutils literal notranslate"><span class="pre">R</span></code> environment with
<code class="docutils literal notranslate"><span class="pre">arrow</span></code> library correctly installed.
See <a class="reference external" href="https://arrow.apache.org/docs/python/install.html">Python Install Instructions</a>
and <a class="reference external" href="https://arrow.apache.org/docs/r/#installation">R Install instructions</a>
for further details.</p>
</div>
<section id="invoking-r-functions-from-python">
<h2>Invoking R functions from Python<a class="headerlink" href="#invoking-r-functions-from-python" title="Permalink to this heading">#</a></h2>
<p>Suppose we have a simple R function receiving an Arrow Array to
add <code class="docutils literal notranslate"><span class="pre">3</span></code> to all its elements:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>

<span class="n">addthree</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">arr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">3L</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We could save such a function in a <code class="docutils literal notranslate"><span class="pre">addthree.R</span></code> file so that we can
make it available for reuse.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">addthree.R</span></code> file is created we can invoke any of its functions
from Python using the
<a class="reference external" href="https://rpy2.github.io/doc/latest/html/index.html">rpy2</a> library which
enables a R runtime within the Python interpreter.</p>
<p><code class="docutils literal notranslate"><span class="pre">rpy2</span></code> can be installed using <code class="docutils literal notranslate"><span class="pre">pip</span></code> like most Python libraries</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>rpy2
</pre></div>
</div>
<p>The most basic thing we can do with our <code class="docutils literal notranslate"><span class="pre">addthree</span></code> function is to
invoke it from Python with a number and see how it will return the result.</p>
<p>To do so we can create an <code class="docutils literal notranslate"><span class="pre">addthree.py</span></code> file which uses <code class="docutils literal notranslate"><span class="pre">rpy2</span></code> to
import the <code class="docutils literal notranslate"><span class="pre">addthree</span></code> function from <code class="docutils literal notranslate"><span class="pre">addthree.R</span></code> file and invoke it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rpy2.robjects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">robjects</span>

<span class="c1"># Load the addthree.R file</span>
<span class="n">r_source</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
<span class="n">r_source</span><span class="p">(</span><span class="s2">&quot;addthree.R&quot;</span><span class="p">)</span>

<span class="c1"># Get a reference to the addthree function</span>
<span class="n">addthree</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;addthree&quot;</span><span class="p">]</span>

<span class="c1"># Invoke the function</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">addthree</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Access the returned value</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the <code class="docutils literal notranslate"><span class="pre">addthree.py</span></code> file will show how our Python code is able
to access the <code class="docutils literal notranslate"><span class="pre">R</span></code> function and print the expected result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>addthree.py
<span class="m">6</span>
</pre></div>
</div>
<p>If instead of passing around basic data types we want to pass around
Arrow Arrays, we can do so relying on the
<a class="reference external" href="https://rpy2.github.io/rpy2-arrow/version/main/html/index.html">rpy2-arrow</a>
module which implements <code class="docutils literal notranslate"><span class="pre">rpy2</span></code> support for Arrow types.</p>
<p><code class="docutils literal notranslate"><span class="pre">rpy2-arrow</span></code> can be installed through <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>rpy2-arrow
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rpy2-arrow</span></code> implements converters from PyArrow objects to R Arrow objects,
this is done without incurring any data copy cost as it relies on the
C Data interface.</p>
<p>To pass to the <code class="docutils literal notranslate"><span class="pre">addthree</span></code> function a PyArrow array, our <code class="docutils literal notranslate"><span class="pre">addthree.py</span></code> file needs to be modified
to enable <code class="docutils literal notranslate"><span class="pre">rpy2-arrow</span></code> converters and then pass the PyArrow array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rpy2.robjects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">robjects</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rpy2_arrow.pyarrow_rarrow</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">rarrow_to_py_array</span><span class="p">,</span>
                                       <span class="n">converter</span> <span class="k">as</span> <span class="n">arrowconverter</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rpy2.robjects.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">localconverter</span>

<span class="n">r_source</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
<span class="n">r_source</span><span class="p">(</span><span class="s2">&quot;addthree.R&quot;</span><span class="p">)</span>

<span class="n">addthree</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;addthree&quot;</span><span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span>

<span class="n">array</span> <span class="o">=</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Enable rpy2-arrow converter so that R can receive the array.</span>
<span class="k">with</span> <span class="n">localconverter</span><span class="p">(</span><span class="n">arrowconverter</span><span class="p">):</span>
    <span class="n">r_result</span> <span class="o">=</span> <span class="n">addthree</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="c1"># The result of the R function will be an R Environment</span>
<span class="c1"># we can convert the Environment back to a pyarrow Array</span>
<span class="c1"># using the rarrow_to_py_array function</span>
<span class="n">py_result</span> <span class="o">=</span> <span class="n">rarrow_to_py_array</span><span class="p">(</span><span class="n">r_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RESULT&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">py_result</span><span class="p">),</span> <span class="n">py_result</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the newly modified <code class="docutils literal notranslate"><span class="pre">addthree.py</span></code> should now properly execute
the R function and print the resulting PyArrow Array:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>addthree.py
RESULT<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">&#39;pyarrow.lib.Int64Array&#39;</span>&gt;<span class="w"> </span><span class="o">[</span>
<span class="w">  </span><span class="m">4</span>,
<span class="w">  </span><span class="m">5</span>,
<span class="w">  </span><span class="m">6</span>
<span class="o">]</span>
</pre></div>
</div>
<p>For additional information you can refer to
<a class="reference external" href="https://rpy2.github.io/doc/latest/html/index.html">rpy2 Documentation</a>
and <a class="reference external" href="https://rpy2.github.io/rpy2-arrow/version/main/html/index.html">rpy2-arrow Documentation</a></p>
</section>
<section id="invoking-python-functions-from-r">
<h2>Invoking Python functions from R<a class="headerlink" href="#invoking-python-functions-from-r" title="Permalink to this heading">#</a></h2>
<p>Exposing Python functions to R can be done through the <code class="docutils literal notranslate"><span class="pre">reticulate</span></code>
library. For example if we want to invoke <a class="reference internal" href="../generated/pyarrow.compute.add.html#pyarrow.compute.add" title="pyarrow.compute.add"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.compute.add()</span></code></a> from
R on an Array created in R we can do so importing <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> in R
through <code class="docutils literal notranslate"><span class="pre">reticulate</span></code>.</p>
<p>A basic <code class="docutils literal notranslate"><span class="pre">addthree.R</span></code> script that invokes <code class="docutils literal notranslate"><span class="pre">add</span></code> to add <code class="docutils literal notranslate"><span class="pre">3</span></code> to
an R array would look like:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load arrow and reticulate libraries</span>
<span class="nf">library</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">reticulate</span><span class="p">)</span>

<span class="c1"># Create a new array in R</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Array</span><span class="o">$</span><span class="nf">create</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span>

<span class="c1"># Make pyarrow.compute available to R</span>
<span class="n">pc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">import</span><span class="p">(</span><span class="s">&quot;pyarrow.compute&quot;</span><span class="p">)</span>

<span class="c1"># Invoke pyarrow.compute.add with the array and 3</span>
<span class="c1"># This will add 3 to all elements of the array and return a new Array</span>
<span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pc</span><span class="o">$</span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="c1"># Print the result to confirm it&#39;s what we expect</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Invoking the <code class="docutils literal notranslate"><span class="pre">addthree.R</span></code> script will print the outcome of adding
<code class="docutils literal notranslate"><span class="pre">3</span></code> to all the elements of the original <code class="docutils literal notranslate"><span class="pre">Array$create(c(1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code> array:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>R<span class="w"> </span>--silent<span class="w"> </span>-f<span class="w"> </span>addthree.R
Array
&lt;double&gt;
<span class="o">[</span>
<span class="w">  </span><span class="m">4</span>,
<span class="w">  </span><span class="m">5</span>,
<span class="w">  </span><span class="m">6</span>
<span class="o">]</span>
</pre></div>
</div>
<p>For additional information you can refer to
<a class="reference external" href="https://rstudio.github.io/reticulate/">Reticulate Documentation</a>
and to the <a class="reference external" href="https://arrow.apache.org/docs/r/articles/python.html#using">R Arrow documentation</a></p>
</section>
<section id="r-to-python-communication-using-the-c-data-interface">
<h2>R to Python communication using the C Data Interface<a class="headerlink" href="#r-to-python-communication-using-the-c-data-interface" title="Permalink to this heading">#</a></h2>
<p>Both solutions described above use the Arrow C Data
interface under the hood.</p>
<p>In case we want to extend the previous <code class="docutils literal notranslate"><span class="pre">addthree</span></code> example to switch
from using <code class="docutils literal notranslate"><span class="pre">rpy2-arrow</span></code> to using the plain C Data interface we can
do so by introducing some modifications to our codebase.</p>
<p>To enable importing the Arrow Array from the C Data interface we have to
wrap our <code class="docutils literal notranslate"><span class="pre">addthree</span></code> function in a function that does the extra work
necessary to import an Arrow Array in R from the C Data interface.</p>
<p>That work will be done by the <code class="docutils literal notranslate"><span class="pre">addthree_cdata</span></code> function which invokes the
<code class="docutils literal notranslate"><span class="pre">addthree</span></code> function once the Array is imported.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">addthree.R</span></code> will thus have both the <code class="docutils literal notranslate"><span class="pre">addthree_cdata</span></code> and the
<code class="docutils literal notranslate"><span class="pre">addthree</span></code> functions:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>

<span class="n">addthree_cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">array_ptr_s</span><span class="p">,</span><span class="w"> </span><span class="n">schema_ptr_s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Array</span><span class="o">$</span><span class="nf">import_from_c</span><span class="p">(</span><span class="n">array_ptr</span><span class="p">,</span><span class="w"> </span><span class="n">schema_ptr</span><span class="p">)</span>

<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="nf">addthree</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">addthree</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">arr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">3L</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now provide to R the array and its schema from Python through the
<code class="docutils literal notranslate"><span class="pre">array_ptr_s</span></code> and <code class="docutils literal notranslate"><span class="pre">schema_ptr_s</span></code> arguments so that R can build back
an <code class="docutils literal notranslate"><span class="pre">Array</span></code> from them and then invoke <code class="docutils literal notranslate"><span class="pre">addthree</span></code> with the array.</p>
<p>Invoking <code class="docutils literal notranslate"><span class="pre">addthree_cdata</span></code> from Python involves building the Array we
want to pass to <code class="docutils literal notranslate"><span class="pre">R</span></code>, exporting it to the C Data interface and then
passing the exported references to the <code class="docutils literal notranslate"><span class="pre">R</span></code> function.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">addthree.py</span></code> will thus become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a reference to the addthree_cdata R function</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rpy2.robjects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">robjects</span>
<span class="n">r_source</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
<span class="n">r_source</span><span class="p">(</span><span class="s2">&quot;addthree.R&quot;</span><span class="p">)</span>
<span class="n">addthree_cdata</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;addthree_cdata&quot;</span><span class="p">]</span>

<span class="c1"># Create the pyarrow array we want to pass to R</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Import the pyarrow module that provides access to the C Data interface</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyarrow.cffi</span><span class="w"> </span><span class="kn">import</span> <span class="n">ffi</span> <span class="k">as</span> <span class="n">arrow_c</span>

<span class="c1"># Allocate structures where we will export the Array data</span>
<span class="c1"># and the Array schema. They will be released when we exit the with block.</span>
<span class="k">with</span> <span class="n">arrow_c</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;struct ArrowArray*&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">c_array</span><span class="p">,</span> \
     <span class="n">arrow_c</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;struct ArrowSchema*&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">c_schema</span><span class="p">:</span>
    <span class="c1"># Get the references to the C Data structures.</span>
    <span class="n">c_array_ptr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrow_c</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;uintptr_t&quot;</span><span class="p">,</span> <span class="n">c_array</span><span class="p">))</span>
    <span class="n">c_schema_ptr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrow_c</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;uintptr_t&quot;</span><span class="p">,</span> <span class="n">c_schema</span><span class="p">))</span>

    <span class="c1"># Export the Array and its schema to the C Data structures.</span>
    <span class="n">array</span><span class="o">.</span><span class="n">_export_to_c</span><span class="p">(</span><span class="n">c_array_ptr</span><span class="p">)</span>
    <span class="n">array</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_export_to_c</span><span class="p">(</span><span class="n">c_schema_ptr</span><span class="p">)</span>

    <span class="c1"># Invoke the R addthree_cdata function passing the references</span>
    <span class="c1"># to the array and schema C Data structures.</span>
    <span class="c1"># Those references are passed as strings as R doesn&#39;t have</span>
    <span class="c1"># native support for 64bit integers, so the integers are</span>
    <span class="c1"># converted to their string representation for R to convert it back.</span>
    <span class="n">r_result_array</span> <span class="o">=</span> <span class="n">addthree_cdata</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c_array_ptr</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">c_schema_ptr</span><span class="p">))</span>

    <span class="c1"># r_result will be an Environment variable that contains the</span>
    <span class="c1"># arrow Array built from R as the return value of addthree.</span>
    <span class="c1"># To make it available as a Python pyarrow array we need to export</span>
    <span class="c1"># it as a C Data structure invoking the Array$export_to_c R method</span>
    <span class="n">r_result_array</span><span class="p">[</span><span class="s2">&quot;export_to_c&quot;</span><span class="p">](</span><span class="nb">str</span><span class="p">(</span><span class="n">c_array_ptr</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">c_schema_ptr</span><span class="p">))</span>

    <span class="c1"># Once the returned array is exported to a C Data infrastructure</span>
    <span class="c1"># we can import it back into pyarrow using Array._import_from_c</span>
    <span class="n">py_array</span> <span class="o">=</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">Array</span><span class="o">.</span><span class="n">_import_from_c</span><span class="p">(</span><span class="n">c_array_ptr</span><span class="p">,</span> <span class="n">c_schema_ptr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RESULT&quot;</span><span class="p">,</span> <span class="n">py_array</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the newly changed <code class="docutils literal notranslate"><span class="pre">addthree.py</span></code> will now print the Array resulting
from adding <code class="docutils literal notranslate"><span class="pre">3</span></code> to all the elements of the original
<code class="docutils literal notranslate"><span class="pre">pyarrow.array((1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code> array:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>addthree.py
R<span class="o">[</span>write<span class="w"> </span>to<span class="w"> </span>console<span class="o">]</span>:<span class="w"> </span>Attaching<span class="w"> </span>package:<span class="w"> </span>‘arrow’
RESULT<span class="w"> </span><span class="o">[</span>
<span class="w">  </span><span class="m">4</span>,
<span class="w">  </span><span class="m">5</span>,
<span class="w">  </span><span class="m">6</span>
<span class="o">]</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#invoking-r-functions-from-python">Invoking R functions from Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#invoking-python-functions-from-r">Invoking Python functions from R</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#r-to-python-communication-using-the-c-data-interface">R to Python communication using the C Data Interface</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow/edit/main/docs/source/python/integration/python_r.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2016-2025 Apache Software Foundation.
Apache Arrow, Arrow, Apache, the Apache feather logo, and the Apache Arrow project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>