

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Compute Functions &#8212; Apache Arrow v21.0.0.dev206</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python/compute';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '/docs/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev/';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <link rel="canonical" href="https://arrow.apache.org/docs/python/compute.html" />
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="21.0.0.dev206" />

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    /* We explicitly disable cookie tracking to avoid privacy issues */
    _paq.push(['disableCookies']);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://analytics.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '20']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/arrow.png" class="logo__image only-light" alt="Apache Arrow v21.0.0.dev206 - Home"/>
    <img src="../_static/arrow-dark.png" class="logo__image only-dark pst-js-only" alt="Apache Arrow v21.0.0.dev206 - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Compute Functions</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="compute-functions">
<span id="compute"></span><h1>Compute Functions<a class="headerlink" href="#compute-functions" title="Permalink to this heading">#</a></h1>
<p>Arrow supports logical compute operations over inputs of possibly
varying types.</p>
<p>The standard compute operations are provided by the <code class="xref py py-mod docutils literal notranslate"><span class="pre">pyarrow.compute</span></code>
module and can be used directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.compute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&lt;pyarrow.Int64Scalar: 7&gt;</span>
</pre></div>
</div>
<p>The grouped aggregation functions raise an exception instead
and need to be used through the <a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table.group_by" title="pyarrow.Table.group_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyarrow.Table.group_by()</span></code></a> capabilities.
See <a class="reference internal" href="#py-grouped-aggrs"><span class="std std-ref">Grouped Aggregations</span></a> for more details.</p>
<section id="standard-compute-functions">
<h2>Standard Compute Functions<a class="headerlink" href="#standard-compute-functions" title="Permalink to this heading">#</a></h2>
<p>Many compute functions support both array (chunked or not)
and scalar inputs, but some will mandate either.  For example,
<code class="docutils literal notranslate"><span class="pre">sort_indices</span></code> requires its first and only input to be an array.</p>
<p>Below are a few simple examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.compute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pc</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="go">&lt;pyarrow.lib.BooleanArray object at 0x7f686e4eef30&gt;</span>
<span class="go">[</span>
<span class="go">  false,</span>
<span class="go">  true,</span>
<span class="go">  true,</span>
<span class="go">  false</span>
<span class="go">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mf">7.8</span><span class="p">),</span> <span class="n">pa</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mf">9.3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pc</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="go">&lt;pyarrow.DoubleScalar: 72.54&gt;</span>
</pre></div>
</div>
<p>If you are using a compute function which returns more than one value, results
will be returned as a <code class="docutils literal notranslate"><span class="pre">StructScalar</span></code>.  You can extract the individual values by
calling the <a class="reference internal" href="generated/pyarrow.StructScalar.html#pyarrow.StructScalar.values" title="pyarrow.StructScalar.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyarrow.StructScalar.values()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.compute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pc</span><span class="o">.</span><span class="n">min_max</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&lt;pyarrow.StructScalar: [(&#39;min&#39;, 1), (&#39;max&#39;, 3)]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">min_max</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">&lt;pyarrow.Int64Scalar: 1&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">&lt;pyarrow.Int64Scalar: 3&gt;</span>
</pre></div>
</div>
<p>These functions can do more than just element-by-element operations.
Here is an example of sorting a table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.compute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;y&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">sort_indices</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;ascending&#39;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span>
<span class="go">&lt;pyarrow.lib.UInt64Array object at 0x7fcee5df75e8&gt;</span>
<span class="go">[</span>
<span class="go">  2,</span>
<span class="go">  1,</span>
<span class="go">  0</span>
<span class="go">]</span>
</pre></div>
</div>
<p>For a complete list of the compute functions that PyArrow provides
you can refer to <a class="reference internal" href="api/compute.html#api-compute"><span class="std std-ref">Compute Functions</span></a> reference.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../cpp/compute.html#compute-function-list"><span class="std std-ref">Available compute functions (C++ documentation)</span></a>.</p>
</div>
</section>
<section id="grouped-aggregations">
<span id="py-grouped-aggrs"></span><h2>Grouped Aggregations<a class="headerlink" href="#grouped-aggregations" title="Permalink to this heading">#</a></h2>
<p>PyArrow supports grouped aggregations over <a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table" title="pyarrow.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyarrow.Table</span></code></a> through the
<a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table.group_by" title="pyarrow.Table.group_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyarrow.Table.group_by()</span></code></a> method.
The method will return a grouping declaration
to which the hash aggregation functions can be applied:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">([</span>
<span class="gp">... </span>      <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]),</span>
<span class="gp">... </span>      <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
<span class="gp">... </span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;keys&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">)])</span>
<span class="go">pyarrow.Table</span>
<span class="go">values_sum: int64</span>
<span class="go">keys: string</span>
<span class="go">----</span>
<span class="go">values_sum: [[3,7,5]]</span>
<span class="go">keys: [[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;sum&quot;</span></code> aggregation passed to the <code class="docutils literal notranslate"><span class="pre">aggregate</span></code> method in the previous
example is the <code class="docutils literal notranslate"><span class="pre">hash_sum</span></code> compute function.</p>
<p>Multiple aggregations can be performed at the same time by providing them
to the <code class="docutils literal notranslate"><span class="pre">aggregate</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">([</span>
<span class="gp">... </span>      <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]),</span>
<span class="gp">... </span>      <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
<span class="gp">... </span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;keys&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
<span class="gp">... </span>   <span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">),</span>
<span class="gp">... </span>   <span class="p">(</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">])</span>
<span class="go">pyarrow.Table</span>
<span class="go">values_sum: int64</span>
<span class="go">keys_count: int64</span>
<span class="go">keys: string</span>
<span class="go">----</span>
<span class="go">values_sum: [[3,7,5]]</span>
<span class="go">keys_count: [[2,2,1]]</span>
<span class="go">keys: [[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]]</span>
</pre></div>
</div>
<p>Aggregation options can also be provided for each aggregation function,
for example we can use <a class="reference internal" href="generated/pyarrow.compute.CountOptions.html#pyarrow.compute.CountOptions" title="pyarrow.compute.CountOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">CountOptions</span></code></a> to change how we count
null values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.compute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table_with_nulls</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">([</span>
<span class="gp">... </span>   <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">]),</span>
<span class="gp">... </span>   <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<span class="gp">... </span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table_with_nulls</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s2">&quot;keys&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
<span class="gp">... </span>   <span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">pc</span><span class="o">.</span><span class="n">CountOptions</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">))</span>
<span class="gp">... </span><span class="p">])</span>
<span class="go">pyarrow.Table</span>
<span class="go">values_count: int64</span>
<span class="go">keys: string</span>
<span class="go">----</span>
<span class="go">values_count: [[3]]</span>
<span class="go">keys: [[&quot;a&quot;]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table_with_nulls</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s2">&quot;keys&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
<span class="gp">... </span>   <span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">pc</span><span class="o">.</span><span class="n">CountOptions</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;only_valid&quot;</span><span class="p">))</span>
<span class="gp">... </span><span class="p">])</span>
<span class="go">pyarrow.Table</span>
<span class="go">values_count: int64</span>
<span class="go">keys: string</span>
<span class="go">----</span>
<span class="go">values_count: [[1]]</span>
<span class="go">keys: [[&quot;a&quot;]]</span>
</pre></div>
</div>
<p>Following is a list of all supported grouped aggregation functions.
You can use them with or without the <code class="docutils literal notranslate"><span class="pre">&quot;hash_&quot;</span></code> prefix.</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 60.0%" />
<col style="width: 20.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>hash_all</p></td>
<td><p>Whether all elements in each group evaluate to true</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_any</p></td>
<td><p>Whether any element in each group evaluates to true</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_approximate_median</p></td>
<td><p>Compute approximate medians of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_count</p></td>
<td><p>Count the number of null / non-null values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.CountOptions.html#pyarrow.compute.CountOptions" title="pyarrow.compute.CountOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">CountOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_count_all</p></td>
<td><p>Count the number of rows in each group</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>hash_count_distinct</p></td>
<td><p>Count the distinct values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.CountOptions.html#pyarrow.compute.CountOptions" title="pyarrow.compute.CountOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">CountOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_distinct</p></td>
<td><p>Keep the distinct values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.CountOptions.html#pyarrow.compute.CountOptions" title="pyarrow.compute.CountOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">CountOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_first</p></td>
<td><p>Compute the first value in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_first_last</p></td>
<td><p>Compute the first and last of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_kurtosis</p></td>
<td><p>Compute the kurtosis of values in each group</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>hash_last</p></td>
<td><p>Compute the first value in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_list</p></td>
<td><p>List all values in each group</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>hash_max</p></td>
<td><p>Compute the minimum or maximum of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_mean</p></td>
<td><p>Compute the mean of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_min</p></td>
<td><p>Compute the minimum or maximum of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_min_max</p></td>
<td><p>Compute the minimum and maximum of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_one</p></td>
<td><p>Get one value from each group</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>hash_pivot_wider</p></td>
<td><p>Pivot values according to a pivot key column</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.PivotWiderOptions.html#pyarrow.compute.PivotWiderOptions" title="pyarrow.compute.PivotWiderOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">PivotWiderOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_product</p></td>
<td><p>Compute the product of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_skew</p></td>
<td><p>Compute the skewness of values in each group</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>hash_stddev</p></td>
<td><p>Compute the standard deviation of values in each group</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>hash_sum</p></td>
<td><p>Sum values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.ScalarAggregateOptions.html#pyarrow.compute.ScalarAggregateOptions" title="pyarrow.compute.ScalarAggregateOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarAggregateOptions</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>hash_tdigest</p></td>
<td><p>Compute approximate quantiles of values in each group</p></td>
<td><p><a class="reference internal" href="generated/pyarrow.compute.TDigestOptions.html#pyarrow.compute.TDigestOptions" title="pyarrow.compute.TDigestOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">TDigestOptions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>hash_variance</p></td>
<td><p>Compute the variance of values in each group</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="table-and-dataset-joins">
<span id="py-joins"></span><h2>Table and Dataset Joins<a class="headerlink" href="#table-and-dataset-joins" title="Permalink to this heading">#</a></h2>
<p>Both <a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table" title="pyarrow.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> and <a class="reference internal" href="generated/pyarrow.dataset.Dataset.html#pyarrow.dataset.Dataset" title="pyarrow.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> support
join operations through <a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table.join" title="pyarrow.Table.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.join()</span></code></a>
and <a class="reference internal" href="generated/pyarrow.dataset.Dataset.html#pyarrow.dataset.Dataset.join" title="pyarrow.dataset.Dataset.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dataset.join()</span></code></a> methods.</p>
<p>The methods accept a right table or dataset that will
be joined to the initial one and one or more keys that
should be used from the two entities to perform the join.</p>
<p>By default a <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">outer</span> <span class="pre">join</span></code> is performed, but itâ€™s possible
to ask for any of the supported join types:</p>
<ul class="simple">
<li><p>left semi</p></li>
<li><p>right semi</p></li>
<li><p>left anti</p></li>
<li><p>right anti</p></li>
<li><p>inner</p></li>
<li><p>left outer</p></li>
<li><p>right outer</p></li>
<li><p>full outer</p></li>
</ul>
<p>A basic join can be performed just by providing a table and a key
on which the join should be performed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>

<span class="n">table1</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                   <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">2022</span><span class="p">,</span> <span class="mi">2019</span><span class="p">]})</span>

<span class="n">table2</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                   <span class="s1">&#39;n_legs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                   <span class="s1">&#39;animal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Brittle stars&quot;</span><span class="p">,</span> <span class="s2">&quot;Centipede&quot;</span><span class="p">]})</span>

<span class="n">joined_table</span> <span class="o">=</span> <span class="n">table1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The result will be a new table created by joining <code class="docutils literal notranslate"><span class="pre">table1</span></code> with
<code class="docutils literal notranslate"><span class="pre">table2</span></code> on the <code class="docutils literal notranslate"><span class="pre">id</span></code> key with a <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">outer</span> <span class="pre">join</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyarrow</span><span class="o">.</span><span class="n">Table</span>
<span class="nb">id</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">year</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">n_legs</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">animal</span><span class="p">:</span> <span class="n">string</span>
<span class="o">----</span>
<span class="nb">id</span><span class="p">:</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">year</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2019</span><span class="p">,</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2022</span><span class="p">]]</span>
<span class="n">n_legs</span><span class="p">:</span> <span class="p">[[</span><span class="mi">5</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="n">null</span><span class="p">]]</span>
<span class="n">animal</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;Brittle stars&quot;</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="n">null</span><span class="p">]]</span>
</pre></div>
</div>
<p>We can perform additional type of joins, like <code class="docutils literal notranslate"><span class="pre">full</span> <span class="pre">outer</span> <span class="pre">join</span></code> by
passing them to the <code class="docutils literal notranslate"><span class="pre">join_type</span></code> argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s2">&quot;full outer&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In that case the result would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyarrow</span><span class="o">.</span><span class="n">Table</span>
<span class="nb">id</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">year</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">n_legs</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">animal</span><span class="p">:</span> <span class="n">string</span>
<span class="o">----</span>
<span class="nb">id</span><span class="p">:</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span>
<span class="n">year</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2019</span><span class="p">,</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2022</span><span class="p">,</span><span class="n">null</span><span class="p">]]</span>
<span class="n">n_legs</span><span class="p">:</span> <span class="p">[[</span><span class="mi">5</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="mi">100</span><span class="p">]]</span>
<span class="n">animal</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;Brittle stars&quot;</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="s2">&quot;Centipede&quot;</span><span class="p">]]</span>
</pre></div>
</div>
<p>Itâ€™s also possible to provide additional join keys, so that the
join happens on two keys instead of one. For example we can add
an <code class="docutils literal notranslate"><span class="pre">year</span></code> column to <code class="docutils literal notranslate"><span class="pre">table2</span></code> so that we can join on <code class="docutils literal notranslate"><span class="pre">('id',</span> <span class="pre">'year')</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table2_withyear</span> <span class="o">=</span> <span class="n">table2</span><span class="o">.</span><span class="n">append_column</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">2022</span><span class="p">]))</span>
<span class="n">table1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">table2_withyear</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>The result will be a table where only entries with <code class="docutils literal notranslate"><span class="pre">id=3</span></code> and <code class="docutils literal notranslate"><span class="pre">year=2019</span></code>
have data, the rest will be <code class="docutils literal notranslate"><span class="pre">null</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyarrow</span><span class="o">.</span><span class="n">Table</span>
<span class="nb">id</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">year</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">animal</span><span class="p">:</span> <span class="n">string</span>
<span class="n">n_legs</span><span class="p">:</span> <span class="n">int64</span>
<span class="o">----</span>
<span class="nb">id</span><span class="p">:</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">year</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2019</span><span class="p">,</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2022</span><span class="p">]]</span>
<span class="n">animal</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;Brittle stars&quot;</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="n">null</span><span class="p">]]</span>
<span class="n">n_legs</span><span class="p">:</span> <span class="p">[[</span><span class="mi">5</span><span class="p">,</span><span class="n">null</span><span class="p">,</span><span class="n">null</span><span class="p">]]</span>
</pre></div>
</div>
<p>The same capabilities are available for <a class="reference internal" href="generated/pyarrow.dataset.Dataset.html#pyarrow.dataset.Dataset.join" title="pyarrow.dataset.Dataset.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dataset.join()</span></code></a> too, so you can
take two datasets and join them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.dataset</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ds</span>

<span class="n">ds1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">table1</span><span class="p">)</span>
<span class="n">ds2</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>

<span class="n">joined_ds</span> <span class="o">=</span> <span class="n">ds1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ds2</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting dataset will be an <a class="reference internal" href="generated/pyarrow.dataset.InMemoryDataset.html#pyarrow.dataset.InMemoryDataset" title="pyarrow.dataset.InMemoryDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">InMemoryDataset</span></code></a> containing the joined data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">joined_ds</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="go">pyarrow.Table</span>
<span class="go">id: int64</span>
<span class="go">year: int64</span>
<span class="go">animal: string</span>
<span class="go">n_legs: int64</span>
<span class="go">----</span>
<span class="go">id: [[3,1,2]]</span>
<span class="go">year: [[2019,2020,2022]]</span>
<span class="go">animal: [[&quot;Brittle stars&quot;,null,null]]</span>
<span class="go">n_legs: [[5,null,null]]</span>
</pre></div>
</div>
</section>
<section id="filtering-by-expressions">
<span id="py-filter-expr"></span><h2>Filtering by Expressions<a class="headerlink" href="#filtering-by-expressions" title="Permalink to this heading">#</a></h2>
<p><a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table" title="pyarrow.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> and <a class="reference internal" href="generated/pyarrow.dataset.Dataset.html#pyarrow.dataset.Dataset" title="pyarrow.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> can
both be filtered using a boolean <a class="reference internal" href="generated/pyarrow.dataset.Expression.html#pyarrow.dataset.Expression" title="pyarrow.dataset.Expression"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expression</span></code></a>.</p>
<p>The expression can be built starting from a
<a class="reference internal" href="generated/pyarrow.compute.field.html#pyarrow.compute.field" title="pyarrow.compute.field"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.compute.field()</span></code></a>. Comparisons and transformations
can then be applied to one or more fields to build the filter
expression you care about.</p>
<p>Most <a class="reference internal" href="#compute"><span class="std std-ref">Compute Functions</span></a> can be used to perform transformations
on a <code class="docutils literal notranslate"><span class="pre">field</span></code>.</p>
<p>For example we could build a filter to find all rows that are even
in column <code class="docutils literal notranslate"><span class="pre">&quot;nums&quot;</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.compute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>
<span class="n">even_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">bit_wise_and</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;nums&quot;</span><span class="p">),</span> <span class="n">pc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="n">pc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The filter finds even numbers by performing a bitwise and operation between the number and <code class="docutils literal notranslate"><span class="pre">1</span></code>.
As <code class="docutils literal notranslate"><span class="pre">1</span></code> is to <code class="docutils literal notranslate"><span class="pre">00000001</span></code> in binary form, only numbers that have the last bit set to <code class="docutils literal notranslate"><span class="pre">1</span></code>
will return a non-zero result from the <code class="docutils literal notranslate"><span class="pre">bit_wise_and</span></code> operation. This way we are identifying all
odd numbers. Given that we are interested in the even ones, we then check that the number returned
by the <code class="docutils literal notranslate"><span class="pre">bit_wise_and</span></code> operation equals <code class="docutils literal notranslate"><span class="pre">0</span></code>. Only the numbers where the last bit was <code class="docutils literal notranslate"><span class="pre">0</span></code> will
return a <code class="docutils literal notranslate"><span class="pre">0</span></code> as the result of <code class="docutils literal notranslate"><span class="pre">num</span> <span class="pre">&amp;</span> <span class="pre">1</span></code> and as all numbers where the last bit is <code class="docutils literal notranslate"><span class="pre">0</span></code> are
multiples of <code class="docutils literal notranslate"><span class="pre">2</span></code> we will be filtering for the even numbers only.</p>
</div>
<p>Once we have our filter, we can provide it to the <a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table.filter" title="pyarrow.Table.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.filter()</span></code></a> method
to filter our table only for the matching rows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s1">&#39;nums&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="s1">&#39;chars&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">even_filter</span><span class="p">)</span>
<span class="go">pyarrow.Table</span>
<span class="go">nums: int64</span>
<span class="go">chars: string</span>
<span class="go">----</span>
<span class="go">nums: [[2,4,6,8,10]]</span>
<span class="go">chars: [[&quot;b&quot;,&quot;d&quot;,&quot;f&quot;,&quot;h&quot;,&quot;l&quot;]]</span>
</pre></div>
</div>
<p>Multiple filters can be joined using <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">~</span></code> to perform <code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>
and <code class="docutils literal notranslate"><span class="pre">not</span></code> operations. For example using <code class="docutils literal notranslate"><span class="pre">~even_filter</span></code> will actually end up filtering
for all numbers that are odd:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">~</span><span class="n">even_filter</span><span class="p">)</span>
<span class="go">pyarrow.Table</span>
<span class="go">nums: int64</span>
<span class="go">chars: string</span>
<span class="go">----</span>
<span class="go">nums: [[1,3,5,7,9]]</span>
<span class="go">chars: [[&quot;a&quot;,&quot;c&quot;,&quot;e&quot;,&quot;g&quot;,&quot;i&quot;]]</span>
</pre></div>
</div>
<p>and we could build a filter that finds all even numbers greater than 5 by combining
our <code class="docutils literal notranslate"><span class="pre">even_filter</span></code> with a <code class="docutils literal notranslate"><span class="pre">pc.field(&quot;nums&quot;)</span> <span class="pre">&gt;</span> <span class="pre">5</span></code> filter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">even_filter</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;nums&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">))</span>
<span class="go">pyarrow.Table</span>
<span class="go">nums: int64</span>
<span class="go">chars: string</span>
<span class="go">----</span>
<span class="go">nums: [[6,8,10]]</span>
<span class="go">chars: [[&quot;f&quot;,&quot;h&quot;,&quot;l&quot;]]</span>
</pre></div>
</div>
<p><a class="reference internal" href="generated/pyarrow.dataset.Dataset.html#pyarrow.dataset.Dataset" title="pyarrow.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> can similarly be filtered with the <a class="reference internal" href="generated/pyarrow.dataset.Dataset.html#pyarrow.dataset.Dataset.filter" title="pyarrow.dataset.Dataset.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dataset.filter()</span></code></a> method.
The method will return an instance of <a class="reference internal" href="generated/pyarrow.dataset.Dataset.html#pyarrow.dataset.Dataset" title="pyarrow.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> which will lazily
apply the filter as soon as actual data of the dataset is accessed:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;nums&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;nums&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
<span class="go">pyarrow.Table</span>
<span class="go">nums: int64</span>
<span class="go">chars: string</span>
<span class="go">----</span>
<span class="go">nums: [[3,4]]</span>
<span class="go">chars: [[&quot;c&quot;,&quot;d&quot;]]</span>
</pre></div>
</div>
</section>
<section id="user-defined-functions">
<h2>User-Defined Functions<a class="headerlink" href="#user-defined-functions" title="Permalink to this heading">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This API is <strong>experimental</strong>.</p>
</div>
<p>PyArrow allows defining and registering custom compute functions.
These functions can then be called from Python as well as C++ (and potentially
any other implementation wrapping Arrow C++, such as the R <code class="docutils literal notranslate"><span class="pre">arrow</span></code> package)
using their registered function name.</p>
<p>UDF support is limited to scalar functions. A scalar function is a function which
executes elementwise operations on arrays or scalars. In general, the output of a
scalar function does not depend on the order of values in the arguments. Note that
such functions have a rough correspondence to the functions used in SQL expressions,
or to NumPy <a class="reference external" href="https://numpy.org/doc/stable/reference/ufuncs.html">universal functions</a>.</p>
<p>To register a UDF, a function name, function docs, input types and
output type need to be defined. Using <a class="reference internal" href="generated/pyarrow.compute.register_scalar_function.html#pyarrow.compute.register_scalar_function" title="pyarrow.compute.register_scalar_function"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.compute.register_scalar_function()</span></code></a>,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.compute</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>

<span class="n">function_name</span> <span class="o">=</span> <span class="s2">&quot;numpy_gcd&quot;</span>
<span class="n">function_docs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Calculates the greatest common divisor&quot;</span><span class="p">,</span>
      <span class="s2">&quot;description&quot;</span><span class="p">:</span>
         <span class="s2">&quot;Given &#39;x&#39; and &#39;y&#39; find the greatest number that divides</span><span class="se">\n</span><span class="s2">&quot;</span>
         <span class="s2">&quot;evenly into both x and y.&quot;</span>
<span class="p">}</span>

<span class="n">input_types</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;x&quot;</span> <span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">int64</span><span class="p">(),</span>
   <span class="s2">&quot;y&quot;</span> <span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">int64</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">output_type</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">int64</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">to_np</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">Scalar</span><span class="p">):</span>
       <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">as_py</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gcd_numpy</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">np_x</span> <span class="o">=</span> <span class="n">to_np</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">np_y</span> <span class="o">=</span> <span class="n">to_np</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">np_x</span><span class="p">,</span> <span class="n">np_y</span><span class="p">))</span>

<span class="n">pc</span><span class="o">.</span><span class="n">register_scalar_function</span><span class="p">(</span><span class="n">gcd_numpy</span><span class="p">,</span>
                           <span class="n">function_name</span><span class="p">,</span>
                           <span class="n">function_docs</span><span class="p">,</span>
                           <span class="n">input_types</span><span class="p">,</span>
                           <span class="n">output_type</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementation of a user-defined function always takes a first <em>context</em>
parameter (named <code class="docutils literal notranslate"><span class="pre">ctx</span></code> in the example above) which is an instance of
<a class="reference internal" href="generated/pyarrow.compute.UdfContext.html#pyarrow.compute.UdfContext" title="pyarrow.compute.UdfContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyarrow.compute.UdfContext</span></code></a>.
This context exposes several useful attributes, particularly a
<a class="reference internal" href="generated/pyarrow.compute.UdfContext.html#pyarrow.compute.UdfContext.memory_pool" title="pyarrow.compute.UdfContext.memory_pool"><code class="xref py py-attr docutils literal notranslate"><span class="pre">memory_pool</span></code></a> to be used for
allocations in the context of the user-defined function.</p>
<p>You can call a user-defined function directly using <code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.compute.call_function()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pc</span><span class="o">.</span><span class="n">call_function</span><span class="p">(</span><span class="s2">&quot;numpy_gcd&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">pa</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mi">27</span><span class="p">),</span> <span class="n">pa</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mi">63</span><span class="p">)])</span>
<span class="go">&lt;pyarrow.Int64Scalar: 9&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pc</span><span class="o">.</span><span class="n">call_function</span><span class="p">(</span><span class="s2">&quot;numpy_gcd&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">pa</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mi">27</span><span class="p">),</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">81</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">])])</span>
<span class="go">&lt;pyarrow.lib.Int64Array object at 0x7fcfa0e7b100&gt;</span>
<span class="go">[</span>
<span class="go">  27,</span>
<span class="go">  3,</span>
<span class="go">  1</span>
<span class="go">]</span>
</pre></div>
</div>
<section id="working-with-datasets">
<h3>Working with Datasets<a class="headerlink" href="#working-with-datasets" title="Permalink to this heading">#</a></h3>
<p>More generally, user-defined functions are usable everywhere a compute function
can be referred by its name. For example, they can be called on a datasetâ€™s
column using <code class="xref py py-meth docutils literal notranslate"><span class="pre">Expression._call()</span></code>.</p>
<p>Consider an instance where the data is in a table and we want to compute
the GCD of one column with the scalar value 30.  We will be re-using the
â€œnumpy_gcdâ€ user-defined function that was created above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.dataset</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_table</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">],</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">1827</span><span class="p">,</span> <span class="mi">2709</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">pc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">ds</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span><span class="o">.</span><span class="n">to_table</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>                <span class="s1">&#39;gcd_value&#39;</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="s2">&quot;numpy_gcd&quot;</span><span class="p">,</span> <span class="n">func_args</span><span class="p">),</span>
<span class="gp">... </span>                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
<span class="gp">... </span>                <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="p">})</span>
<span class="go">pyarrow.Table</span>
<span class="go">gcd_value: int64</span>
<span class="go">value: int64</span>
<span class="go">category: string</span>
<span class="go">----</span>
<span class="go">gcd_value: [[30,30,3,3]]</span>
<span class="go">value: [[90,630,1827,2709]]</span>
<span class="go">category: [[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;]]</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">ds.field('')._call(...)</span></code> returns a <code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.compute.Expression()</span></code>.
The arguments passed to this function call are expressions, not scalar values
(notice the difference between <a class="reference internal" href="generated/pyarrow.scalar.html#pyarrow.scalar" title="pyarrow.scalar"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.scalar()</span></code></a> and <a class="reference internal" href="generated/pyarrow.compute.scalar.html#pyarrow.compute.scalar" title="pyarrow.compute.scalar"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.compute.scalar()</span></code></a>,
the latter produces an expression).
This expression is evaluated when the projection operator executes it.</p>
<section id="projection-expressions">
<h4>Projection Expressions<a class="headerlink" href="#projection-expressions" title="Permalink to this heading">#</a></h4>
<p>In the above example we used an expression to add a new column (<code class="docutils literal notranslate"><span class="pre">gcd_value</span></code>)
to our table.  Adding new, dynamically computed, columns to a table is known as â€œprojectionâ€
and there are limitations on what kinds of functions can be used in projection expressions.
A projection function must emit a single output value for each input row.  That output value
should be calculated entirely from the input row and should not depend on any other row.
For example, the â€œnumpy_gcdâ€ function that weâ€™ve been using as an example above is a valid
function to use in a projection.  A â€œcumulative sumâ€ function would not be a valid function
since the result of each input row depends on the rows that came before.  A â€œdrop nullsâ€
function would also be invalid because it doesnâ€™t emit a value for some rows.</p>
</section>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-compute-functions">Standard Compute Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grouped-aggregations">Grouped Aggregations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-and-dataset-joins">Table and Dataset Joins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-by-expressions">Filtering by Expressions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#user-defined-functions">User-Defined Functions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-datasets">Working with Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#projection-expressions">Projection Expressions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow/edit/main/docs/source/python/compute.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2016-2025 Apache Software Foundation.
Apache Arrow, Arrow, Apache, the Apache feather logo, and the Apache Arrow project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>