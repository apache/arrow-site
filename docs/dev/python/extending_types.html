

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Extending pyarrow &#8212; Apache Arrow v21.0.0.dev199</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python/extending_types';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '/docs/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev/';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <link rel="canonical" href="https://arrow.apache.org/docs/python/extending_types.html" />
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="21.0.0.dev199" />

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    /* We explicitly disable cookie tracking to avoid privacy issues */
    _paq.push(['disableCookies']);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://analytics.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '20']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/arrow.png" class="logo__image only-light" alt="Apache Arrow v21.0.0.dev199 - Home"/>
    <img src="../_static/arrow-dark.png" class="logo__image only-dark pst-js-only" alt="Apache Arrow v21.0.0.dev199 - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../implementations.html">
    Implementations
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/). Please include the language you are using in your question, e.g., Python, C++, Java, R, etc."
        data-consent-required="true" 
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://bsky.app/profile/arrow.apache.org" title="BlueSky" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-bluesky fa-lg" aria-hidden="true"></i>
            <span class="sr-only">BlueSky</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Extending pyarrow</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="extending-pyarrow">
<span id="extending-types"></span><h1>Extending pyarrow<a class="headerlink" href="#extending-pyarrow" title="Permalink to this heading">#</a></h1>
<section id="controlling-conversion-to-py-arrow-with-the-pycapsule-interface">
<h2>Controlling conversion to (Py)Arrow with the PyCapsule Interface<a class="headerlink" href="#controlling-conversion-to-py-arrow-with-the-pycapsule-interface" title="Permalink to this heading">#</a></h2>
<p>The <a class="reference internal" href="../format/CDataInterface.html#c-data-interface"><span class="std std-ref">Arrow C data interface</span></a> allows moving Arrow data between
different implementations of Arrow. This is a generic, cross-language interface not
specific to Python, but for Python libraries this interface is extended with a Python
specific layer: <a class="reference internal" href="../format/CDataInterface/PyCapsuleInterface.html#arrow-pycapsule-interface"><span class="std std-ref">The Arrow PyCapsule Interface</span></a>.</p>
<p>This Python interface ensures that different libraries that support the C Data interface
can export Arrow data structures in a standard way and recognize each other’s objects.</p>
<p>If you have a Python library providing data structures that hold Arrow-compatible data
under the hood, you can implement the following methods on those objects:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__arrow_c_schema__</span></code> for schema or type-like objects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__arrow_c_array__</span></code> for arrays and record batches (contiguous tables).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__arrow_c_stream__</span></code> for chunked arrays, tables and streams of data.</p></li>
</ul>
<p>Those methods return <a class="reference external" href="https://docs.python.org/3/c-api/capsule.html">PyCapsule</a>
objects, and more details on the exact semantics can be found in the
<a class="reference internal" href="../format/CDataInterface/PyCapsuleInterface.html#arrow-pycapsule-interface"><span class="std std-ref">specification</span></a>.</p>
<p>When your data structures have those methods defined, the PyArrow constructors
(see below) will recognize those objects as
supporting this protocol, and convert them to PyArrow data structures zero-copy. And the
same can be true for any other library supporting this protocol on ingesting data.</p>
<p>Similarly, if your library has functions that accept user-provided data, you can add
support for this protocol by checking for the presence of those methods, and
therefore accept any Arrow data (instead of harcoding support for a specific
Arrow producer such as PyArrow).</p>
<p>For consuming data through this protocol with PyArrow, the following constructors
can be used to create the various PyArrow objects:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Result class</p></th>
<th class="head"><p>PyArrow constructor</p></th>
<th class="head"><p>Supported protocol</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="generated/pyarrow.Array.html#pyarrow.Array" title="pyarrow.Array"><code class="xref py py-class docutils literal notranslate"><span class="pre">Array</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/pyarrow.array.html#pyarrow.array" title="pyarrow.array"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.array()</span></code></a></p></td>
<td><p>array</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/pyarrow.ChunkedArray.html#pyarrow.ChunkedArray" title="pyarrow.ChunkedArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChunkedArray</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/pyarrow.chunked_array.html#pyarrow.chunked_array" title="pyarrow.chunked_array"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.chunked_array()</span></code></a></p></td>
<td><p>array, stream</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/pyarrow.RecordBatch.html#pyarrow.RecordBatch" title="pyarrow.RecordBatch"><code class="xref py py-class docutils literal notranslate"><span class="pre">RecordBatch</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/pyarrow.record_batch.html#pyarrow.record_batch" title="pyarrow.record_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.record_batch()</span></code></a></p></td>
<td><p>array</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table" title="pyarrow.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/pyarrow.table.html#pyarrow.table" title="pyarrow.table"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.table()</span></code></a></p></td>
<td><p>array, stream</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/pyarrow.RecordBatchReader.html#pyarrow.RecordBatchReader" title="pyarrow.RecordBatchReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">RecordBatchReader</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/pyarrow.RecordBatchReader.html#pyarrow.RecordBatchReader.from_stream" title="pyarrow.RecordBatchReader.from_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyarrow.RecordBatchReader.from_stream()</span></code></a></p></td>
<td><p>stream</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/pyarrow.Field.html#pyarrow.Field" title="pyarrow.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/pyarrow.field.html#pyarrow.field" title="pyarrow.field"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.field()</span></code></a></p></td>
<td><p>schema</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/pyarrow.Schema.html#pyarrow.Schema" title="pyarrow.Schema"><code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/pyarrow.schema.html#pyarrow.schema" title="pyarrow.schema"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.schema()</span></code></a></p></td>
<td><p>schema</p></td>
</tr>
</tbody>
</table>
</div>
<p>A <a class="reference internal" href="generated/pyarrow.DataType.html#pyarrow.DataType" title="pyarrow.DataType"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataType</span></code></a> can be created by consuming the schema-compatible object
using <a class="reference internal" href="generated/pyarrow.field.html#pyarrow.field" title="pyarrow.field"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.field()</span></code></a> and then accessing the <code class="docutils literal notranslate"><span class="pre">.type</span></code> of the resulting
Field.</p>
</section>
<section id="controlling-conversion-to-pyarrow-array-with-the-arrow-array-protocol">
<span id="arrow-array-protocol"></span><h2>Controlling conversion to pyarrow.Array with the <code class="docutils literal notranslate"><span class="pre">__arrow_array__</span></code> protocol<a class="headerlink" href="#controlling-conversion-to-pyarrow-array-with-the-arrow-array-protocol" title="Permalink to this heading">#</a></h2>
<p>The <a class="reference internal" href="generated/pyarrow.array.html#pyarrow.array" title="pyarrow.array"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.array()</span></code></a> function has built-in support for Python sequences,
numpy arrays and pandas 1D objects (Series, Index, Categorical, ..) to convert
those to Arrow arrays. This can be extended for other array-like objects
by implementing the <code class="docutils literal notranslate"><span class="pre">__arrow_array__</span></code> method (similar to numpy’s <code class="docutils literal notranslate"><span class="pre">__array__</span></code>
protocol).</p>
<p>For example, to support conversion of your duck array class to an Arrow array,
define the <code class="docutils literal notranslate"><span class="pre">__arrow_array__</span></code> method to return an Arrow array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyDuckArray</span><span class="p">:</span>

    <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># convert the underlying array values to a pyarrow Array</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span>
        <span class="k">return</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">__arrow_array__</span></code> method takes an optional <code class="docutils literal notranslate"><span class="pre">type</span></code> keyword which is passed
through from <a class="reference internal" href="generated/pyarrow.array.html#pyarrow.array" title="pyarrow.array"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.array()</span></code></a>. The method is allowed to return either
a <a class="reference internal" href="generated/pyarrow.Array.html#pyarrow.Array" title="pyarrow.Array"><code class="xref py py-class docutils literal notranslate"><span class="pre">Array</span></code></a> or a <a class="reference internal" href="generated/pyarrow.ChunkedArray.html#pyarrow.ChunkedArray" title="pyarrow.ChunkedArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChunkedArray</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a more general way to control the conversion of Python objects to Arrow
data consider the <a class="reference internal" href="../format/CDataInterface/PyCapsuleInterface.html"><span class="doc">The Arrow PyCapsule Interface</span></a>. It is
not specific to PyArrow and supports converting other objects such as tables
and schemas.</p>
</div>
</section>
<section id="defining-extension-types-user-defined-types">
<h2>Defining extension types (“user-defined types”)<a class="headerlink" href="#defining-extension-types-user-defined-types" title="Permalink to this heading">#</a></h2>
<p>Arrow affords a notion of extension types which allow users to annotate data
types with additional semantics. This allows developers both to
specify custom serialization and deserialization routines (for example,
to <a class="reference internal" href="#custom-scalar-conversion"><span class="std std-ref">Python scalars</span></a> and
<a class="reference internal" href="#conversion-to-pandas"><span class="std std-ref">pandas</span></a>) and to more easily interpret data.</p>
<p>In Arrow, <a class="reference internal" href="../format/Columnar.html#format-metadata-extension-types"><span class="std std-ref">extension types</span></a>
are specified by annotating any of the built-in Arrow data types
(the “storage type”) with a custom type name and, optionally, a
bytestring that can be used to provide additional metadata (referred to as
“parameters” in this documentation). These appear as the
<code class="docutils literal notranslate"><span class="pre">ARROW:extension:name</span></code> and <code class="docutils literal notranslate"><span class="pre">ARROW:extension:metadata</span></code> keys in the
Field’s <code class="docutils literal notranslate"><span class="pre">custom_metadata</span></code>.</p>
<p>Note that since these annotations are part of the Arrow specification,
they can potentially be recognized by other (non-Python) Arrow consumers
such as PySpark.</p>
<p>PyArrow allows you to define extension types from Python by subclassing
<a class="reference internal" href="generated/pyarrow.ExtensionType.html#pyarrow.ExtensionType" title="pyarrow.ExtensionType"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionType</span></code></a> and giving the derived class its own extension name
and mechanism to (de)serialize any parameters. For example, we could define
a custom rational type for fractions which can be represented as a pair of
integers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RationalType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">ExtensionType</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataType</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_integer</span><span class="p">(</span><span class="n">data_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data_type must be an integer type not </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">pa</span><span class="o">.</span><span class="n">struct</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="s2">&quot;numer&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;denom&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">),</span>
            <span class="s2">&quot;my_package.rational&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_serialize__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="c1"># No parameters are necessary</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_deserialize__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">storage_type</span><span class="p">,</span> <span class="n">serialized</span><span class="p">):</span>
        <span class="c1"># Sanity checks, not required but illustrate the method signature.</span>
        <span class="k">assert</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_struct</span><span class="p">(</span><span class="n">storage_type</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">pa</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_integer</span><span class="p">(</span><span class="n">storage_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">storage_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">storage_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
        <span class="k">assert</span> <span class="n">serialized</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

        <span class="c1"># return an instance of this subclass</span>
        <span class="k">return</span> <span class="n">RationalType</span><span class="p">(</span><span class="n">storage_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</pre></div>
</div>
<p>The special methods <code class="docutils literal notranslate"><span class="pre">__arrow_ext_serialize__</span></code> and <code class="docutils literal notranslate"><span class="pre">__arrow_ext_deserialize__</span></code>
define the serialization and deserialization of an extension type instance.</p>
<p>This can now be used to create arrays and tables holding the extension type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rational_type</span> <span class="o">=</span> <span class="n">RationalType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int32</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rational_type</span><span class="o">.</span><span class="n">extension_name</span>
<span class="go">&#39;my_package.rational&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rational_type</span><span class="o">.</span><span class="n">storage_type</span>
<span class="go">StructType(struct&lt;numer: int32, denom: int32&gt;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">storage_array</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;numer&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;denom&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;numer&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;denom&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span>    <span class="nb">type</span><span class="o">=</span><span class="n">rational_type</span><span class="o">.</span><span class="n">storage_type</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">rational_type</span><span class="o">.</span><span class="n">wrap_array</span><span class="p">(</span><span class="n">storage_array</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># or equivalently</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">ExtensionArray</span><span class="o">.</span><span class="n">from_storage</span><span class="p">(</span><span class="n">rational_type</span><span class="p">,</span> <span class="n">storage_array</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span>
<span class="go">&lt;pyarrow.lib.ExtensionArray object at 0x1067f5420&gt;</span>
<span class="go">-- is_valid: all not null</span>
<span class="go">-- child 0 type: int32</span>
<span class="go">  [</span>
<span class="go">    10,</span>
<span class="go">    20</span>
<span class="go">  ]</span>
<span class="go">-- child 1 type: int32</span>
<span class="go">  [</span>
<span class="go">    17,</span>
<span class="go">    13</span>
<span class="go">  ]</span>
</pre></div>
</div>
<p>This array can be included in RecordBatches, sent over IPC and received in
another Python process. The receiving process must explicitly register the
extension type for deserialization, otherwise it will fall back to the
storage type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pa</span><span class="o">.</span><span class="n">register_extension_type</span><span class="p">(</span><span class="n">RationalType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int32</span><span class="p">()))</span>
</pre></div>
</div>
<p>For example, creating a RecordBatch and writing it to a stream using the
IPC protocol:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatch</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([</span><span class="n">arr</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;ext&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sink</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">BufferOutputStream</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchStreamWriter</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">batch</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">writer</span><span class="o">.</span><span class="n">write_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">buf</span> <span class="o">=</span> <span class="n">sink</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</pre></div>
</div>
<p>and then reading it back yields the proper type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">pa</span><span class="o">.</span><span class="n">ipc</span><span class="o">.</span><span class="n">open_stream</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">result</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">type</span>
<span class="go">RationalType(StructType(struct&lt;numer: int32, denom: int32&gt;))</span>
</pre></div>
</div>
<p>Further, note that while we registered the concrete type
<code class="docutils literal notranslate"><span class="pre">RationalType(pa.int32())</span></code>, the same extension name
(<code class="docutils literal notranslate"><span class="pre">&quot;my_package.rational&quot;</span></code>) is used by <code class="docutils literal notranslate"><span class="pre">RationalType(integer_type)</span></code>
for <em>all</em> Arrow integer types. As such, the above code also allows users to
(de)serialize these data types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">big_rational_type</span> <span class="o">=</span> <span class="n">RationalType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int64</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">storage_array</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;numer&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;denom&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;numer&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;denom&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span>    <span class="nb">type</span><span class="o">=</span><span class="n">big_rational_type</span><span class="o">.</span><span class="n">storage_type</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">big_rational_type</span><span class="o">.</span><span class="n">wrap_array</span><span class="p">(</span><span class="n">storage_array</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatch</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([</span><span class="n">arr</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;ext&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sink</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">BufferOutputStream</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">pa</span><span class="o">.</span><span class="n">RecordBatchStreamWriter</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">batch</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">writer</span><span class="o">.</span><span class="n">write_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">buf</span> <span class="o">=</span> <span class="n">sink</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">pa</span><span class="o">.</span><span class="n">ipc</span><span class="o">.</span><span class="n">open_stream</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">result</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">type</span>
<span class="go">RationalType(StructType(struct&lt;numer: int64, denom: int64&gt;))</span>
</pre></div>
</div>
<p>The receiving application doesn’t need to be Python but can still recognize
the extension type as a “my_package.rational” type if it has implemented its own
extension type to receive it. If the type is not registered in the receiving
application, it will fall back to the storage type.</p>
<section id="parameterized-extension-type">
<h3>Parameterized extension type<a class="headerlink" href="#parameterized-extension-type" title="Permalink to this heading">#</a></h3>
<p>The above example illustrated how to construct an extension type that requires
no additional metadata beyond its storage type. But Arrow also provides more
flexible, parameterized extension types.</p>
<p>The example given here implements an extension type for the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-span-representation">pandas “period”
data type</a>,
representing time spans (e.g., a frequency of a day, a month, a quarter, etc).
It is stored as an int64 array which is interpreted as the number of time spans
of the given frequency since 1970.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PeriodType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">ExtensionType</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
        <span class="c1"># attributes need to be set first before calling</span>
        <span class="c1"># super init (as that calls serialize)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int64</span><span class="p">(),</span> <span class="s2">&quot;my_package.period&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_serialize__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;freq=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_deserialize__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">storage_type</span><span class="p">,</span> <span class="n">serialized</span><span class="p">):</span>
        <span class="c1"># Return an instance of this subclass given the serialized</span>
        <span class="c1"># metadata.</span>
        <span class="n">serialized</span> <span class="o">=</span> <span class="n">serialized</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">serialized</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;freq=&quot;</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">serialized</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">PeriodType</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, we ensure to store all information in the serialized metadata that is
needed to reconstruct the instance (in the <code class="docutils literal notranslate"><span class="pre">__arrow_ext_deserialize__</span></code> class
method), in this case the frequency string.</p>
<p>Note that, once created, the data type instance is considered immutable.
In the example above, the <code class="docutils literal notranslate"><span class="pre">freq</span></code> parameter is therefore stored in a private
attribute with a public read-only property to access it.</p>
</section>
<section id="custom-extension-array-class">
<h3>Custom extension array class<a class="headerlink" href="#custom-extension-array-class" title="Permalink to this heading">#</a></h3>
<p>By default, all arrays with an extension type are constructed or deserialized into
a built-in <a class="reference internal" href="generated/pyarrow.ExtensionArray.html#pyarrow.ExtensionArray" title="pyarrow.ExtensionArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a> object. Nevertheless, one could want to subclass
<a class="reference internal" href="generated/pyarrow.ExtensionArray.html#pyarrow.ExtensionArray" title="pyarrow.ExtensionArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a> in order to add some custom logic specific to the extension
type. Arrow allows to do so by adding a special method <code class="docutils literal notranslate"><span class="pre">__arrow_ext_class__</span></code> to the
definition of the extension type.</p>
<p>For instance, let us consider the example from the <a class="reference external" href="https://docs.scipy.org/doc/numpy-1.13.0/user/quickstart.html">Numpy Quickstart</a> of points in 3D space.
We can store these as a fixed-size list, where we wish to be able to extract
the data as a 2-D Numpy array <code class="docutils literal notranslate"><span class="pre">(N,</span> <span class="pre">3)</span></code> without any copy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Point3DArray</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">ExtensionArray</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_numpy_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Point3DType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">ExtensionType</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">list_</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">float32</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;my_package.Point3DType&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_serialize__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_deserialize__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">storage_type</span><span class="p">,</span> <span class="n">serialized</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Point3DType</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_class__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Point3DArray</span>
</pre></div>
</div>
<p>Arrays built using this extension type now have the expected custom array class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">storage</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span> <span class="n">pa</span><span class="o">.</span><span class="n">list_</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">float32</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">ExtensionArray</span><span class="o">.</span><span class="n">from_storage</span><span class="p">(</span><span class="n">Point3DType</span><span class="p">(),</span> <span class="n">storage</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span>
<span class="go">&lt;__main__.Point3DArray object at 0x7f40dea80670&gt;</span>
<span class="go">[</span>
<span class="go">    [</span>
<span class="go">        1,</span>
<span class="go">        2,</span>
<span class="go">        3</span>
<span class="go">    ],</span>
<span class="go">    [</span>
<span class="go">        4,</span>
<span class="go">        5,</span>
<span class="go">        6</span>
<span class="go">    ]</span>
<span class="go">]</span>
</pre></div>
</div>
<p>The additional methods in the extension class are then available to the user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span><span class="o">.</span><span class="n">to_numpy_array</span><span class="p">()</span>
<span class="go">array([[1., 2., 3.],</span>
<span class="go">   [4., 5., 6.]], dtype=float32)</span>
</pre></div>
</div>
<p>This array can be sent over IPC, received in another Python process, and the custom
extension array class will be preserved (as long as the receiving process registers
the extension type using <a class="reference internal" href="generated/pyarrow.register_extension_type.html#pyarrow.register_extension_type" title="pyarrow.register_extension_type"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_extension_type()</span></code></a> before reading the IPC data).</p>
</section>
<section id="custom-scalar-conversion">
<span id="id1"></span><h3>Custom scalar conversion<a class="headerlink" href="#custom-scalar-conversion" title="Permalink to this heading">#</a></h3>
<p>If you want scalars of your custom extension type to convert to a custom type when
<a class="reference internal" href="generated/pyarrow.ExtensionScalar.html#pyarrow.ExtensionScalar.as_py" title="pyarrow.ExtensionScalar.as_py"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ExtensionScalar.as_py()</span></code></a> is called, you can override the
<a class="reference internal" href="generated/pyarrow.ExtensionScalar.html#pyarrow.ExtensionScalar.as_py" title="pyarrow.ExtensionScalar.as_py"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ExtensionScalar.as_py()</span></code></a> method by subclassing <a class="reference internal" href="generated/pyarrow.ExtensionScalar.html#pyarrow.ExtensionScalar" title="pyarrow.ExtensionScalar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionScalar</span></code></a>.
For example, if we wanted the above example 3D point type to return a custom
3D point class instead of a list, we would implement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">Point3D</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Point3D&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Point3DScalar</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">ExtensionScalar</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_py</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point3D</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Point3D</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">as_py</span><span class="p">())</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Point3DType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">ExtensionType</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">list_</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">float32</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;my_package.Point3DType&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_serialize__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_deserialize__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">storage_type</span><span class="p">,</span> <span class="n">serialized</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Point3DType</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__arrow_ext_scalar_class__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Point3DScalar</span>
</pre></div>
</div>
<p>Arrays built using this extension type now provide scalars that convert to our <code class="docutils literal notranslate"><span class="pre">Point3D</span></code> class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">storage</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span> <span class="n">pa</span><span class="o">.</span><span class="n">list_</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">float32</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">ExtensionArray</span><span class="o">.</span><span class="n">from_storage</span><span class="p">(</span><span class="n">Point3DType</span><span class="p">(),</span> <span class="n">storage</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_py</span><span class="p">()</span>
<span class="go">Point3D(x=1.0, y=2.0, z=3.0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span><span class="o">.</span><span class="n">to_pylist</span><span class="p">()</span>
<span class="go">[Point3D(x=1.0, y=2.0, z=3.0), Point3D(x=4.0, y=5.0, z=6.0)]</span>
</pre></div>
</div>
</section>
<section id="conversion-to-pandas">
<span id="id2"></span><h3>Conversion to pandas<a class="headerlink" href="#conversion-to-pandas" title="Permalink to this heading">#</a></h3>
<p>The conversion to pandas (in <a class="reference internal" href="generated/pyarrow.Table.html#pyarrow.Table.to_pandas" title="pyarrow.Table.to_pandas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.to_pandas()</span></code></a>) of columns with an
extension type can controlled in case there is a corresponding
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/development/extending.html#extension-types">pandas extension array</a>
for your extension type.</p>
<p>For this, the <a class="reference internal" href="generated/pyarrow.ExtensionType.html#pyarrow.ExtensionType.to_pandas_dtype" title="pyarrow.ExtensionType.to_pandas_dtype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ExtensionType.to_pandas_dtype()</span></code></a> method needs to be
implemented, and should return a <code class="docutils literal notranslate"><span class="pre">pandas.api.extensions.ExtensionDtype</span></code>
subclass instance.</p>
<p>Using the pandas period type from above as example, this would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PeriodType</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">ExtensionType</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_pandas_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodDtype</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
</pre></div>
</div>
<p>Secondly, the pandas <code class="docutils literal notranslate"><span class="pre">ExtensionDtype</span></code> on its turn needs to have the
<code class="docutils literal notranslate"><span class="pre">__from_arrow__</span></code> method implemented: a method that given a pyarrow Array
or ChunkedArray of the extension type can construct the corresponding
pandas <code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code>. This method should have the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyExtensionDtype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">ExtensionDtype</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__from_arrow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">Array</span><span class="o">/</span><span class="n">ChunkedArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">ExtensionArray</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>This way, you can control the conversion of a pyarrow <code class="docutils literal notranslate"><span class="pre">Array</span></code> of your pyarrow
extension type to a pandas <code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code> that can be stored in a DataFrame.</p>
</section>
<section id="canonical-extension-types">
<h3>Canonical extension types<a class="headerlink" href="#canonical-extension-types" title="Permalink to this heading">#</a></h3>
<p>You can find the official list of canonical extension types in the
<a class="reference internal" href="../format/CanonicalExtensions.html#format-canonical-extensions"><span class="std std-ref">Canonical Extension Types</span></a> section. Here we add examples on how to
use them in pyarrow.</p>
<section id="fixed-size-tensor">
<h4>Fixed size tensor<a class="headerlink" href="#fixed-size-tensor" title="Permalink to this heading">#</a></h4>
<p>To create an array of tensors with equal shape (fixed shape tensor array) we
first need to define a fixed shape tensor extension type with value type
and shape:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tensor_type</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">fixed_shape_tensor</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int32</span><span class="p">(),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Then we need the storage array with <a class="reference internal" href="generated/pyarrow.list_.html#pyarrow.list_" title="pyarrow.list_"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyarrow.list_()</span></code></a> type where <code class="docutils literal notranslate"><span class="pre">value_type`</span></code>
is the fixed shape tensor value type and list size is a product of <code class="docutils literal notranslate"><span class="pre">tensor_type</span></code>
shape elements. Then we can create an array of tensors with
<code class="docutils literal notranslate"><span class="pre">pa.ExtensionArray.from_storage()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">storage</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">list_</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int32</span><span class="p">(),</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tensor_array</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">ExtensionArray</span><span class="o">.</span><span class="n">from_storage</span><span class="p">(</span><span class="n">tensor_type</span><span class="p">,</span> <span class="n">storage</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also create another array of tensors with different value type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tensor_type_2</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">fixed_shape_tensor</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">float32</span><span class="p">(),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">storage_2</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">list_</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">float32</span><span class="p">(),</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tensor_array_2</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">ExtensionArray</span><span class="o">.</span><span class="n">from_storage</span><span class="p">(</span><span class="n">tensor_type_2</span><span class="p">,</span> <span class="n">storage_2</span><span class="p">)</span>
</pre></div>
</div>
<p>Extension arrays can be used as columns in  <code class="docutils literal notranslate"><span class="pre">pyarrow.Table</span></code> or
<code class="docutils literal notranslate"><span class="pre">pyarrow.RecordBatch</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
<span class="gp">... </span>    <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span>
<span class="gp">... </span>    <span class="n">pa</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">]),</span>
<span class="gp">... </span>    <span class="n">tensor_array</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">tensor_array_2</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_schema</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">schema</span><span class="p">([(</span><span class="s2">&quot;f0&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">int8</span><span class="p">()),</span>
<span class="gp">... </span>                       <span class="p">(</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">string</span><span class="p">()),</span>
<span class="gp">... </span>                       <span class="p">(</span><span class="s2">&quot;f2&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">bool_</span><span class="p">()),</span>
<span class="gp">... </span>                       <span class="p">(</span><span class="s2">&quot;tensors_int&quot;</span><span class="p">,</span> <span class="n">tensor_type</span><span class="p">),</span>
<span class="gp">... </span>                       <span class="p">(</span><span class="s2">&quot;tensors_float&quot;</span><span class="p">,</span> <span class="n">tensor_type_2</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">my_schema</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span>
<span class="go">pyarrow.Table</span>
<span class="go">f0: int8</span>
<span class="go">f1: string</span>
<span class="go">f2: bool</span>
<span class="go">tensors_int: extension&lt;arrow.fixed_shape_tensor[value_type=int32, shape=[2,2]]&gt;</span>
<span class="go">tensors_float: extension&lt;arrow.fixed_shape_tensor[value_type=float, shape=[2,2]]&gt;</span>
<span class="go">----</span>
<span class="go">f0: [[1,2,3]]</span>
<span class="go">f1: [[&quot;foo&quot;,&quot;bar&quot;,null]]</span>
<span class="go">f2: [[true,null,true]]</span>
<span class="go">tensors_int: [[[1,2,3,4],[10,20,30,40],[100,200,300,400]]]</span>
<span class="go">tensors_float: [[[1,2,3,4],[10,20,30,40],[100,200,300,400]]]</span>
</pre></div>
</div>
<p>We can also convert a tensor array to a single multi-dimensional numpy ndarray.
With the conversion the length of the arrow array becomes the first dimension
in the numpy ndarray:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">numpy_tensor</span> <span class="o">=</span> <span class="n">tensor_array_2</span><span class="o">.</span><span class="n">to_numpy_ndarray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numpy_tensor</span>
<span class="go">array([[[  1.,   2.],</span>
<span class="go">        [  3.,   4.]],</span>
<span class="go">       [[ 10.,  20.],</span>
<span class="go">        [ 30.,  40.]],</span>
<span class="go">       [[100., 200.],</span>
<span class="go">        [300., 400.]]])</span>
<span class="go"> &gt;&gt;&gt; numpy_tensor.shape</span>
<span class="go">(3, 2, 2)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Both optional parameters, <code class="docutils literal notranslate"><span class="pre">permutation</span></code> and <code class="docutils literal notranslate"><span class="pre">dim_names</span></code>, are meant to provide the user
with the information about the logical layout of the data compared to the physical layout.</p>
<p>The conversion to numpy ndarray is only possible for trivial permutations (<code class="docutils literal notranslate"><span class="pre">None</span></code> or
<code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">...</span> <span class="pre">N-1]</span></code> where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of tensor dimensions).</p>
</div>
<p>And also the other way around, we can convert a numpy ndarray to a fixed shape tensor array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pa</span><span class="o">.</span><span class="n">FixedShapeTensorArray</span><span class="o">.</span><span class="n">from_numpy_ndarray</span><span class="p">(</span><span class="n">numpy_tensor</span><span class="p">)</span>
<span class="go">&lt;pyarrow.lib.FixedShapeTensorArray object at ...&gt;</span>
<span class="go">[</span>
<span class="go">  [</span>
<span class="go">    1,</span>
<span class="go">    2,</span>
<span class="go">    3,</span>
<span class="go">    4</span>
<span class="go">  ],</span>
<span class="go">  [</span>
<span class="go">    10,</span>
<span class="go">    20,</span>
<span class="go">    30,</span>
<span class="go">    40</span>
<span class="go">  ],</span>
<span class="go">  [</span>
<span class="go">    100,</span>
<span class="go">    200,</span>
<span class="go">    300,</span>
<span class="go">    400</span>
<span class="go">  ]</span>
<span class="go">]</span>
</pre></div>
</div>
<p>With the conversion the first dimension of the ndarray becomes the length of the pyarrow extension
array. We can see in the example that ndarray of shape <code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">2,</span> <span class="pre">2)</span></code> becomes an arrow array of
length 3 with tensor elements of shape <code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">2)</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ndarray of shape (3, 2, 2)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">numpy_tensor</span><span class="o">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># arrow array of length 3 with tensor elements of shape (2, 2)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pyarrow_tensor_array</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">FixedShapeTensorArray</span><span class="o">.</span><span class="n">from_numpy_ndarray</span><span class="p">(</span><span class="n">numpy_tensor</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyarrow_tensor_array</span><span class="p">)</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pyarrow_tensor_array</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">shape</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>The extension type can also have <code class="docutils literal notranslate"><span class="pre">permutation</span></code> and <code class="docutils literal notranslate"><span class="pre">dim_names</span></code> defined. For
example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tensor_type</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">fixed_shape_tensor</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">float64</span><span class="p">(),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">permutation</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tensor_type</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">fixed_shape_tensor</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">bool_</span><span class="p">(),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dim_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>for <code class="docutils literal notranslate"><span class="pre">NCHW</span></code> format where:</p>
<ul class="simple">
<li><p>N: number of images which is in our case the length of an array and is always on
the first dimension</p></li>
<li><p>C: number of channels of the image</p></li>
<li><p>H: height of the image</p></li>
<li><p>W: width of the image</p></li>
</ul>
</section>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-conversion-to-py-arrow-with-the-pycapsule-interface">Controlling conversion to (Py)Arrow with the PyCapsule Interface</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-conversion-to-pyarrow-array-with-the-arrow-array-protocol">Controlling conversion to pyarrow.Array with the <code class="docutils literal notranslate"><span class="pre">__arrow_array__</span></code> protocol</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-extension-types-user-defined-types">Defining extension types (“user-defined types”)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameterized-extension-type">Parameterized extension type</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-extension-array-class">Custom extension array class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-scalar-conversion">Custom scalar conversion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conversion-to-pandas">Conversion to pandas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#canonical-extension-types">Canonical extension types</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fixed-size-tensor">Fixed size tensor</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow/edit/main/docs/source/python/extending_types.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2016-2025 Apache Software Foundation.
Apache Arrow, Arrow, Apache, the Apache feather logo, and the Apache Arrow project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>