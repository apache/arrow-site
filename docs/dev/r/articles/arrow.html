<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the Arrow C++ Library in R • Arrow R Package</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Using the Arrow C++ Library in R">
<meta property="og:description" content="This document describes the low-level interface to the Apache Arrow C++ library in R and reviews the patterns and conventions of the R package.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107500873-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107500873-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Arrow R Package</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">6.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://arrow.apache.org/" class="external-link">❯❯❯</a>
</li>
<li>
  <a href="../articles/arrow.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/install.html">Installing the Arrow Package on Linux</a>
    </li>
    <li>
      <a href="../articles/dataset.html">Working with Arrow Datasets and dplyr</a>
    </li>
    <li>
      <a href="../articles/fs.html">Working with Cloud Storage (S3)</a>
    </li>
    <li>
      <a href="../articles/python.html">Apache Arrow in Python and R with reticulate</a>
    </li>
    <li>
      <a href="../articles/flight.html">Connecting to Flight RPC Servers</a>
    </li>
    <li>
      <a href="../articles/developing.html">Arrow R Developer Guide</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Developers</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/developers/setup.html">Developer Environment Setup</a>
        </li>
        <li>
          <a href="../articles/developers/workflow.html">Common Workflow Tasks</a>
        </li>
        <li>
          <a href="../articles/developers/debugging.html">Debugging</a>
        </li>
        <li>
          <a href="../articles/developers/install_details.html">Package Installation Details</a>
        </li>
        <li>
          <a href="../articles/developers/docker.html">Docker</a>
        </li>
        <li>
          <a href="../articles/developers/bindings.html">Writing Bindings</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Project docs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://arrow.apache.org/docs/format/Columnar.html" class="external-link">Specification</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/c_glib" class="external-link">C GLib</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/cpp" class="external-link">C++</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/java" class="external-link">Java</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/js" class="external-link">JavaScript</a>
    </li>
    <li>
      <a href="https://arrow.apache.org/docs/python" class="external-link">Python</a>
    </li>
    <li>
      <a href="../index.html">R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the Arrow C++ Library in R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apache/arrow/blob/master/r/vignettes/arrow.Rmd" class="external-link"><code>vignettes/arrow.Rmd</code></a></small>
      <div class="hidden name"><code>arrow.Rmd</code></div>

    </div>

    
    
<p>The Apache Arrow C++ library provides rich, powerful features for working with columnar data. The <code>arrow</code> R package provides both a low-level interface to the C++ library and some higher-level, R-flavored tools for working with it. This vignette provides an overview of how the pieces fit together, and it describes the conventions that the classes and methods follow in R.</p>
<div class="section level1">
<h1 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h1>
<div class="section level2">
<h2 id="multi-file-datasets">Multi-file datasets<a class="anchor" aria-label="anchor" href="#multi-file-datasets"></a>
</h2>
<p>The <code>arrow</code> package lets you work efficiently with large, multi-file datasets using <code>dplyr</code> methods. See <code><a href="../articles/dataset.html">vignette("dataset", package = "arrow")</a></code> for an overview.</p>
</div>
<div class="section level2">
<h2 id="reading-and-writing-files">Reading and writing files<a class="anchor" aria-label="anchor" href="#reading-and-writing-files"></a>
</h2>
<p><code>arrow</code> provides some simple functions for using the Arrow C++ library to read and write files. These functions are designed to drop into your normal R workflow without requiring any knowledge of the Arrow C++ library and use naming conventions and arguments that follow popular R packages, particularly <code>readr</code>. The readers return <code>data.frame</code>s (or if you use the <code>tibble</code> package, they will act like <code>tbl_df</code>s), and the writers take <code>data.frame</code>s.</p>
<p>Importantly, <code>arrow</code> provides basic read and write support for the <a href="https://parquet.apache.org/" class="external-link">Apache Parquet</a> columnar data file format.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_parquet.html">read_parquet</a></span><span class="op">(</span><span class="st">"path/to/file.parquet"</span><span class="op">)</span></code></pre></div>
<p>Just as you can read, you can write Parquet files:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/write_parquet.html">write_parquet</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"path/to/different_file.parquet"</span><span class="op">)</span></code></pre></div>
<p>The <code>arrow</code> package also includes a faster and more robust implementation of the <a href="https://github.com/wesm/feather" class="external-link">Feather</a> file format, providing <code><a href="../reference/read_feather.html">read_feather()</a></code> and <code><a href="../reference/write_feather.html">write_feather()</a></code>. This implementation depends on the same underlying C++ library as the Python version does, resulting in more reliable and consistent behavior across the two languages, as well as <a href="https://wesmckinney.com/blog/feather-arrow-future/" class="external-link">improved performance</a>. <code>arrow</code> also by default writes the Feather V2 format, which supports a wider range of data types, as well as compression.</p>
<p>For CSV and line-delimited JSON, there are <code><a href="../reference/read_delim_arrow.html">read_csv_arrow()</a></code> and <code><a href="../reference/read_json_arrow.html">read_json_arrow()</a></code>, respectively. While <code><a href="../reference/read_delim_arrow.html">read_csv_arrow()</a></code> currently has fewer parsing options for dealing with every CSV format variation in the wild, for the files it can read, it is often significantly faster than other R CSV readers, such as <code>base::read.csv</code>, <code>readr::read_csv</code>, and <code>data.table::fread</code>.</p>
</div>
<div class="section level2">
<h2 id="working-with-arrow-data-in-python">Working with Arrow data in Python<a class="anchor" aria-label="anchor" href="#working-with-arrow-data-in-python"></a>
</h2>
<p>Using <a href="https://rstudio.github.io/reticulate/" class="external-link"><code>reticulate</code></a>, <code>arrow</code> lets you share data between R and Python (<code>pyarrow</code>) efficiently, enabling you to take advantage of the vibrant ecosystem of Python packages that build on top of Apache Arrow. See <code><a href="../articles/python.html">vignette("python", package = "arrow")</a></code> for details.</p>
</div>
<div class="section level2">
<h2 id="access-to-arrow-messages-buffers-and-streams">Access to Arrow messages, buffers, and streams<a class="anchor" aria-label="anchor" href="#access-to-arrow-messages-buffers-and-streams"></a>
</h2>
<p>The <code>arrow</code> package also provides many lower-level bindings to the C++ library, which enable you to access and manipulate Arrow objects. You can use these to build connectors to other applications and services that use Arrow. One example is Spark: the <a href="https://spark.rstudio.com/" class="external-link"><code>sparklyr</code></a> package has support for using Arrow to move data to and from Spark, yielding <a href="http://arrow.apache.org/blog/2019/01/25/r-spark-improvements/" class="external-link">significant performance gains</a>.</p>
</div>
</div>
<div class="section level1">
<h1 id="object-hierarchy">Object hierarchy<a class="anchor" aria-label="anchor" href="#object-hierarchy"></a>
</h1>
<div class="section level2">
<h2 id="metadata-objects">Metadata objects<a class="anchor" aria-label="anchor" href="#metadata-objects"></a>
</h2>
<p>Arrow defines the following classes for representing metadata:</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="54%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th>Class</th>
<th>Description</th>
<th>How to create an instance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>DataType</code></td>
<td>attribute controlling how values are represented</td>
<td>functions in <code><a href="../reference/data-type.html">help("data-type")</a></code>
</td>
</tr>
<tr class="even">
<td><code>Field</code></td>
<td>a character string name and a <code>DataType</code>
</td>
<td><code>field(name, type)</code></td>
</tr>
<tr class="odd">
<td><code>Schema</code></td>
<td>list of <code>Field</code>s</td>
<td><code>schema(...)</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="data-objects">Data objects<a class="anchor" aria-label="anchor" href="#data-objects"></a>
</h2>
<p>Arrow defines the following classes for representing zero-dimensional (scalar), one-dimensional (array/vector-like), and two-dimensional (tabular/data frame-like) data:</p>
<table class="table">
<colgroup>
<col width="1%">
<col width="8%">
<col width="25%">
<col width="63%">
</colgroup>
<thead><tr class="header">
<th>Dim</th>
<th>Class</th>
<th>Description</th>
<th>How to create an instance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0</td>
<td><code>Scalar</code></td>
<td>single value and its <code>DataType</code>
</td>
<td><code>Scalar$create(value, type)</code></td>
</tr>
<tr class="even">
<td>1</td>
<td><code>Array</code></td>
<td>vector of values and its <code>DataType</code>
</td>
<td><code>Array$create(vector, type)</code></td>
</tr>
<tr class="odd">
<td>1</td>
<td><code>ChunkedArray</code></td>
<td>vectors of values and their <code>DataType</code>
</td>
<td>
<code>ChunkedArray$create(..., type)</code> or alias <code>chunked_array(..., type)</code>
</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>RecordBatch</code></td>
<td>list of <code>Array</code>s with a <code>Schema</code>
</td>
<td>
<code>RecordBatch$create(...)</code> or alias <code>record_batch(...)</code>
</td>
</tr>
<tr class="odd">
<td>2</td>
<td><code>Table</code></td>
<td>list of <code>ChunkedArray</code> with a <code>Schema</code>
</td>
<td>
<code>Table$create(...)</code>, alias <code>arrow_table(...)</code>, or <code>arrow::read_*(file, as_data_frame = FALSE)</code>
</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>Dataset</code></td>
<td>list of <code>Table</code>s with the same <code>Schema</code>
</td>
<td>
<code>Dataset$create(sources, schema)</code> or alias <code>open_dataset(sources, schema)</code>
</td>
</tr>
</tbody>
</table>
<p>Each of these is defined as an <code>R6</code> class in the <code>arrow</code> R package and corresponds to a class of the same name in the Arrow C++ library. The <code>arrow</code> package provides a variety of <code>R6</code> and S3 methods for interacting with instances of these classes.</p>
<p>For convenience, the <code>arrow</code> package also defines several synthetic classes that do not exist in the C++ library, including:</p>
<ul>
<li>
<code>ArrowDatum</code>: inherited by <code>Scalar</code>, <code>Array</code>, and <code>ChunkedArray</code>
</li>
<li>
<code>ArrowTabular</code>: inherited by <code>RecordBatch</code> and <code>Table</code>
</li>
<li>
<code>ArrowObject</code>: inherited by all Arrow objects</li>
</ul>
</div>
</div>
<div class="section level1">
<h1 id="internals">Internals<a class="anchor" aria-label="anchor" href="#internals"></a>
</h1>
<div class="section level2">
<h2 id="mapping-of-r-arrow-types">Mapping of R &lt;–&gt; Arrow types<a class="anchor" aria-label="anchor" href="#mapping-of-r-arrow-types"></a>
</h2>
<p>Arrow has a rich data type system that includes direct parallels with R’s data types and much more.</p>
<p>In the tables, entries with a <code>-</code> are not currently implemented.</p>
<div class="section level3">
<h3 id="r-to-arrow">R to Arrow<a class="anchor" aria-label="anchor" href="#r-to-arrow"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>R type</th>
<th>Arrow type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>logical</td>
<td>boolean</td>
</tr>
<tr class="even">
<td>integer</td>
<td>int32</td>
</tr>
<tr class="odd">
<td>double (“numeric”)</td>
<td>float64<sup>1</sup>
</td>
</tr>
<tr class="even">
<td>character</td>
<td>utf8<sup>2</sup>
</td>
</tr>
<tr class="odd">
<td>factor</td>
<td>dictionary</td>
</tr>
<tr class="even">
<td>raw</td>
<td>uint8</td>
</tr>
<tr class="odd">
<td>Date</td>
<td>date32</td>
</tr>
<tr class="even">
<td>POSIXct</td>
<td>timestamp</td>
</tr>
<tr class="odd">
<td>POSIXlt</td>
<td>struct</td>
</tr>
<tr class="even">
<td>data.frame</td>
<td>struct</td>
</tr>
<tr class="odd">
<td>list<sup>3</sup>
</td>
<td>list</td>
</tr>
<tr class="even">
<td>bit64::integer64</td>
<td>int64</td>
</tr>
<tr class="odd">
<td>hms::hms</td>
<td>time32</td>
</tr>
<tr class="even">
<td>difftime</td>
<td>duration</td>
</tr>
<tr class="odd">
<td>vctrs::vctrs_unspecified</td>
<td>null</td>
</tr>
</tbody>
</table>
<p><sup>1</sup>: <code>float64</code> and <code>double</code> are the same concept and data type in Arrow C++; however, only <code><a href="../reference/data-type.html">float64()</a></code> is used in arrow as the function <code><a href="https://rdrr.io/r/base/double.html" class="external-link">double()</a></code> already exists in base R</p>
<p><sup>2</sup>: If the character vector exceeds 2GB of strings, it will be converted to a <code>large_utf8</code> Arrow type</p>
<p><sup>3</sup>: Only lists where all elements are the same type are able to be translated to Arrow list type (which is a “list of” some type).</p>
</div>
<div class="section level3">
<h3 id="arrow-to-r">Arrow to R<a class="anchor" aria-label="anchor" href="#arrow-to-r"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Arrow type</th>
<th>R type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>boolean</td>
<td>logical</td>
</tr>
<tr class="even">
<td>int8</td>
<td>integer</td>
</tr>
<tr class="odd">
<td>int16</td>
<td>integer</td>
</tr>
<tr class="even">
<td>int32</td>
<td>integer</td>
</tr>
<tr class="odd">
<td>int64</td>
<td>integer<sup>1</sup>
</td>
</tr>
<tr class="even">
<td>uint8</td>
<td>integer</td>
</tr>
<tr class="odd">
<td>uint16</td>
<td>integer</td>
</tr>
<tr class="even">
<td>uint32</td>
<td>integer<sup>1</sup>
</td>
</tr>
<tr class="odd">
<td>uint64</td>
<td>integer<sup>1</sup>
</td>
</tr>
<tr class="even">
<td>float16</td>
<td>-<sup>2</sup>
</td>
</tr>
<tr class="odd">
<td>float32</td>
<td>double</td>
</tr>
<tr class="even">
<td>float64</td>
<td>double</td>
</tr>
<tr class="odd">
<td>utf8</td>
<td>character</td>
</tr>
<tr class="even">
<td>large_utf8</td>
<td>character</td>
</tr>
<tr class="odd">
<td>binary</td>
<td>arrow_binary <sup>3</sup>
</td>
</tr>
<tr class="even">
<td>large_binary</td>
<td>arrow_large_binary <sup>3</sup>
</td>
</tr>
<tr class="odd">
<td>fixed_size_binary</td>
<td>arrow_fixed_size_binary <sup>3</sup>
</td>
</tr>
<tr class="even">
<td>date32</td>
<td>Date</td>
</tr>
<tr class="odd">
<td>date64</td>
<td>POSIXct</td>
</tr>
<tr class="even">
<td>time32</td>
<td>hms::hms</td>
</tr>
<tr class="odd">
<td>time64</td>
<td>hms::hms</td>
</tr>
<tr class="even">
<td>timestamp</td>
<td>POSIXct</td>
</tr>
<tr class="odd">
<td>duration</td>
<td>difftime</td>
</tr>
<tr class="even">
<td>decimal</td>
<td>double</td>
</tr>
<tr class="odd">
<td>dictionary</td>
<td>factor<sup>4</sup>
</td>
</tr>
<tr class="even">
<td>list</td>
<td>arrow_list <sup>5</sup>
</td>
</tr>
<tr class="odd">
<td>large_list</td>
<td>arrow_large_list <sup>5</sup>
</td>
</tr>
<tr class="even">
<td>fixed_size_list</td>
<td>arrow_fixed_size_list <sup>5</sup>
</td>
</tr>
<tr class="odd">
<td>struct</td>
<td>data.frame</td>
</tr>
<tr class="even">
<td>null</td>
<td>vctrs::vctrs_unspecified</td>
</tr>
<tr class="odd">
<td>map</td>
<td>-<sup>2</sup>
</td>
</tr>
<tr class="even">
<td>union</td>
<td>-<sup>2</sup>
</td>
</tr>
</tbody>
</table>
<p><sup>1</sup>: These integer types may contain values that exceed the range of R’s <code>integer</code> type (32-bit signed integer). When they do, <code>uint32</code> and <code>uint64</code> are converted to <code>double</code> (“numeric”) and <code>int64</code> is converted to <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code>. This conversion can be disabled (so that <code>int64</code> always yields a <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> vector) by setting <code>options(arrow.int64_downcast = FALSE)</code>.</p>
<p><sup>2</sup>: Some Arrow data types do not currently have an R equivalent and will raise an error if cast to or mapped to via a schema.</p>
<p><sup>3</sup>: <code>arrow*_binary</code> classes are implemented as lists of raw vectors.</p>
<p><sup>4</sup>: Due to the limitation of R factors, Arrow <code>dictionary</code> values are coerced to string when translated to R if they are not already strings.</p>
<p><sup>5</sup>: <code>arrow*_list</code> classes are implemented as subclasses of <code>vctrs_list_of</code> with a <code>ptype</code> attribute set to what an empty Array of the value type converts to.</p>
</div>
<div class="section level3">
<h3 id="r-object-attributes">R object attributes<a class="anchor" aria-label="anchor" href="#r-object-attributes"></a>
</h3>
<p>Arrow supports custom key-value metadata attached to Schemas. When we convert a <code>data.frame</code> to an Arrow Table or RecordBatch, the package stores any <code><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes()</a></code> attached to the columns of the <code>data.frame</code> in the Arrow object’s Schema. These attributes are stored under the “r” key; you can assign additional string metadata under any other key you wish, like <code>x$metadata$new_key &lt;- "new value"</code>.</p>
<p>This metadata is preserved when writing the table to Feather or Parquet, and when reading those files into R, or when calling <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> on a Table/RecordBatch, the column attributes are restored to the columns of the resulting <code>data.frame</code>. This means that custom data types, including <code>haven::labelled</code>, <code>vctrs</code> annotations, and others, are preserved when doing a round-trip through Arrow.</p>
<p>Note that the <code><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes()</a></code> stored in <code>$metadata$r</code> are only understood by R. If you write a <code>data.frame</code> with <code>haven</code> columns to a Feather file and read that in Pandas, the <code>haven</code> metadata won’t be recognized there. (Similarly, Pandas writes its own custom metadata, which the R package does not consume.) You are free, however, to define custom metadata conventions for your application and assign any (string) values you want to other metadata keys. For more details, see the documentation for <code><a href="../reference/Schema.html">schema()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="class-structure-and-package-conventions">Class structure and package conventions<a class="anchor" aria-label="anchor" href="#class-structure-and-package-conventions"></a>
</h2>
<p>C++ is an object-oriented language, so the core logic of the Arrow library is encapsulated in classes and methods. In the R package, these classes are implemented as <a href="https://r6.r-lib.org" class="external-link"><code>R6</code></a> classes, most of which are exported from the namespace.</p>
<p>In order to match the C++ naming conventions, the <code>R6</code> classes are in TitleCase, e.g. <code>RecordBatch</code>. This makes it easy to look up the relevant C++ implementations in the <a href="https://github.com/apache/arrow/tree/master/cpp" class="external-link">code</a> or <a href="https://arrow.apache.org/docs/cpp/" class="external-link">documentation</a>. To simplify things in R, the C++ library namespaces are generally dropped or flattened; that is, where the C++ library has <code>arrow::io::FileOutputStream</code>, it is just <code>FileOutputStream</code> in the R package. One exception is for the file readers, where the namespace is necessary to disambiguate. So <code>arrow::csv::TableReader</code> becomes <code>CsvTableReader</code>, and <code>arrow::json::TableReader</code> becomes <code>JsonTableReader</code>.</p>
<p>Some of these classes are not meant to be instantiated directly; they may be base classes or other kinds of helpers. For those that you should be able to create, use the <code>$create()</code> method to instantiate an object. For example, <code>rb &lt;- RecordBatch$create(int = 1:10, dbl = as.numeric(1:10))</code> will create a <code>RecordBatch</code>. Many of these factory methods that an R user might most often encounter also have a <code>snake_case</code> alias, in order to be more familiar for contemporary R users. So <code>record_batch(int = 1:10, dbl = as.numeric(1:10))</code> would do the same as <code>RecordBatch$create()</code> above.</p>
<p>The typical user of the <code>arrow</code> R package may never deal directly with the <code>R6</code> objects. We provide more R-friendly wrapper functions as a higher-level interface to the C++ library. An R user can call <code><a href="../reference/read_parquet.html">read_parquet()</a></code> without knowing or caring that they’re instantiating a <code>ParquetFileReader</code> object and calling the <code>$ReadFile()</code> method on it. The classes are there and available to the advanced programmer who wants fine-grained control over how the C++ library is used.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Neal Richardson, Ian Cook, Nic Crane, Jonathan Keane, Romain François, Jeroen Ooms, Apache Arrow.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
