

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Tabular Datasets &#8212; Apache Arrow v20.0.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cpp/dataset';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '/docs/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '20.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = true;
        </script>
    <link rel="canonical" href="https://arrow.apache.org/docs/cpp/dataset.html" />
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Arrow Flight RPC" href="flight.html" />
    <link rel="prev" title="Reading JSON files" href="json.html" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="20.0.0" />

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    /* We explicitly disable cookie tracking to avoid privacy issues */
    _paq.push(['disableCookies']);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://analytics.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '20']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/arrow.png" class="logo__image only-light" alt="Apache Arrow v20.0.0 - Home"/>
    <img src="../_static/arrow-dark.png" class="logo__image only-dark pst-js-only" alt="Apache Arrow v20.0.0 - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developers/index.html">
    Development
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    Implementations
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../c_glib/index.html">
    C/GLib
  </a>
</li>


<li class=" current active">
  <a class="nav-link dropdown-item nav-internal" href="index.html">
    C++
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/apache/arrow/blob/main/csharp/README.md">
    C#
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://arrow.apache.org/go/">
    Go
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../java/index.html">
    Java
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../js/index.html">
    JavaScript
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://arrow.apache.org/julia/">
    Julia
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/apache/arrow/blob/main/matlab/README.md">
    MATLAB
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://arrow.apache.org/nanoarrow/">
    nanoarrow
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../python/index.html">
    Python
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../r/index.html">
    R
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/apache/arrow/blob/main/ruby/README.md">
    Ruby
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://docs.rs/crate/arrow/">
    Rust
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../status.html">
    Implementation Status
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://arrow.apache.org/cookbook/cpp/">
    C++ cookbook
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://arrow.apache.org/cookbook/java/">
    Java cookbook
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://arrow.apache.org/cookbook/py/">
    Python cookbook
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://arrow.apache.org/cookbook/r/">
    R cookbook
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/)."
        data-consent-required="true" 
        data-user-analytics-cookie-enabled="false"
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/ApacheArrow" title="X" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">X</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../format/index.html">
    Specifications
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developers/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../c_glib/index.html">
    C/GLib
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    C++
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/apache/arrow/blob/main/csharp/README.md">
    C#
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://arrow.apache.org/go/">
    Go
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../java/index.html">
    Java
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../js/index.html">
    JavaScript
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://arrow.apache.org/julia/">
    Julia
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/apache/arrow/blob/main/matlab/README.md">
    MATLAB
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://arrow.apache.org/nanoarrow/">
    nanoarrow
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../python/index.html">
    Python
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../r/index.html">
    R
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/apache/arrow/blob/main/ruby/README.md">
    Ruby
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://docs.rs/crate/arrow/">
    Rust
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../status.html">
    Implementation Status
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://arrow.apache.org/cookbook/cpp/">
    C++ cookbook
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://arrow.apache.org/cookbook/java/">
    Java cookbook
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://arrow.apache.org/cookbook/py/">
    Python cookbook
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://arrow.apache.org/cookbook/r/">
    R cookbook
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="kapa-ai-bot">
    <script
        async
        src="https://widget.kapa.ai/kapa-widget.bundle.js"
        data-website-id="9db461d5-ac77-4b3f-a5c5-75efa78339d2"
        data-project-name="Apache Arrow"
        data-project-color="#000000"
        data-project-logo="https://arrow.apache.org/img/arrow-logo_chevrons_white-txt_black-bg.png"
        data-modal-disclaimer="This is a custom LLM with access to all [Arrow documentation](https://arrow.apache.org/docs/)."
        data-consent-required="true" 
        data-user-analytics-cookie-enabled="false"
        data-consent-screen-disclaimer="By clicking &quot;I agree, let's chat&quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies."
    ></script>
   
</div>

</div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/arrow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/company/apache-arrow/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/ApacheArrow" title="X" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-x-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">X</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="getting_started.html">Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="build_system.html">Using Arrow C++ in your own project</a></li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/basic_arrow.html">Basic Arrow Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/io_tutorial.html">Arrow File I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/compute_tutorial.html">Arrow Compute</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/datasets_tutorial.html">Arrow Datasets</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="user_guide.html">User Guide</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">High-Level Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="arrays.html">Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="datatypes.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tables.html">Tabular Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute.html">Compute Functions</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="gandiva.html">The Gandiva Expression Compiler</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="gandiva/expr_projector_filter.html">Gandiva Expression, Projector, and Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="gandiva/external_func.html">Gandiva External Functions Development Guide</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="streaming_execution.html">Acero: A C++ streaming execution engine</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="acero/overview.html">Acero Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="acero/user_guide.html">Acero User’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="acero/substrait.html">Using Acero with Substrait</a></li>
<li class="toctree-l3"><a class="reference internal" href="acero/developer_guide.html">Developer’s Guide</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="io.html">Input / output and filesystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipc.html">Reading and writing the Arrow IPC format</a></li>
<li class="toctree-l2"><a class="reference internal" href="orc.html">Reading and Writing ORC files</a></li>
<li class="toctree-l2"><a class="reference internal" href="parquet.html">Reading and writing Parquet files</a></li>
<li class="toctree-l2"><a class="reference internal" href="csv.html">Reading and Writing CSV files</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html">Reading JSON files</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Tabular Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="flight.html">Arrow Flight RPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="gdb.html">Debugging code using Arrow</a></li>
<li class="toctree-l2"><a class="reference internal" href="threading.html">Thread Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="opentelemetry.html">OpenTelemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_vars.html">Environment Variables</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="examples/index.html">Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/cmake_minimal_build.html">Minimal build using CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/compute_and_write_example.html">Compute and Write CSV Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/dataset_documentation_example.html">Arrow Datasets example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/dataset_skyhook_scan_example.html">Arrow Skyhook example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/parquet_column_encryption.html">Parquet column encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/row_columnar_conversion.html">Row to columnar conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/tuple_range_conversion.html">std::tuple-like ranges to Arrow</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/converting_recordbatch_to_tensor.html">Converting RecordBatch to Tensor</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="api/support.html">Programming Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/memory.html">Memory (management)</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/thread.html">Thread (management)</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/datatype.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/array.html">Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/scalar.html">Scalars</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/builder.html">Array Builders</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/table.html">Two-dimensional Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/c_abi.html">C Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/compute.html">Compute Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/acero.html">Streaming Execution (Acero)</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/gandiva.html">Gandiva Expression Compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/tensor.html">Tensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/utilities.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/async.html">Asynchronous programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/io.html">Input / output</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/ipc.html">Arrow IPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/formats.html">File Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/cuda.html">CUDA support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/flight.html">Arrow Flight RPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/flightsql.html">Arrow Flight SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/filesystem.html">Filesystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/dataset.html">Dataset</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference external" href="https://arrow.apache.org/cookbook/cpp/">C++ cookbook</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">C++ Implementation</a></li>
    
    
    <li class="breadcrumb-item"><a href="user_guide.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Tabular Datasets</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="tabular-datasets">
<span id="cpp-dataset"></span><h1>Tabular Datasets<a class="headerlink" href="#tabular-datasets" title="Permalink to this heading">#</a></h1>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="api/dataset.html"><span class="doc">Dataset API reference</span></a></p>
</div>
<p>The Arrow Datasets library provides functionality to efficiently work with
tabular, potentially larger than memory, and multi-file datasets. This includes:</p>
<ul class="simple">
<li><p>A unified interface that supports different sources and file formats and
different file systems (local, cloud).</p></li>
<li><p>Discovery of sources (crawling directories, handling partitioned datasets with
various partitioning schemes, basic schema normalization, …)</p></li>
<li><p>Optimized reading with predicate pushdown (filtering rows), projection
(selecting and deriving columns), and optionally parallel reading.</p></li>
</ul>
<p>The supported file formats currently are Parquet, Feather / Arrow IPC, CSV and
ORC (note that ORC datasets can currently only be read and not yet written).
The goal is to expand support to other file formats and data sources
(e.g. database connections) in the future.</p>
<section id="reading-datasets">
<span id="cpp-dataset-reading"></span><h2>Reading Datasets<a class="headerlink" href="#reading-datasets" title="Permalink to this heading">#</a></h2>
<p>For the examples below, let’s create a small dataset consisting
of a directory with two parquet files:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">49</span><span class="c1">// Generate some data for the rest of this example.</span>
<span class="linenos">50</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">CreateTable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">51</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span>
<span class="linenos">52</span><span class="w">      </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">({</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span>
<span class="linenos">53</span><span class="w">                     </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">())});</span>
<span class="linenos">54</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array_a</span><span class="p">;</span>
<span class="linenos">55</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array_b</span><span class="p">;</span>
<span class="linenos">56</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array_c</span><span class="p">;</span>
<span class="linenos">57</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">NumericBuilder</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Int64Type</span><span class="o">&gt;</span><span class="w"> </span><span class="n">builder</span><span class="p">;</span>
<span class="linenos">58</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">}));</span>
<span class="linenos">59</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array_a</span><span class="p">));</span>
<span class="linenos">60</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">61</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}));</span>
<span class="linenos">62</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array_b</span><span class="p">));</span>
<span class="linenos">63</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">64</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}));</span>
<span class="linenos">65</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array_c</span><span class="p">));</span>
<span class="linenos">66</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">array_a</span><span class="p">,</span><span class="w"> </span><span class="n">array_b</span><span class="p">,</span><span class="w"> </span><span class="n">array_c</span><span class="p">});</span>
<span class="linenos">67</span><span class="p">}</span>
<span class="linenos">68</span>
<span class="linenos">69</span><span class="c1">// Set up a dataset by writing two Parquet files.</span>
<span class="linenos">70</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateExampleParquetDataset</span><span class="p">(</span>
<span class="linenos">71</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">72</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">base_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/parquet_dataset&quot;</span><span class="p">;</span>
<span class="linenos">73</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">CreateDir</span><span class="p">(</span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">74</span><span class="w">  </span><span class="c1">// Create an Arrow Table</span>
<span class="linenos">75</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">CreateTable</span><span class="p">());</span>
<span class="linenos">76</span><span class="w">  </span><span class="c1">// Write it into two Parquet files</span>
<span class="linenos">77</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">output</span><span class="p">,</span>
<span class="linenos">78</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data1.parquet&quot;</span><span class="p">));</span>
<span class="linenos">79</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">parquet</span><span class="o">::</span><span class="n">arrow</span><span class="o">::</span><span class="n">WriteTable</span><span class="p">(</span>
<span class="linenos">80</span><span class="w">      </span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">default_memory_pool</span><span class="p">(),</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="cm">/*chunk_size=*/</span><span class="mi">2048</span><span class="p">));</span>
<span class="linenos">81</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">output</span><span class="p">,</span>
<span class="linenos">82</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data2.parquet&quot;</span><span class="p">));</span>
<span class="linenos">83</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">parquet</span><span class="o">::</span><span class="n">arrow</span><span class="o">::</span><span class="n">WriteTable</span><span class="p">(</span>
<span class="linenos">84</span><span class="w">      </span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">default_memory_pool</span><span class="p">(),</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="cm">/*chunk_size=*/</span><span class="mi">2048</span><span class="p">));</span>
<span class="linenos">85</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">86</span><span class="p">}</span>
</pre></div>
</div>
<p>(See the full example at bottom: <a class="reference internal" href="#cpp-dataset-full-example"><span class="std std-ref">Full Example</span></a>.)</p>
<section id="dataset-discovery">
<h3>Dataset discovery<a class="headerlink" href="#dataset-discovery" title="Permalink to this heading">#</a></h3>
<p>A <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset7DatasetE" title="arrow::dataset::Dataset"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::Dataset</span></code></a> object can be created using the various
<a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset14DatasetFactoryE" title="arrow::dataset::DatasetFactory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::DatasetFactory</span></code></a> objects. Here, we’ll use the
<a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset24FileSystemDatasetFactoryE" title="arrow::dataset::FileSystemDatasetFactory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::FileSystemDatasetFactory</span></code></a>, which can create a dataset
given a base directory path:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">162</span><span class="c1">// Read the whole dataset with the given format, without partitioning.</span>
<span class="linenos">163</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ScanWholeDataset</span><span class="p">(</span>
<span class="linenos">164</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">165</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">166</span><span class="w">  </span><span class="c1">// Create a dataset by scanning the filesystem for files</span>
<span class="hll"><span class="linenos">167</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">168</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">169</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">170</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">171</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
</span><span class="hll"><span class="linenos">172</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
</span><span class="linenos">173</span><span class="w">  </span><span class="c1">// Print out the fragments</span>
<span class="linenos">174</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">fragments</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">GetFragments</span><span class="p">())</span>
<span class="linenos">175</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fragment</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">176</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Found fragment: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fragment</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">177</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">178</span><span class="w">  </span><span class="c1">// Read the entire dataset as a Table</span>
<span class="linenos">179</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">180</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">181</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">182</span><span class="p">}</span>
</pre></div>
</div>
<p>We’re also passing the filesystem to use and the file format to use for reading.
This lets us choose between (for example) reading local files or files in Amazon
S3, or between Parquet and CSV.</p>
<p>In addition to searching a base directory, we can list file paths manually.</p>
<p>Creating a <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset7DatasetE" title="arrow::dataset::Dataset"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::Dataset</span></code></a> does not begin reading the data
itself. It only crawls the directory to find all the files (if needed), which can
be retrieved with <a class="reference internal" href="api/dataset.html#_CPPv4NK5arrow7dataset17FileSystemDataset5filesEv" title="arrow::dataset::FileSystemDataset::files"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">arrow::dataset::FileSystemDataset::files()</span></code></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Print out the files crawled (only for FileSystemDataset)</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">files</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>…and infers the dataset’s schema (by default from the first file):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">schema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>Using the <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset7Dataset7NewScanEv" title="arrow::dataset::Dataset::NewScan"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">arrow::dataset::Dataset::NewScan()</span></code></a> method, we can build a
<a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset7ScannerE" title="arrow::dataset::Scanner"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::Scanner</span></code></a> and read the dataset (or a portion of it) into
a <a class="reference internal" href="api/table.html#_CPPv4N5arrow5TableE" title="arrow::Table"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::Table</span></code></a> with the <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset7Scanner7ToTableEv" title="arrow::dataset::Scanner::ToTable"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">arrow::dataset::Scanner::ToTable()</span></code></a>
method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">162</span><span class="c1">// Read the whole dataset with the given format, without partitioning.</span>
<span class="linenos">163</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ScanWholeDataset</span><span class="p">(</span>
<span class="linenos">164</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">165</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">166</span><span class="w">  </span><span class="c1">// Create a dataset by scanning the filesystem for files</span>
<span class="linenos">167</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">168</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">169</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">170</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">171</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">172</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">173</span><span class="w">  </span><span class="c1">// Print out the fragments</span>
<span class="linenos">174</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">fragments</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">GetFragments</span><span class="p">())</span>
<span class="linenos">175</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fragment</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">176</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Found fragment: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fragment</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="hll"><span class="linenos">177</span><span class="w">  </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">178</span><span class="w">  </span><span class="c1">// Read the entire dataset as a Table</span>
</span><span class="hll"><span class="linenos">179</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
</span><span class="hll"><span class="linenos">180</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
</span><span class="linenos">181</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">182</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depending on the size of your dataset, this can require a lot of
memory; see <a class="reference internal" href="#cpp-dataset-filtering-data"><span class="std std-ref">Filtering data</span></a> below on
filtering/projecting.</p>
</div>
</section>
<section id="reading-different-file-formats">
<h3>Reading different file formats<a class="headerlink" href="#reading-different-file-formats" title="Permalink to this heading">#</a></h3>
<p>The above examples use Parquet files on local disk, but the Dataset API
provides a consistent interface across multiple file formats and filesystems.
(See <a class="reference internal" href="#cpp-dataset-cloud-storage"><span class="std std-ref">Reading from cloud storage</span></a> for more information on the latter.)
Currently, Parquet, ORC, Feather / Arrow IPC, and CSV file formats are
supported; more formats are planned in the future.</p>
<p>If we save the table as Feather files instead of Parquet files:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 90</span><span class="c1">// Set up a dataset by writing two Feather files.</span>
<span class="linenos"> 91</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateExampleFeatherDataset</span><span class="p">(</span>
<span class="linenos"> 92</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 93</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">base_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/feather_dataset&quot;</span><span class="p">;</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">CreateDir</span><span class="p">(</span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos"> 95</span><span class="w">  </span><span class="c1">// Create an Arrow Table</span>
<span class="linenos"> 96</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">CreateTable</span><span class="p">());</span>
<span class="linenos"> 97</span><span class="w">  </span><span class="c1">// Write it into two Feather files</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">output</span><span class="p">,</span>
<span class="linenos"> 99</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data1.feather&quot;</span><span class="p">));</span>
<span class="linenos">100</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">writer</span><span class="p">,</span>
<span class="linenos">101</span><span class="w">                        </span><span class="n">arrow</span><span class="o">::</span><span class="n">ipc</span><span class="o">::</span><span class="n">MakeFileWriter</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">table</span><span class="o">-&gt;</span><span class="n">schema</span><span class="p">()));</span>
<span class="linenos">102</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">WriteTable</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)));</span>
<span class="linenos">103</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">Close</span><span class="p">());</span>
<span class="linenos">104</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">output</span><span class="p">,</span>
<span class="linenos">105</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data2.feather&quot;</span><span class="p">));</span>
<span class="linenos">106</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span>
<span class="linenos">107</span><span class="w">                        </span><span class="n">arrow</span><span class="o">::</span><span class="n">ipc</span><span class="o">::</span><span class="n">MakeFileWriter</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">table</span><span class="o">-&gt;</span><span class="n">schema</span><span class="p">()));</span>
<span class="linenos">108</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">WriteTable</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">5</span><span class="p">)));</span>
<span class="linenos">109</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">Close</span><span class="p">());</span>
<span class="linenos">110</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">111</span><span class="p">}</span>
</pre></div>
</div>
<p>…then we can read the Feather file by passing an <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset13IpcFileFormatE" title="arrow::dataset::IpcFileFormat"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::IpcFileFormat</span></code></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">ParquetFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
<span class="c1">// ...</span>
<span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
<span class="w">                   </span><span class="p">.</span><span class="n">ValueOrDie</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="customizing-file-formats">
<h3>Customizing file formats<a class="headerlink" href="#customizing-file-formats" title="Permalink to this heading">#</a></h3>
<p><a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset10FileFormatE" title="arrow::dataset::FileFormat"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::FileFormat</span></code></a> objects have properties that control how
files are read. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">ParquetFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">format</span><span class="o">-&gt;</span><span class="n">reader_options</span><span class="p">.</span><span class="n">dict_columns</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Will configure column <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> to be dictionary-encoded when read. Similarly,
setting <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset13CsvFileFormat13parse_optionsE" title="arrow::dataset::CsvFileFormat::parse_options"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">arrow::dataset::CsvFileFormat::parse_options</span></code></a> lets us change
things like reading comma-separated or tab-separated data.</p>
<p>Additionally, passing an <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset19FragmentScanOptionsE" title="arrow::dataset::FragmentScanOptions"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::FragmentScanOptions</span></code></a> to
<a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset14ScannerBuilder19FragmentScanOptionsENSt10shared_ptrI19FragmentScanOptionsEE" title="arrow::dataset::ScannerBuilder::FragmentScanOptions"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">arrow::dataset::ScannerBuilder::FragmentScanOptions()</span></code></a> offers fine-grained
control over data scanning. For example, for CSV files, we can change what values
are converted into Boolean true and false at scan time.</p>
</section>
</section>
<section id="filtering-data">
<span id="cpp-dataset-filtering-data"></span><h2>Filtering data<a class="headerlink" href="#filtering-data" title="Permalink to this heading">#</a></h2>
<p>So far, we’ve been reading the entire dataset, but if we need only a subset of the
data, this can waste time or memory reading data we don’t need. The
<a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset7ScannerE" title="arrow::dataset::Scanner"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::Scanner</span></code></a> offers control over what data to read.</p>
<p>In this snippet, we use <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset14ScannerBuilder7ProjectENSt6vectorINSt6stringEEE" title="arrow::dataset::ScannerBuilder::Project"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">arrow::dataset::ScannerBuilder::Project()</span></code></a> to select
which columns to read:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">186</span><span class="c1">// Read a dataset, but select only column &quot;b&quot; and only rows where b &lt; 4.</span>
<span class="linenos">187</span><span class="c1">//</span>
<span class="linenos">188</span><span class="c1">// This is useful when you only want a few columns from a dataset. Where possible,</span>
<span class="linenos">189</span><span class="c1">// Datasets will push down the column selection such that less work is done.</span>
<span class="linenos">190</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">FilterAndSelectDataset</span><span class="p">(</span>
<span class="linenos">191</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">192</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">193</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">194</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">195</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">196</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">197</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">198</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">199</span><span class="w">  </span><span class="c1">// Read specified columns with a row filter</span>
<span class="linenos">200</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="hll"><span class="linenos">201</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Project</span><span class="p">({</span><span class="s">&quot;b&quot;</span><span class="p">}));</span>
</span><span class="linenos">202</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Filter</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">less</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="mi">4</span><span class="p">))));</span>
<span class="linenos">203</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">204</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">205</span><span class="p">}</span>
</pre></div>
</div>
<p>Some formats, such as Parquet, can reduce I/O costs here by reading only the
specified columns from the filesystem.</p>
<p>A filter can be provided with <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset14ScannerBuilder6FilterERKN7compute10ExpressionE" title="arrow::dataset::ScannerBuilder::Filter"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">arrow::dataset::ScannerBuilder::Filter()</span></code></a>, so
that rows which do not match the filter predicate will not be included in the
returned table. Again, some formats, such as Parquet, can use this filter to
reduce the amount of I/O needed.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">186</span><span class="c1">// Read a dataset, but select only column &quot;b&quot; and only rows where b &lt; 4.</span>
<span class="linenos">187</span><span class="c1">//</span>
<span class="linenos">188</span><span class="c1">// This is useful when you only want a few columns from a dataset. Where possible,</span>
<span class="linenos">189</span><span class="c1">// Datasets will push down the column selection such that less work is done.</span>
<span class="linenos">190</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">FilterAndSelectDataset</span><span class="p">(</span>
<span class="linenos">191</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">192</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">193</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">194</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">195</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">196</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">197</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">198</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">199</span><span class="w">  </span><span class="c1">// Read specified columns with a row filter</span>
<span class="linenos">200</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">201</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Project</span><span class="p">({</span><span class="s">&quot;b&quot;</span><span class="p">}));</span>
<span class="hll"><span class="linenos">202</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Filter</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">less</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="mi">4</span><span class="p">))));</span>
</span><span class="linenos">203</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">204</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">205</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="projecting-columns">
<h2>Projecting columns<a class="headerlink" href="#projecting-columns" title="Permalink to this heading">#</a></h2>
<p>In addition to selecting columns, <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset14ScannerBuilder7ProjectENSt6vectorINSt6stringEEE" title="arrow::dataset::ScannerBuilder::Project"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">arrow::dataset::ScannerBuilder::Project()</span></code></a>
can also be used for more complex projections, such as renaming columns, casting
them to other types, and even deriving new columns based on evaluating
expressions.</p>
<p>In this case, we pass a vector of expressions used to construct column values
and a vector of names for the columns:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">209</span><span class="c1">// Read a dataset, but with column projection.</span>
<span class="linenos">210</span><span class="c1">//</span>
<span class="linenos">211</span><span class="c1">// This is useful to derive new columns from existing data. For example, here we</span>
<span class="linenos">212</span><span class="c1">// demonstrate casting a column to a different type, and turning a numeric column into a</span>
<span class="linenos">213</span><span class="c1">// boolean column based on a predicate. You could also rename columns or perform</span>
<span class="linenos">214</span><span class="c1">// computations involving multiple columns.</span>
<span class="linenos">215</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ProjectDataset</span><span class="p">(</span>
<span class="linenos">216</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">217</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">218</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">219</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">220</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">221</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">222</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">223</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">224</span><span class="w">  </span><span class="c1">// Read specified columns with a row filter</span>
<span class="linenos">225</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="hll"><span class="linenos">226</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Project</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">227</span><span class="w">      </span><span class="p">{</span>
</span><span class="hll"><span class="linenos">228</span><span class="w">          </span><span class="c1">// Leave column &quot;a&quot; as-is.</span>
</span><span class="hll"><span class="linenos">229</span><span class="w">          </span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">230</span><span class="w">          </span><span class="c1">// Cast column &quot;b&quot; to float32.</span>
</span><span class="hll"><span class="linenos">231</span><span class="w">          </span><span class="n">cp</span><span class="o">::</span><span class="n">call</span><span class="p">(</span><span class="s">&quot;cast&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)},</span>
</span><span class="hll"><span class="linenos">232</span><span class="w">                   </span><span class="n">arrow</span><span class="o">::</span><span class="n">compute</span><span class="o">::</span><span class="n">CastOptions</span><span class="o">::</span><span class="n">Safe</span><span class="p">(</span><span class="n">arrow</span><span class="o">::</span><span class="n">float32</span><span class="p">())),</span>
</span><span class="hll"><span class="linenos">233</span><span class="w">          </span><span class="c1">// Derive a boolean column from &quot;c&quot;.</span>
</span><span class="hll"><span class="linenos">234</span><span class="w">          </span><span class="n">cp</span><span class="o">::</span><span class="n">equal</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
</span><span class="hll"><span class="linenos">235</span><span class="w">      </span><span class="p">},</span>
</span><span class="hll"><span class="linenos">236</span><span class="w">      </span><span class="p">{</span><span class="s">&quot;a_renamed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b_as_float32&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c_1&quot;</span><span class="p">}));</span>
</span><span class="linenos">237</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">238</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">239</span><span class="p">}</span>
</pre></div>
</div>
<p>This also determines the column selection; only the given columns will be
present in the resulting table. If you want to include a derived column in
<em>addition</em> to the existing columns, you can build up the expressions from the
dataset schema:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">243</span><span class="c1">// Read a dataset, but with column projection.</span>
<span class="linenos">244</span><span class="c1">//</span>
<span class="linenos">245</span><span class="c1">// This time, we read all original columns plus one derived column. This simply combines</span>
<span class="linenos">246</span><span class="c1">// the previous two examples: selecting a subset of columns by name, and deriving new</span>
<span class="linenos">247</span><span class="c1">// columns with an expression.</span>
<span class="linenos">248</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">SelectAndProjectDataset</span><span class="p">(</span>
<span class="linenos">249</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">250</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">251</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">252</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">253</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">254</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">255</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">256</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">257</span><span class="w">  </span><span class="c1">// Read specified columns with a row filter</span>
<span class="linenos">258</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="hll"><span class="linenos">259</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">names</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">260</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cp</span><span class="o">::</span><span class="n">Expression</span><span class="o">&gt;</span><span class="w"> </span><span class="n">exprs</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">261</span><span class="w">  </span><span class="c1">// Read all the original columns.</span>
</span><span class="hll"><span class="linenos">262</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">schema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos">263</span><span class="w">    </span><span class="n">names</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">());</span>
</span><span class="hll"><span class="linenos">264</span><span class="w">    </span><span class="n">exprs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()));</span>
</span><span class="hll"><span class="linenos">265</span><span class="w">  </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">266</span><span class="w">  </span><span class="c1">// Also derive a new column.</span>
</span><span class="hll"><span class="linenos">267</span><span class="w">  </span><span class="n">names</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;b_large&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">268</span><span class="w">  </span><span class="n">exprs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">greater</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
</span><span class="hll"><span class="linenos">269</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Project</span><span class="p">(</span><span class="n">exprs</span><span class="p">,</span><span class="w"> </span><span class="n">names</span><span class="p">));</span>
</span><span class="linenos">270</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">271</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">272</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When combining filters and projections, Arrow will determine all
necessary columns to read. For instance, if you filter on a column that
isn’t ultimately selected, Arrow will still read the column to evaluate
the filter.</p>
</div>
</section>
<section id="reading-and-writing-partitioned-data">
<h2>Reading and writing partitioned data<a class="headerlink" href="#reading-and-writing-partitioned-data" title="Permalink to this heading">#</a></h2>
<p>So far, we’ve been working with datasets consisting of flat directories with
files. Oftentimes, a dataset will have one or more columns that are frequently
filtered on. Instead of having to read and then filter the data, by organizing the
files into a nested directory structure, we can define a partitioned dataset,
where sub-directory names hold information about which subset of the data is
stored in that directory. Then, we can more efficiently filter data by using that
information to avoid loading files that don’t match the filter.</p>
<p>For example, a dataset partitioned by year and month may have the following layout:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>dataset_name/
  year=2007/
    month=01/
       data0.parquet
       data1.parquet
       ...
    month=02/
       data0.parquet
       data1.parquet
       ...
    month=03/
    ...
  year=2008/
    month=01/
    ...
  ...
</pre></div>
</div>
<p>The above partitioning scheme is using “/key=value/” directory names, as found in
Apache Hive. Under this convention, the file at
<code class="docutils literal notranslate"><span class="pre">dataset_name/year=2007/month=01/data0.parquet</span></code> contains only data for which
<code class="docutils literal notranslate"><span class="pre">year</span> <span class="pre">==</span> <span class="pre">2007</span></code> and <code class="docutils literal notranslate"><span class="pre">month</span> <span class="pre">==</span> <span class="pre">01</span></code>.</p>
<p>Let’s create a small partitioned dataset. For this, we’ll use Arrow’s dataset
writing functionality.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">115</span><span class="c1">// Set up a dataset by writing files with partitioning</span>
<span class="linenos">116</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateExampleParquetHivePartitionedDataset</span><span class="p">(</span>
<span class="linenos">117</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">118</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">base_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/parquet_dataset&quot;</span><span class="p">;</span>
<span class="linenos">119</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">CreateDir</span><span class="p">(</span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">120</span><span class="w">  </span><span class="c1">// Create an Arrow Table</span>
<span class="linenos">121</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">(</span>
<span class="linenos">122</span><span class="w">      </span><span class="p">{</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span>
<span class="linenos">123</span><span class="w">       </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">utf8</span><span class="p">())});</span>
<span class="linenos">124</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">arrays</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="linenos">125</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">NumericBuilder</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Int64Type</span><span class="o">&gt;</span><span class="w"> </span><span class="n">builder</span><span class="p">;</span>
<span class="linenos">126</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">}));</span>
<span class="linenos">127</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
<span class="linenos">128</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">129</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}));</span>
<span class="linenos">130</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="linenos">131</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">132</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}));</span>
<span class="linenos">133</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
<span class="linenos">134</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">string_builder</span><span class="p">;</span>
<span class="linenos">135</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span>
<span class="linenos">136</span><span class="w">      </span><span class="n">string_builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">}));</span>
<span class="linenos">137</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">string_builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">3</span><span class="p">]));</span>
<span class="linenos">138</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span><span class="w"> </span><span class="n">arrays</span><span class="p">);</span>
<span class="hll"><span class="linenos">139</span><span class="w">  </span><span class="c1">// Write it using Datasets</span>
</span><span class="hll"><span class="linenos">140</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">InMemoryDataset</span><span class="o">&gt;</span><span class="p">(</span><span class="n">table</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">141</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
</span><span class="hll"><span class="linenos">142</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scanner_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
</span><span class="hll"><span class="linenos">143</span>
</span><span class="hll"><span class="linenos">144</span><span class="w">  </span><span class="c1">// The partition schema determines which fields are part of the partitioning.</span>
</span><span class="hll"><span class="linenos">145</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">partition_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">({</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">utf8</span><span class="p">())});</span>
</span><span class="hll"><span class="linenos">146</span><span class="w">  </span><span class="c1">// We&#39;ll use Hive-style partitioning, which creates directories with &quot;key=value&quot; pairs.</span>
</span><span class="hll"><span class="linenos">147</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">&gt;</span><span class="p">(</span><span class="n">partition_schema</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">148</span><span class="w">  </span><span class="c1">// We&#39;ll write Parquet files.</span>
</span><span class="hll"><span class="linenos">149</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">ParquetFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class="hll"><span class="linenos">150</span><span class="w">  </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetWriteOptions</span><span class="w"> </span><span class="n">write_options</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">151</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">file_write_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="o">-&gt;</span><span class="n">DefaultWriteOptions</span><span class="p">();</span>
</span><span class="hll"><span class="linenos">152</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">filesystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filesystem</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">153</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">154</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partitioning</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">155</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">basename_template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;part{i}.parquet&quot;</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">156</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDataset</span><span class="o">::</span><span class="n">Write</span><span class="p">(</span><span class="n">write_options</span><span class="p">,</span><span class="w"> </span><span class="n">scanner</span><span class="p">));</span>
</span><span class="linenos">157</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">158</span><span class="p">}</span>
</pre></div>
</div>
<p>The above created a directory with two subdirectories (“part=a” and “part=b”),
and the Parquet files written in those directories no longer include the “part”
column.</p>
<p>Reading this dataset, we now specify that the dataset should use a Hive-like
partitioning scheme:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">276</span><span class="c1">// Read an entire dataset, but with partitioning information.</span>
<span class="linenos">277</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ScanPartitionedDataset</span><span class="p">(</span>
<span class="linenos">278</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">279</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">280</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">281</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="hll"><span class="linenos">282</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">recursive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span><span class="c1">// Make sure to search subdirectories</span>
</span><span class="linenos">283</span><span class="w">  </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<span class="hll"><span class="linenos">284</span><span class="w">  </span><span class="c1">// We&#39;ll use Hive-style partitioning. We&#39;ll let Arrow Datasets infer the partition</span>
</span><span class="hll"><span class="linenos">285</span><span class="w">  </span><span class="c1">// schema.</span>
</span><span class="hll"><span class="linenos">286</span><span class="w">  </span><span class="n">options</span><span class="p">.</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">::</span><span class="n">MakeFactory</span><span class="p">();</span>
</span><span class="linenos">287</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span>
<span class="linenos">288</span><span class="w">                                          </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">));</span>
<span class="linenos">289</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">290</span><span class="w">  </span><span class="c1">// Print out the fragments</span>
<span class="linenos">291</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">fragments</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">GetFragments</span><span class="p">());</span>
<span class="linenos">292</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fragment</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">293</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Found fragment: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fragment</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">294</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Partition expression: &quot;</span>
<span class="linenos">295</span><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fragment</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">partition_expression</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">296</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">297</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">298</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">299</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">300</span><span class="p">}</span>
</pre></div>
</div>
<p>Although the partition fields are not included in the actual Parquet files,
they will be added back to the resulting table when scanning this dataset:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ./debug/dataset_documentation_example file:///tmp parquet_hive partitioned
Found fragment: /tmp/parquet_dataset/part=a/part0.parquet
Partition expression: (part == &quot;a&quot;)
Found fragment: /tmp/parquet_dataset/part=b/part1.parquet
Partition expression: (part == &quot;b&quot;)
Read 20 rows
a: int64
  -- field metadata --
  PARQUET:field_id: &#39;1&#39;
b: double
  -- field metadata --
  PARQUET:field_id: &#39;2&#39;
c: int64
  -- field metadata --
  PARQUET:field_id: &#39;3&#39;
part: string
----
# snip...
</pre></div>
</div>
<p>We can now filter on the partition keys, which avoids loading files
altogether if they do not match the filter:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">304</span><span class="c1">// Read an entire dataset, but with partitioning information. Also, filter the dataset on</span>
<span class="linenos">305</span><span class="c1">// the partition values.</span>
<span class="linenos">306</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">FilterPartitionedDataset</span><span class="p">(</span>
<span class="linenos">307</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">308</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">309</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">310</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">311</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">recursive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="linenos">312</span><span class="w">  </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<span class="linenos">313</span><span class="w">  </span><span class="n">options</span><span class="p">.</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">::</span><span class="n">MakeFactory</span><span class="p">();</span>
<span class="linenos">314</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span>
<span class="linenos">315</span><span class="w">                                          </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">));</span>
<span class="linenos">316</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">317</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="hll"><span class="linenos">318</span><span class="w">  </span><span class="c1">// Filter based on the partition values. This will mean that we won&#39;t even read the</span>
</span><span class="hll"><span class="linenos">319</span><span class="w">  </span><span class="c1">// files whose partition expressions don&#39;t match the filter.</span>
</span><span class="hll"><span class="linenos">320</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">321</span><span class="w">      </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Filter</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">equal</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">))));</span>
</span><span class="linenos">322</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">323</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">324</span><span class="p">}</span>
</pre></div>
</div>
<section id="different-partitioning-schemes">
<h3>Different partitioning schemes<a class="headerlink" href="#different-partitioning-schemes" title="Permalink to this heading">#</a></h3>
<p>The above example uses a Hive-like directory scheme, such as “/year=2009/month=11/day=15”.
We specified this by passing the Hive partitioning factory. In this case, the types of
the partition keys are inferred from the file paths.</p>
<p>It is also possible to directly construct the partitioning and explicitly define
the schema of the partition keys. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">({</span>
<span class="w">    </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;year&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int16</span><span class="p">()),</span>
<span class="w">    </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;month&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int8</span><span class="p">()),</span>
<span class="w">    </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;day&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int32</span><span class="p">())</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>Arrow supports another partitioning scheme, “directory partitioning”, where the
segments in the file path represent the values of the partition keys without
including the name (the field names are implicit in the segment’s index). For
example, given field names “year”, “month”, and “day”, one path might be
“/2019/11/15”.</p>
<p>Since the names are not included in the file paths, these must be specified
when constructing a directory partitioning:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">DirectoryPartitioning</span><span class="o">::</span><span class="n">MakeFactory</span><span class="p">({</span><span class="s">&quot;year&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;month&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;day&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p>Directory partitioning also supports providing a full schema rather than inferring
types from file paths.</p>
</section>
<section id="partitioning-performance-considerations">
<h3>Partitioning performance considerations<a class="headerlink" href="#partitioning-performance-considerations" title="Permalink to this heading">#</a></h3>
<p>Partitioning datasets has two aspects that affect performance: it increases the number of
files and it creates a directory structure around the files. Both of these have benefits
as well as costs. Depending on the configuration and the size of your dataset, the costs
can outweigh the benefits.</p>
<p>Because partitions split up the dataset into multiple files, partitioned datasets can be
read and written with parallelism. However, each additional file adds a little overhead in
processing for filesystem interaction. It also increases the overall dataset size since
each file has some shared metadata. For example, each parquet file contains the schema and
group-level statistics. The number of partitions is a floor for the number of files. If
you partition a dataset by date with a year of data, you will have at least 365 files. If
you further partition by another dimension with 1,000 unique values, you will have up to
365,000 files. This fine of partitioning often leads to small files that mostly consist of
metadata.</p>
<p>Partitioned datasets create nested folder structures, and those allow us to prune which
files are loaded in a scan. However, this adds overhead to discovering files in the dataset,
as we’ll need to recursively “list directory” to find the data files. Too fine
partitions can cause problems here: Partitioning a dataset by date for a years worth
of data will require 365 list calls to find all the files; adding another column with
cardinality 1,000 will make that 365,365 calls.</p>
<p>The most optimal partitioning layout will depend on your data, access patterns, and which
systems will be reading the data. Most systems, including Arrow, should work across a
range of file sizes and partitioning layouts, but there are extremes you should avoid. These
guidelines can help avoid some known worst cases:</p>
<ul class="simple">
<li><p>Avoid files smaller than 20MB and larger than 2GB.</p></li>
<li><p>Avoid partitioning layouts with more than 10,000 distinct partitions.</p></li>
</ul>
<p>For file formats that have a notion of groups within a file, such as Parquet, similar
guidelines apply. Row groups can provide parallelism when reading and allow data skipping
based on statistics, but very small groups can cause metadata to be a significant portion
of file size. Arrow’s file writer provides sensible defaults for group sizing in most cases.</p>
</section>
</section>
<section id="reading-from-other-data-sources">
<h2>Reading from other data sources<a class="headerlink" href="#reading-from-other-data-sources" title="Permalink to this heading">#</a></h2>
<section id="reading-in-memory-data">
<h3>Reading in-memory data<a class="headerlink" href="#reading-in-memory-data" title="Permalink to this heading">#</a></h3>
<p>If you already have data in memory that you’d like to use with the Datasets API
(e.g. to filter/project data, or to write it out to a filesystem), you can wrap it
in an <a class="reference internal" href="api/dataset.html#_CPPv4N5arrow7dataset15InMemoryDatasetE" title="arrow::dataset::InMemoryDataset"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">arrow::dataset::InMemoryDataset</span></code></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">::</span><span class="n">FromRecordBatches</span><span class="p">(...);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">dataset</span><span class="o">::</span><span class="n">InMemoryDataset</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">table</span><span class="p">));</span>
<span class="c1">// Scan the dataset, filter, it, etc.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">scanner_builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">();</span>
</pre></div>
</div>
<p>In the example, we used the InMemoryDataset to write our example data to local
disk which was used in the rest of the example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">115</span><span class="c1">// Set up a dataset by writing files with partitioning</span>
<span class="linenos">116</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateExampleParquetHivePartitionedDataset</span><span class="p">(</span>
<span class="linenos">117</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">118</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">base_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/parquet_dataset&quot;</span><span class="p">;</span>
<span class="linenos">119</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">CreateDir</span><span class="p">(</span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">120</span><span class="w">  </span><span class="c1">// Create an Arrow Table</span>
<span class="linenos">121</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">(</span>
<span class="linenos">122</span><span class="w">      </span><span class="p">{</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span>
<span class="linenos">123</span><span class="w">       </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">utf8</span><span class="p">())});</span>
<span class="linenos">124</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">arrays</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="linenos">125</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">NumericBuilder</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Int64Type</span><span class="o">&gt;</span><span class="w"> </span><span class="n">builder</span><span class="p">;</span>
<span class="linenos">126</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">}));</span>
<span class="linenos">127</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
<span class="linenos">128</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">129</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}));</span>
<span class="linenos">130</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="linenos">131</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">132</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}));</span>
<span class="linenos">133</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
<span class="linenos">134</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">string_builder</span><span class="p">;</span>
<span class="linenos">135</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span>
<span class="linenos">136</span><span class="w">      </span><span class="n">string_builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">}));</span>
<span class="linenos">137</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">string_builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">3</span><span class="p">]));</span>
<span class="hll"><span class="linenos">138</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span><span class="w"> </span><span class="n">arrays</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">139</span><span class="w">  </span><span class="c1">// Write it using Datasets</span>
</span><span class="hll"><span class="linenos">140</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">InMemoryDataset</span><span class="o">&gt;</span><span class="p">(</span><span class="n">table</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">141</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
</span><span class="hll"><span class="linenos">142</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scanner_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
</span><span class="linenos">143</span>
<span class="linenos">144</span><span class="w">  </span><span class="c1">// The partition schema determines which fields are part of the partitioning.</span>
<span class="linenos">145</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">partition_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">({</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">utf8</span><span class="p">())});</span>
<span class="linenos">146</span><span class="w">  </span><span class="c1">// We&#39;ll use Hive-style partitioning, which creates directories with &quot;key=value&quot; pairs.</span>
<span class="linenos">147</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">&gt;</span><span class="p">(</span><span class="n">partition_schema</span><span class="p">);</span>
<span class="linenos">148</span><span class="w">  </span><span class="c1">// We&#39;ll write Parquet files.</span>
<span class="linenos">149</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">ParquetFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
<span class="linenos">150</span><span class="w">  </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetWriteOptions</span><span class="w"> </span><span class="n">write_options</span><span class="p">;</span>
<span class="linenos">151</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">file_write_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="o">-&gt;</span><span class="n">DefaultWriteOptions</span><span class="p">();</span>
<span class="linenos">152</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">filesystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filesystem</span><span class="p">;</span>
<span class="linenos">153</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">154</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partitioning</span><span class="p">;</span>
<span class="linenos">155</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">basename_template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;part{i}.parquet&quot;</span><span class="p">;</span>
<span class="linenos">156</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDataset</span><span class="o">::</span><span class="n">Write</span><span class="p">(</span><span class="n">write_options</span><span class="p">,</span><span class="w"> </span><span class="n">scanner</span><span class="p">));</span>
<span class="linenos">157</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">158</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="reading-from-cloud-storage">
<span id="cpp-dataset-cloud-storage"></span><h3>Reading from cloud storage<a class="headerlink" href="#reading-from-cloud-storage" title="Permalink to this heading">#</a></h3>
<p>In addition to local files, Arrow Datasets also support reading from cloud
storage systems, such as Amazon S3, by passing a different filesystem.</p>
<p>See the <a class="reference internal" href="io.html#cpp-filesystems"><span class="std std-ref">filesystem</span></a> docs for more details on the available
filesystems.</p>
</section>
</section>
<section id="a-note-on-transactions-acid-guarantees">
<h2>A note on transactions &amp; ACID guarantees<a class="headerlink" href="#a-note-on-transactions-acid-guarantees" title="Permalink to this heading">#</a></h2>
<p>The dataset API offers no transaction support or any ACID guarantees.  This affects
both reading and writing.  Concurrent reads are fine.  Concurrent writes or writes
concurring with reads may have unexpected behavior.  Various approaches can be used
to avoid operating on the same files such as using a unique basename template for
each writer, a temporary directory for new files, or separate storage of the file
list instead of relying on directory discovery.</p>
<p>Unexpectedly killing the process while a write is in progress can leave the system
in an inconsistent state.  Write calls generally return as soon as the bytes to be
written have been completely delivered to the OS page cache.  Even though a write
operation has been completed it is possible for part of the file to be lost if
there is a sudden power loss immediately after the write call.</p>
<p>Most file formats have magic numbers which are written at the end.  This means a
partial file write can safely be detected and discarded.  The CSV file format does
not have any such concept and a partially written CSV file may be detected as valid.</p>
</section>
<section id="full-example">
<span id="cpp-dataset-full-example"></span><h2>Full Example<a class="headerlink" href="#full-example" title="Permalink to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">// Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="linenos">  2</span><span class="c1">// or more contributor license agreements. See the NOTICE file</span>
<span class="linenos">  3</span><span class="c1">// distributed with this work for additional information</span>
<span class="linenos">  4</span><span class="c1">// regarding copyright ownership. The ASF licenses this file</span>
<span class="linenos">  5</span><span class="c1">// to you under the Apache License, Version 2.0 (the</span>
<span class="linenos">  6</span><span class="c1">// &quot;License&quot;); you may not use this file except in compliance</span>
<span class="linenos">  7</span><span class="c1">// with the License. You may obtain a copy of the License at</span>
<span class="linenos">  8</span><span class="c1">//</span>
<span class="linenos">  9</span><span class="c1">// http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="linenos"> 10</span><span class="c1">//</span>
<span class="linenos"> 11</span><span class="c1">// Unless required by applicable law or agreed to in writing,</span>
<span class="linenos"> 12</span><span class="c1">// software distributed under the License is distributed on an</span>
<span class="linenos"> 13</span><span class="c1">// &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="linenos"> 14</span><span class="c1">// KIND, either express or implied. See the License for the</span>
<span class="linenos"> 15</span><span class="c1">// specific language governing permissions and limitations</span>
<span class="linenos"> 16</span><span class="c1">// under the License.</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1">// This example showcases various ways to work with Datasets. It&#39;s</span>
<span class="linenos"> 19</span><span class="c1">// intended to be paired with the documentation.</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/api.h&gt;</span>
<span class="linenos"> 22</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/compute/cast.h&gt;</span>
<span class="linenos"> 23</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/dataset/dataset.h&gt;</span>
<span class="linenos"> 24</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/dataset/discovery.h&gt;</span>
<span class="linenos"> 25</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/dataset/file_base.h&gt;</span>
<span class="linenos"> 26</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/dataset/file_ipc.h&gt;</span>
<span class="linenos"> 27</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/dataset/file_parquet.h&gt;</span>
<span class="linenos"> 28</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/dataset/scanner.h&gt;</span>
<span class="linenos"> 29</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/filesystem/filesystem.h&gt;</span>
<span class="linenos"> 30</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/ipc/writer.h&gt;</span>
<span class="linenos"> 31</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arrow/util/iterator.h&gt;</span>
<span class="linenos"> 32</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;parquet/arrow/writer.h&gt;</span>
<span class="linenos"> 33</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;arrow/compute/expression.h&quot;</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos"> 36</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span><span class="k">namespace</span><span class="w"> </span><span class="nn">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">arrow</span><span class="o">::</span><span class="nn">dataset</span><span class="p">;</span>
<span class="linenos"> 39</span><span class="k">namespace</span><span class="w"> </span><span class="nn">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">arrow</span><span class="o">::</span><span class="nn">fs</span><span class="p">;</span>
<span class="linenos"> 40</span><span class="k">namespace</span><span class="w"> </span><span class="nn">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">arrow</span><span class="o">::</span><span class="nn">compute</span><span class="p">;</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span><span class="cm">/**</span>
<span class="linenos"> 43</span><span class="cm"> * \brief Run Example</span>
<span class="linenos"> 44</span><span class="cm"> *</span>
<span class="linenos"> 45</span><span class="cm"> * ./debug/dataset-documentation-example file:///&lt;some_path&gt;/&lt;some_directory&gt; parquet</span>
<span class="linenos"> 46</span><span class="cm"> */</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="c1">// (Doc section: Reading Datasets)</span>
<span class="linenos"> 49</span><span class="c1">// Generate some data for the rest of this example.</span>
<span class="linenos"> 50</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">CreateTable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 51</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span>
<span class="linenos"> 52</span><span class="w">      </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">({</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span>
<span class="linenos"> 53</span><span class="w">                     </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">())});</span>
<span class="linenos"> 54</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array_a</span><span class="p">;</span>
<span class="linenos"> 55</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array_b</span><span class="p">;</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array_c</span><span class="p">;</span>
<span class="linenos"> 57</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">NumericBuilder</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Int64Type</span><span class="o">&gt;</span><span class="w"> </span><span class="n">builder</span><span class="p">;</span>
<span class="linenos"> 58</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">}));</span>
<span class="linenos"> 59</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array_a</span><span class="p">));</span>
<span class="linenos"> 60</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos"> 61</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}));</span>
<span class="linenos"> 62</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array_b</span><span class="p">));</span>
<span class="linenos"> 63</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos"> 64</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}));</span>
<span class="linenos"> 65</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array_c</span><span class="p">));</span>
<span class="linenos"> 66</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">array_a</span><span class="p">,</span><span class="w"> </span><span class="n">array_b</span><span class="p">,</span><span class="w"> </span><span class="n">array_c</span><span class="p">});</span>
<span class="linenos"> 67</span><span class="p">}</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="c1">// Set up a dataset by writing two Parquet files.</span>
<span class="linenos"> 70</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateExampleParquetDataset</span><span class="p">(</span>
<span class="linenos"> 71</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 72</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">base_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/parquet_dataset&quot;</span><span class="p">;</span>
<span class="linenos"> 73</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">CreateDir</span><span class="p">(</span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="c1">// Create an Arrow Table</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">CreateTable</span><span class="p">());</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="c1">// Write it into two Parquet files</span>
<span class="linenos"> 77</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">output</span><span class="p">,</span>
<span class="linenos"> 78</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data1.parquet&quot;</span><span class="p">));</span>
<span class="linenos"> 79</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">parquet</span><span class="o">::</span><span class="n">arrow</span><span class="o">::</span><span class="n">WriteTable</span><span class="p">(</span>
<span class="linenos"> 80</span><span class="w">      </span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">default_memory_pool</span><span class="p">(),</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="cm">/*chunk_size=*/</span><span class="mi">2048</span><span class="p">));</span>
<span class="linenos"> 81</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">output</span><span class="p">,</span>
<span class="linenos"> 82</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data2.parquet&quot;</span><span class="p">));</span>
<span class="linenos"> 83</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">parquet</span><span class="o">::</span><span class="n">arrow</span><span class="o">::</span><span class="n">WriteTable</span><span class="p">(</span>
<span class="linenos"> 84</span><span class="w">      </span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">default_memory_pool</span><span class="p">(),</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="cm">/*chunk_size=*/</span><span class="mi">2048</span><span class="p">));</span>
<span class="linenos"> 85</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos"> 86</span><span class="p">}</span>
<span class="linenos"> 87</span><span class="c1">// (Doc section: Reading Datasets)</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span><span class="c1">// (Doc section: Reading different file formats)</span>
<span class="linenos"> 90</span><span class="c1">// Set up a dataset by writing two Feather files.</span>
<span class="linenos"> 91</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateExampleFeatherDataset</span><span class="p">(</span>
<span class="linenos"> 92</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 93</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">base_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/feather_dataset&quot;</span><span class="p">;</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">CreateDir</span><span class="p">(</span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos"> 95</span><span class="w">  </span><span class="c1">// Create an Arrow Table</span>
<span class="linenos"> 96</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">CreateTable</span><span class="p">());</span>
<span class="linenos"> 97</span><span class="w">  </span><span class="c1">// Write it into two Feather files</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">output</span><span class="p">,</span>
<span class="linenos"> 99</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data1.feather&quot;</span><span class="p">));</span>
<span class="linenos">100</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">writer</span><span class="p">,</span>
<span class="linenos">101</span><span class="w">                        </span><span class="n">arrow</span><span class="o">::</span><span class="n">ipc</span><span class="o">::</span><span class="n">MakeFileWriter</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">table</span><span class="o">-&gt;</span><span class="n">schema</span><span class="p">()));</span>
<span class="linenos">102</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">WriteTable</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)));</span>
<span class="linenos">103</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">Close</span><span class="p">());</span>
<span class="linenos">104</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">output</span><span class="p">,</span>
<span class="linenos">105</span><span class="w">                        </span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">OpenOutputStream</span><span class="p">(</span><span class="n">base_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data2.feather&quot;</span><span class="p">));</span>
<span class="linenos">106</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span>
<span class="linenos">107</span><span class="w">                        </span><span class="n">arrow</span><span class="o">::</span><span class="n">ipc</span><span class="o">::</span><span class="n">MakeFileWriter</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">table</span><span class="o">-&gt;</span><span class="n">schema</span><span class="p">()));</span>
<span class="linenos">108</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">WriteTable</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="o">-&gt;</span><span class="n">Slice</span><span class="p">(</span><span class="mi">5</span><span class="p">)));</span>
<span class="linenos">109</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">writer</span><span class="o">-&gt;</span><span class="n">Close</span><span class="p">());</span>
<span class="linenos">110</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">111</span><span class="p">}</span>
<span class="linenos">112</span><span class="c1">// (Doc section: Reading different file formats)</span>
<span class="linenos">113</span>
<span class="linenos">114</span><span class="c1">// (Doc section: Reading and writing partitioned data)</span>
<span class="linenos">115</span><span class="c1">// Set up a dataset by writing files with partitioning</span>
<span class="linenos">116</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateExampleParquetHivePartitionedDataset</span><span class="p">(</span>
<span class="linenos">117</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">118</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">base_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/parquet_dataset&quot;</span><span class="p">;</span>
<span class="linenos">119</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">filesystem</span><span class="o">-&gt;</span><span class="n">CreateDir</span><span class="p">(</span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">120</span><span class="w">  </span><span class="c1">// Create an Arrow Table</span>
<span class="linenos">121</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">(</span>
<span class="linenos">122</span><span class="w">      </span><span class="p">{</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span>
<span class="linenos">123</span><span class="w">       </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">int64</span><span class="p">()),</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">utf8</span><span class="p">())});</span>
<span class="linenos">124</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Array</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">arrays</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="linenos">125</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">NumericBuilder</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Int64Type</span><span class="o">&gt;</span><span class="w"> </span><span class="n">builder</span><span class="p">;</span>
<span class="linenos">126</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">}));</span>
<span class="linenos">127</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
<span class="linenos">128</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">129</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}));</span>
<span class="linenos">130</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="linenos">131</span><span class="w">  </span><span class="n">builder</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="linenos">132</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}));</span>
<span class="linenos">133</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
<span class="linenos">134</span><span class="w">  </span><span class="n">arrow</span><span class="o">::</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">string_builder</span><span class="p">;</span>
<span class="linenos">135</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span>
<span class="linenos">136</span><span class="w">      </span><span class="n">string_builder</span><span class="p">.</span><span class="n">AppendValues</span><span class="p">({</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">}));</span>
<span class="linenos">137</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">string_builder</span><span class="p">.</span><span class="n">Finish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arrays</span><span class="p">[</span><span class="mi">3</span><span class="p">]));</span>
<span class="linenos">138</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span><span class="w"> </span><span class="n">arrays</span><span class="p">);</span>
<span class="linenos">139</span><span class="w">  </span><span class="c1">// Write it using Datasets</span>
<span class="linenos">140</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">InMemoryDataset</span><span class="o">&gt;</span><span class="p">(</span><span class="n">table</span><span class="p">);</span>
<span class="linenos">141</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">142</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scanner_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">143</span>
<span class="linenos">144</span><span class="w">  </span><span class="c1">// The partition schema determines which fields are part of the partitioning.</span>
<span class="linenos">145</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">partition_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">schema</span><span class="p">({</span><span class="n">arrow</span><span class="o">::</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">utf8</span><span class="p">())});</span>
<span class="linenos">146</span><span class="w">  </span><span class="c1">// We&#39;ll use Hive-style partitioning, which creates directories with &quot;key=value&quot; pairs.</span>
<span class="linenos">147</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">&gt;</span><span class="p">(</span><span class="n">partition_schema</span><span class="p">);</span>
<span class="linenos">148</span><span class="w">  </span><span class="c1">// We&#39;ll write Parquet files.</span>
<span class="linenos">149</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">ParquetFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
<span class="linenos">150</span><span class="w">  </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetWriteOptions</span><span class="w"> </span><span class="n">write_options</span><span class="p">;</span>
<span class="linenos">151</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">file_write_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="o">-&gt;</span><span class="n">DefaultWriteOptions</span><span class="p">();</span>
<span class="linenos">152</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">filesystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filesystem</span><span class="p">;</span>
<span class="linenos">153</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">154</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partitioning</span><span class="p">;</span>
<span class="linenos">155</span><span class="w">  </span><span class="n">write_options</span><span class="p">.</span><span class="n">basename_template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;part{i}.parquet&quot;</span><span class="p">;</span>
<span class="linenos">156</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDataset</span><span class="o">::</span><span class="n">Write</span><span class="p">(</span><span class="n">write_options</span><span class="p">,</span><span class="w"> </span><span class="n">scanner</span><span class="p">));</span>
<span class="linenos">157</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">158</span><span class="p">}</span>
<span class="linenos">159</span><span class="c1">// (Doc section: Reading and writing partitioned data)</span>
<span class="linenos">160</span>
<span class="linenos">161</span><span class="c1">// (Doc section: Dataset discovery)</span>
<span class="linenos">162</span><span class="c1">// Read the whole dataset with the given format, without partitioning.</span>
<span class="linenos">163</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ScanWholeDataset</span><span class="p">(</span>
<span class="linenos">164</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">165</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">166</span><span class="w">  </span><span class="c1">// Create a dataset by scanning the filesystem for files</span>
<span class="linenos">167</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">168</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">169</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">170</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">171</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">172</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">173</span><span class="w">  </span><span class="c1">// Print out the fragments</span>
<span class="linenos">174</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">fragments</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">GetFragments</span><span class="p">())</span>
<span class="linenos">175</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fragment</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">176</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Found fragment: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fragment</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">177</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">178</span><span class="w">  </span><span class="c1">// Read the entire dataset as a Table</span>
<span class="linenos">179</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">180</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">181</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">182</span><span class="p">}</span>
<span class="linenos">183</span><span class="c1">// (Doc section: Dataset discovery)</span>
<span class="linenos">184</span>
<span class="linenos">185</span><span class="c1">// (Doc section: Filtering data)</span>
<span class="linenos">186</span><span class="c1">// Read a dataset, but select only column &quot;b&quot; and only rows where b &lt; 4.</span>
<span class="linenos">187</span><span class="c1">//</span>
<span class="linenos">188</span><span class="c1">// This is useful when you only want a few columns from a dataset. Where possible,</span>
<span class="linenos">189</span><span class="c1">// Datasets will push down the column selection such that less work is done.</span>
<span class="linenos">190</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">FilterAndSelectDataset</span><span class="p">(</span>
<span class="linenos">191</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">192</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">193</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">194</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">195</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">196</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">197</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">198</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">199</span><span class="w">  </span><span class="c1">// Read specified columns with a row filter</span>
<span class="linenos">200</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">201</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Project</span><span class="p">({</span><span class="s">&quot;b&quot;</span><span class="p">}));</span>
<span class="linenos">202</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Filter</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">less</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="mi">4</span><span class="p">))));</span>
<span class="linenos">203</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">204</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">205</span><span class="p">}</span>
<span class="linenos">206</span><span class="c1">// (Doc section: Filtering data)</span>
<span class="linenos">207</span>
<span class="linenos">208</span><span class="c1">// (Doc section: Projecting columns)</span>
<span class="linenos">209</span><span class="c1">// Read a dataset, but with column projection.</span>
<span class="linenos">210</span><span class="c1">//</span>
<span class="linenos">211</span><span class="c1">// This is useful to derive new columns from existing data. For example, here we</span>
<span class="linenos">212</span><span class="c1">// demonstrate casting a column to a different type, and turning a numeric column into a</span>
<span class="linenos">213</span><span class="c1">// boolean column based on a predicate. You could also rename columns or perform</span>
<span class="linenos">214</span><span class="c1">// computations involving multiple columns.</span>
<span class="linenos">215</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ProjectDataset</span><span class="p">(</span>
<span class="linenos">216</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">217</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">218</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">219</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">220</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">221</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">222</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">223</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">224</span><span class="w">  </span><span class="c1">// Read specified columns with a row filter</span>
<span class="linenos">225</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">226</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Project</span><span class="p">(</span>
<span class="linenos">227</span><span class="w">      </span><span class="p">{</span>
<span class="linenos">228</span><span class="w">          </span><span class="c1">// Leave column &quot;a&quot; as-is.</span>
<span class="linenos">229</span><span class="w">          </span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">),</span>
<span class="linenos">230</span><span class="w">          </span><span class="c1">// Cast column &quot;b&quot; to float32.</span>
<span class="linenos">231</span><span class="w">          </span><span class="n">cp</span><span class="o">::</span><span class="n">call</span><span class="p">(</span><span class="s">&quot;cast&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)},</span>
<span class="linenos">232</span><span class="w">                   </span><span class="n">arrow</span><span class="o">::</span><span class="n">compute</span><span class="o">::</span><span class="n">CastOptions</span><span class="o">::</span><span class="n">Safe</span><span class="p">(</span><span class="n">arrow</span><span class="o">::</span><span class="n">float32</span><span class="p">())),</span>
<span class="linenos">233</span><span class="w">          </span><span class="c1">// Derive a boolean column from &quot;c&quot;.</span>
<span class="linenos">234</span><span class="w">          </span><span class="n">cp</span><span class="o">::</span><span class="n">equal</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
<span class="linenos">235</span><span class="w">      </span><span class="p">},</span>
<span class="linenos">236</span><span class="w">      </span><span class="p">{</span><span class="s">&quot;a_renamed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b_as_float32&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c_1&quot;</span><span class="p">}));</span>
<span class="linenos">237</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">238</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">239</span><span class="p">}</span>
<span class="linenos">240</span><span class="c1">// (Doc section: Projecting columns)</span>
<span class="linenos">241</span>
<span class="linenos">242</span><span class="c1">// (Doc section: Projecting columns #2)</span>
<span class="linenos">243</span><span class="c1">// Read a dataset, but with column projection.</span>
<span class="linenos">244</span><span class="c1">//</span>
<span class="linenos">245</span><span class="c1">// This time, we read all original columns plus one derived column. This simply combines</span>
<span class="linenos">246</span><span class="c1">// the previous two examples: selecting a subset of columns by name, and deriving new</span>
<span class="linenos">247</span><span class="c1">// columns with an expression.</span>
<span class="linenos">248</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">SelectAndProjectDataset</span><span class="p">(</span>
<span class="linenos">249</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">250</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">251</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">252</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">253</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span>
<span class="linenos">254</span><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span>
<span class="linenos">255</span><span class="w">                                                       </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="p">()));</span>
<span class="linenos">256</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">257</span><span class="w">  </span><span class="c1">// Read specified columns with a row filter</span>
<span class="linenos">258</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">259</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">names</span><span class="p">;</span>
<span class="linenos">260</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cp</span><span class="o">::</span><span class="n">Expression</span><span class="o">&gt;</span><span class="w"> </span><span class="n">exprs</span><span class="p">;</span>
<span class="linenos">261</span><span class="w">  </span><span class="c1">// Read all the original columns.</span>
<span class="linenos">262</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">schema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">263</span><span class="w">    </span><span class="n">names</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">());</span>
<span class="linenos">264</span><span class="w">    </span><span class="n">exprs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()));</span>
<span class="linenos">265</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">266</span><span class="w">  </span><span class="c1">// Also derive a new column.</span>
<span class="linenos">267</span><span class="w">  </span><span class="n">names</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;b_large&quot;</span><span class="p">);</span>
<span class="linenos">268</span><span class="w">  </span><span class="n">exprs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">greater</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
<span class="linenos">269</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Project</span><span class="p">(</span><span class="n">exprs</span><span class="p">,</span><span class="w"> </span><span class="n">names</span><span class="p">));</span>
<span class="linenos">270</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">271</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">272</span><span class="p">}</span>
<span class="linenos">273</span><span class="c1">// (Doc section: Projecting columns #2)</span>
<span class="linenos">274</span>
<span class="linenos">275</span><span class="c1">// (Doc section: Reading and writing partitioned data #2)</span>
<span class="linenos">276</span><span class="c1">// Read an entire dataset, but with partitioning information.</span>
<span class="linenos">277</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ScanPartitionedDataset</span><span class="p">(</span>
<span class="linenos">278</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">279</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">280</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">281</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">282</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">recursive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span><span class="c1">// Make sure to search subdirectories</span>
<span class="linenos">283</span><span class="w">  </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<span class="linenos">284</span><span class="w">  </span><span class="c1">// We&#39;ll use Hive-style partitioning. We&#39;ll let Arrow Datasets infer the partition</span>
<span class="linenos">285</span><span class="w">  </span><span class="c1">// schema.</span>
<span class="linenos">286</span><span class="w">  </span><span class="n">options</span><span class="p">.</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">::</span><span class="n">MakeFactory</span><span class="p">();</span>
<span class="linenos">287</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span>
<span class="linenos">288</span><span class="w">                                          </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">));</span>
<span class="linenos">289</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">290</span><span class="w">  </span><span class="c1">// Print out the fragments</span>
<span class="linenos">291</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">fragments</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">GetFragments</span><span class="p">());</span>
<span class="linenos">292</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fragment</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">293</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Found fragment: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fragment</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">294</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Partition expression: &quot;</span>
<span class="linenos">295</span><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fragment</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">partition_expression</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">296</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">297</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">298</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">299</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">300</span><span class="p">}</span>
<span class="linenos">301</span><span class="c1">// (Doc section: Reading and writing partitioned data #2)</span>
<span class="linenos">302</span>
<span class="linenos">303</span><span class="c1">// (Doc section: Reading and writing partitioned data #3)</span>
<span class="linenos">304</span><span class="c1">// Read an entire dataset, but with partitioning information. Also, filter the dataset on</span>
<span class="linenos">305</span><span class="c1">// the partition values.</span>
<span class="linenos">306</span><span class="n">arrow</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">FilterPartitionedDataset</span><span class="p">(</span>
<span class="linenos">307</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystem</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span>
<span class="linenos">308</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">309</span><span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSelector</span><span class="w"> </span><span class="n">selector</span><span class="p">;</span>
<span class="linenos">310</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_dir</span><span class="p">;</span>
<span class="linenos">311</span><span class="w">  </span><span class="n">selector</span><span class="p">.</span><span class="n">recursive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="linenos">312</span><span class="w">  </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemFactoryOptions</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<span class="linenos">313</span><span class="w">  </span><span class="n">options</span><span class="p">.</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">HivePartitioning</span><span class="o">::</span><span class="n">MakeFactory</span><span class="p">();</span>
<span class="linenos">314</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="o">::</span><span class="n">FileSystemDatasetFactory</span><span class="o">::</span><span class="n">Make</span><span class="p">(</span>
<span class="linenos">315</span><span class="w">                                          </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">));</span>
<span class="linenos">316</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dataset</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">317</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scan_builder</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">-&gt;</span><span class="n">NewScan</span><span class="p">());</span>
<span class="linenos">318</span><span class="w">  </span><span class="c1">// Filter based on the partition values. This will mean that we won&#39;t even read the</span>
<span class="linenos">319</span><span class="w">  </span><span class="c1">// files whose partition expressions don&#39;t match the filter.</span>
<span class="linenos">320</span><span class="w">  </span><span class="n">ARROW_RETURN_NOT_OK</span><span class="p">(</span>
<span class="linenos">321</span><span class="w">      </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Filter</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">equal</span><span class="p">(</span><span class="n">cp</span><span class="o">::</span><span class="n">field_ref</span><span class="p">(</span><span class="s">&quot;part&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">cp</span><span class="o">::</span><span class="n">literal</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">))));</span>
<span class="linenos">322</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">scan_builder</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">());</span>
<span class="linenos">323</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="o">-&gt;</span><span class="n">ToTable</span><span class="p">();</span>
<span class="linenos">324</span><span class="p">}</span>
<span class="linenos">325</span><span class="c1">// (Doc section: Reading and writing partitioned data #3)</span>
<span class="linenos">326</span>
<span class="linenos">327</span><span class="n">arrow</span><span class="o">::</span><span class="n">Status</span><span class="w"> </span><span class="n">RunDatasetDocumentation</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">format_name</span><span class="p">,</span>
<span class="linenos">328</span><span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">329</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">base_path</span><span class="p">;</span>
<span class="linenos">330</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">FileFormat</span><span class="o">&gt;</span><span class="w"> </span><span class="n">format</span><span class="p">;</span>
<span class="linenos">331</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">root_path</span><span class="p">;</span>
<span class="linenos">332</span><span class="w">  </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="o">::</span><span class="n">FileSystemFromUri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">root_path</span><span class="p">));</span>
<span class="linenos">333</span>
<span class="linenos">334</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">format_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;feather&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">335</span><span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">IpcFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
<span class="linenos">336</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span><span class="w"> </span><span class="n">CreateExampleFeatherDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">root_path</span><span class="p">));</span>
<span class="linenos">337</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">format_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;parquet&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">338</span><span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">ParquetFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
<span class="linenos">339</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span><span class="w"> </span><span class="n">CreateExampleParquetDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">root_path</span><span class="p">));</span>
<span class="linenos">340</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">format_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;parquet_hive&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">341</span><span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">::</span><span class="n">ParquetFileFormat</span><span class="o">&gt;</span><span class="p">();</span>
<span class="linenos">342</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span>
<span class="linenos">343</span><span class="w">                          </span><span class="n">CreateExampleParquetHivePartitionedDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">root_path</span><span class="p">));</span>
<span class="linenos">344</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">345</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Unknown format: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">format_name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">346</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Supported formats: feather, parquet, parquet_hive&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">347</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ExecutionError</span><span class="p">(</span><span class="s">&quot;Dataset creating failed.&quot;</span><span class="p">);</span>
<span class="linenos">348</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">349</span>
<span class="linenos">350</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">::</span><span class="n">Table</span><span class="o">&gt;</span><span class="w"> </span><span class="n">table</span><span class="p">;</span>
<span class="linenos">351</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;no_filter&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">352</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">ScanWholeDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">353</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;filter&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">354</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">FilterAndSelectDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">355</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;project&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">356</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">ProjectDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">357</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;select_project&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">358</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">SelectAndProjectDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">359</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;partitioned&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">360</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">ScanPartitionedDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">361</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;filter_partitioned&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">362</span><span class="w">    </span><span class="n">ARROW_ASSIGN_OR_RAISE</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">FilterPartitionedDataset</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">base_path</span><span class="p">));</span>
<span class="linenos">363</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">364</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Unknown mode: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">365</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span>
<span class="linenos">366</span><span class="w">        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Supported modes: no_filter, filter, project, select_project, partitioned&quot;</span>
<span class="linenos">367</span><span class="w">        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">368</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ExecutionError</span><span class="p">(</span><span class="s">&quot;Dataset reading failed.&quot;</span><span class="p">);</span>
<span class="linenos">369</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">370</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Read &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">table</span><span class="o">-&gt;</span><span class="n">num_rows</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; rows&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">371</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">table</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">372</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">arrow</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">OK</span><span class="p">();</span>
<span class="linenos">373</span><span class="p">}</span>
<span class="linenos">374</span>
<span class="linenos">375</span><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">376</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">377</span><span class="w">    </span><span class="c1">// Fake success for CI purposes.</span>
<span class="linenos">378</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="linenos">379</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">380</span>
<span class="linenos">381</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="linenos">382</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">format_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="linenos">383</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;no_filter&quot;</span><span class="p">;</span>
<span class="linenos">384</span>
<span class="linenos">385</span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RunDatasetDocumentation</span><span class="p">(</span><span class="n">format_name</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span>
<span class="linenos">386</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">387</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">388</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<span class="linenos">389</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">390</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="linenos">391</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="json.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Reading JSON files</p>
      </div>
    </a>
    <a class="right-next"
       href="flight.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Arrow Flight RPC</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-datasets">Reading Datasets</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-discovery">Dataset discovery</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-different-file-formats">Reading different file formats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-file-formats">Customizing file formats</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-data">Filtering data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#projecting-columns">Projecting columns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-and-writing-partitioned-data">Reading and writing partitioned data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#different-partitioning-schemes">Different partitioning schemes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-performance-considerations">Partitioning performance considerations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-from-other-data-sources">Reading from other data sources</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-in-memory-data">Reading in-memory data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-from-cloud-storage">Reading from cloud storage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-transactions-acid-guarantees">A note on transactions &amp; ACID guarantees</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-example">Full Example</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow/edit/main/docs/source/cpp/dataset.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2016-2025 Apache Software Foundation.
Apache Arrow, Arrow, Apache, the Apache feather logo, and the Apache Arrow project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>