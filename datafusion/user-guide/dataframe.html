
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>DataFrame API &#8212; Arrow DataFusion  documentation</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Expressions" href="expressions.html" />
    <link rel="prev" title="DataFusion Command-line SQL Utility" href="cli.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items">
<a class="navbar-brand" href="../index.html">
  <img src="../_static/images/DataFusion-Logo-Background-White.png" class="logo" alt="logo">
</a>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  User Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="example-usage.html">
   Example Usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="library.html">
   Using DataFusion as a library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cli.html">
   DataFusion Command-line SQL Utility
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   DataFrame API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="expressions.html">
   Expressions
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="sql/index.html">
   SQL Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/data_types.html">
     Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/select.html">
     SELECT syntax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/subqueries.html">
     Subqueries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/ddl.html">
     DDL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/explain.html">
     EXPLAIN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/information_schema.html">
     Information Schema
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/aggregate_functions.html">
     Aggregate Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/scalar_functions.html">
     Scalar Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sql/sql_status.html">
     Status
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="configs.html">
   Configuration Settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="faq.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://docs.rs/crate/datafusion/">
   Rust Crate Documentation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributor Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../contributor-guide/index.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributor-guide/communication.html">
   Communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributor-guide/roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributor-guide/quarterly_roadmap.html">
   Quarterly Roadmap
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../contributor-guide/specification/index.html">
   Specifications
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../contributor-guide/specification/invariants.html">
     Invariants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../contributor-guide/specification/output-field-name-semantic.html">
     Output field name semantics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow-datafusion/issues">
   Issue tracker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/CODE_OF_CONDUCT.md">
   Code of conduct
  </a>
 </li>
</ul>

    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframe-transformations">
   DataFrame Transformations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframe-actions">
   DataFrame Actions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-dataframe-methods">
   Other DataFrame Methods
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow-datafusion/edit/master/docs/source/user-guide/dataframe.md">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <!---
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->
<section id="dataframe-api">
<h1>DataFrame API<a class="headerlink" href="#dataframe-api" title="Permalink to this heading">Â¶</a></h1>
<p>A DataFrame represents a logical set of rows with the same named columns, similar to a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">Pandas DataFrame</a> or
<a class="reference external" href="https://spark.apache.org/docs/latest/sql-programming-guide.html">Spark DataFrame</a>.</p>
<p>DataFrames are typically created by calling a method on
<code class="docutils literal notranslate"><span class="pre">SessionContext</span></code>, such as <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, and can then be modified
by calling the transformation methods, such as <code class="docutils literal notranslate"><span class="pre">filter</span></code>, <code class="docutils literal notranslate"><span class="pre">select</span></code>, <code class="docutils literal notranslate"><span class="pre">aggregate</span></code>, and <code class="docutils literal notranslate"><span class="pre">limit</span></code>
to build up a query definition.</p>
<p>The query can be executed by calling the <code class="docutils literal notranslate"><span class="pre">collect</span></code> method.</p>
<p>The DataFrame struct is part of DataFusionâs prelude and can be imported with the following statement.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">datafusion</span>::<span class="n">prelude</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Here is a minimal example showing the execution of a query using the DataFrame API.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SessionContext</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&quot;tests/data/example.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CsvReadOptions</span>::<span class="n">new</span><span class="p">()).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">).</span><span class="n">lt_eq</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)))</span><span class="o">?</span><span class="w"></span>
<span class="w">           </span><span class="p">.</span><span class="n">aggregate</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)],</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="n">min</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">))])</span><span class="o">?</span><span class="w"></span>
<span class="w">           </span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Print results</span>
<span class="n">df</span><span class="p">.</span><span class="n">show</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>The DataFrame API is well documented in the <a class="reference external" href="https://docs.rs/datafusion/latest/datafusion/dataframe/struct.DataFrame.html">API reference on docs.rs</a>.</p>
<p>Refer to the <a class="reference internal" href="expressions.html"><span class="doc std std-doc">Expressions Reference</span></a> for available functions for building logical expressions for use with the
DataFrame API.</p>
<section id="dataframe-transformations">
<h2>DataFrame Transformations<a class="headerlink" href="#dataframe-transformations" title="Permalink to this heading">Â¶</a></h2>
<p>These methods create a new DataFrame after applying a transformation to the logical plan that the DataFrame represents.</p>
<p>DataFusion DataFrames use lazy evaluation, meaning that each transformation is just creating a new query plan and
not actually performing any transformations. This approach allows for the overall plan to be optimized before
execution. The plan is evaluated (executed) when an action method is invoked, such as <code class="docutils literal notranslate"><span class="pre">collect</span></code>.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>aggregate</p></td>
<td><p>Perform an aggregate query with optional grouping expressions.</p></td>
</tr>
<tr class="row-odd"><td><p>distinct</p></td>
<td><p>Filter out duplicate rows.</p></td>
</tr>
<tr class="row-even"><td><p>except</p></td>
<td><p>Calculate the exception of two DataFrames. The two DataFrames must have exactly the same schema</p></td>
</tr>
<tr class="row-odd"><td><p>filter</p></td>
<td><p>Filter a DataFrame to only include rows that match the specified filter expression.</p></td>
</tr>
<tr class="row-even"><td><p>intersect</p></td>
<td><p>Calculate the intersection of two DataFrames. The two DataFrames must have exactly the same schema</p></td>
</tr>
<tr class="row-odd"><td><p>join</p></td>
<td><p>Join this DataFrame with another DataFrame using the specified columns as join keys.</p></td>
</tr>
<tr class="row-even"><td><p>limit</p></td>
<td><p>Limit the number of rows returned from this DataFrame.</p></td>
</tr>
<tr class="row-odd"><td><p>repartition</p></td>
<td><p>Repartition a DataFrame based on a logical partitioning scheme.</p></td>
</tr>
<tr class="row-even"><td><p>sort</p></td>
<td><p>Sort the DataFrame by the specified sorting expressions. Any expression can be turned into a sort expression by calling its <code class="docutils literal notranslate"><span class="pre">sort</span></code> method.</p></td>
</tr>
<tr class="row-odd"><td><p>select</p></td>
<td><p>Create a projection based on arbitrary expressions. Example: <code class="docutils literal notranslate"><span class="pre">df..select(vec![col(&quot;c1&quot;),</span> <span class="pre">abs(col(&quot;c2&quot;))])?</span></code></p></td>
</tr>
<tr class="row-even"><td><p>select_columns</p></td>
<td><p>Create a projection based on column names. Example: <code class="docutils literal notranslate"><span class="pre">df.select_columns(&amp;[&quot;id&quot;,</span> <span class="pre">&quot;name&quot;])?</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>union</p></td>
<td><p>Calculate the union of two DataFrames, preserving duplicate rows. The two DataFrames must have exactly the same schema.</p></td>
</tr>
<tr class="row-even"><td><p>union_distinct</p></td>
<td><p>Calculate the distinct union of two DataFrames. The two DataFrames must have exactly the same schema.</p></td>
</tr>
<tr class="row-odd"><td><p>with_column</p></td>
<td><p>Add an additional column to the DataFrame.</p></td>
</tr>
<tr class="row-even"><td><p>with_column_renamed</p></td>
<td><p>Rename one column by applying a new projection.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dataframe-actions">
<h2>DataFrame Actions<a class="headerlink" href="#dataframe-actions" title="Permalink to this heading">Â¶</a></h2>
<p>These methods execute the logical plan represented by the DataFrame and either collects the results into memory, prints them to stdout, or writes them to disk.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>collect</p></td>
<td><p>Executes this DataFrame and collects all results into a vector of RecordBatch.</p></td>
</tr>
<tr class="row-odd"><td><p>collect_partitioned</p></td>
<td><p>Executes this DataFrame and collects all results into a vector of vector of RecordBatch maintaining the input partitioning.</p></td>
</tr>
<tr class="row-even"><td><p>count</p></td>
<td><p>Executes this DataFrame to get the total number of rows.</p></td>
</tr>
<tr class="row-odd"><td><p>execute_stream</p></td>
<td><p>Executes this DataFrame and returns a stream over a single partition.</p></td>
</tr>
<tr class="row-even"><td><p>execute_stream_partitioned</p></td>
<td><p>Executes this DataFrame and returns one stream per partition.</p></td>
</tr>
<tr class="row-odd"><td><p>show</p></td>
<td><p>Execute this DataFrame and print the results to stdout.</p></td>
</tr>
<tr class="row-even"><td><p>show_limit</p></td>
<td><p>Execute this DataFrame and print a subset of results to stdout.</p></td>
</tr>
<tr class="row-odd"><td><p>write_csv</p></td>
<td><p>Execute this DataFrame and write the results to disk in CSV format.</p></td>
</tr>
<tr class="row-even"><td><p>write_json</p></td>
<td><p>Execute this DataFrame and write the results to disk in JSON format.</p></td>
</tr>
<tr class="row-odd"><td><p>write_parquet</p></td>
<td><p>Execute this DataFrame and write the results to disk in Parquet format.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="other-dataframe-methods">
<h2>Other DataFrame Methods<a class="headerlink" href="#other-dataframe-methods" title="Permalink to this heading">Â¶</a></h2>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>explain</p></td>
<td><p>Return a DataFrame with the explanation of its plan so far.</p></td>
</tr>
<tr class="row-odd"><td><p>registry</p></td>
<td><p>Return a <code class="docutils literal notranslate"><span class="pre">FunctionRegistry</span></code> used to plan udfâs calls.</p></td>
</tr>
<tr class="row-even"><td><p>schema</p></td>
<td><p>Returns the schema describing the output of this DataFrame in terms of columns returned, where each column has a name, data type, and nullability attribute.</p></td>
</tr>
<tr class="row-odd"><td><p>to_logical_plan</p></td>
<td><p>Return the optimized logical plan represented by this DataFrame.</p></td>
</tr>
<tr class="row-even"><td><p>to_unoptimized_plan</p></td>
<td><p>Return the unoptimized logical plan represented by this DataFrame.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="cli.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">DataFusion Command-line SQL Utility</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="expressions.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Expressions</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Apache Software Foundation.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>