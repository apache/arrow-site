
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Introduction &#8212; Arrow DataFusion  documentation</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Communication" href="communication.html" />
    <link rel="prev" title="Frequently Asked Questions" href="../user-guide/faq.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items">
<a class="navbar-brand" href="../index.html">
  <img src="../_static/images/DataFusion-Logo-Background-White.png" class="logo" alt="logo">
</a>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  User Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/example-usage.html">
   Example Usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/library.html">
   Using DataFusion as a library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/cli.html">
   DataFusion Command-line SQL Utility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/dataframe.html">
   DataFrame API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/expressions.html">
   Expressions
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../user-guide/sql/index.html">
   SQL Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/data_types.html">
     Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/select.html">
     SELECT syntax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/subqueries.html">
     Subqueries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/ddl.html">
     DDL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/explain.html">
     EXPLAIN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/information_schema.html">
     Information Schema
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/aggregate_functions.html">
     Aggregate Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/scalar_functions.html">
     Scalar Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/sql/sql_status.html">
     Status
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/configs.html">
   Configuration Settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user-guide/faq.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://docs.rs/crate/datafusion/">
   Rust Crate Documentation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributor Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="communication.html">
   Communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="quarterly_roadmap.html">
   Quarterly Roadmap
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="specification/index.html">
   Specifications
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="specification/invariants.html">
     Invariants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="specification/output-field-name-semantic.html">
     Output field name semantics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow-datafusion/issues">
   Issue tracker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/CODE_OF_CONDUCT.md">
   Code of conduct
  </a>
 </li>
</ul>

    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Introduction
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pull-requests">
   Pull Requests
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merging-prs">
     Merging PRs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#developer-s-guide">
   Developer’s guide
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#windows-setup">
     Windows setup
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#protoc-installation">
     Protoc Installation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bootstrap-environment">
     Bootstrap environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-organization">
     Test Organization
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#unit-tests">
       Unit tests
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rust-integration-tests">
       Rust Integration Tests
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sqllogictests-tests">
       sqllogictests Tests
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#benchmarks">
     Benchmarks
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#criterion-benchmarks">
       Criterion Benchmarks
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#parquet-sql-benchmarks">
         Parquet SQL Benchmarks
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#upstream-benchmark-suites">
       Upstream Benchmark Suites
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-add-a-new-scalar-function">
     How to add a new scalar function
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-add-a-new-aggregate-function">
     How to add a new aggregate function
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-display-plans-graphically">
     How to display plans graphically
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specifications">
     Specifications
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-format-md-document">
     How to format
     <code class="docutils literal notranslate">
      <span class="pre">
       .md
      </span>
     </code>
     document
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow-datafusion/edit/master/docs/source/contributor-guide/index.md">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <!---
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>We welcome and encourage contributions of all kinds, such as:</p>
<ol class="arabic simple">
<li><p>Tickets with issue reports of feature requests</p></li>
<li><p>Documentation improvements</p></li>
<li><p>Code (PR or PR Review)</p></li>
</ol>
<p>In addition to submitting new PRs, we have a healthy tradition of community members helping review each other’s PRs. Doing so is a great way to help the community as well as get more familiar with Rust and the relevant codebases.</p>
<p>You can find a curated
<a class="reference external" href="https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22">good-first-issue</a>
list to help you get started.</p>
</section>
<section id="pull-requests">
<h1>Pull Requests<a class="headerlink" href="#pull-requests" title="Permalink to this heading">¶</a></h1>
<p>We welcome pull requests (PRs) from anyone from the community.</p>
<p>DataFusion is a very active fast-moving project and we try to review and merge PRs quickly to keep the review backlog down and the pace up. After review and approval, one of the <a class="reference external" href="https://arrow.apache.org/committers/">many people with commit access</a> will merge your PR.</p>
<p>Review bandwidth is currently our most limited resource, and we highly encourage reviews by the broader community. If you are waiting for your PR to be reviewed, consider helping review other PRs that are waiting. Such review both helps the reviewer to learn the codebase and become more expert, as well as helps identify issues in the PR (such as lack of test coverage), that can be addressed and make future reviews faster and more efficient.</p>
<section id="merging-prs">
<h2>Merging PRs<a class="headerlink" href="#merging-prs" title="Permalink to this heading">¶</a></h2>
<p>Since we are a worldwide community, we have contributors in many timezones who review and comment. To ensure anyone who wishes has an opportunity to review a PR, our committers try to ensure that at least 24 hours passes between when a “major” PR is approved and when it is merged.</p>
<p>A “major” PR means there is a substantial change in design or a change in the API. Committers apply their best judgment to determine what constitutes a substantial change. A “minor” PR might be merged without a 24 hour delay, again subject to the judgment of the committer. Examples of potential “minor” PRs are:</p>
<ol class="arabic simple">
<li><p>Documentation improvements/additions</p></li>
<li><p>Small bug fixes</p></li>
<li><p>Non-controversial build-related changes (clippy, version upgrades etc.)</p></li>
<li><p>Smaller non-controversial feature additions</p></li>
</ol>
</section>
</section>
<section id="developer-s-guide">
<h1>Developer’s guide<a class="headerlink" href="#developer-s-guide" title="Permalink to this heading">¶</a></h1>
<p>This section describes how you can get started at developing DataFusion.</p>
<section id="windows-setup">
<h2>Windows setup<a class="headerlink" href="#windows-setup" title="Permalink to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget https://az792536.vo.msecnd.net/vms/VMBuild_20190311/VirtualBox/MSEdge/MSEdge.Win10.VirtualBox.zip
choco install -y git rustup.install visualcpp-build-tools
git-bash.exe
cargo build
</pre></div>
</div>
</section>
<section id="protoc-installation">
<h2>Protoc Installation<a class="headerlink" href="#protoc-installation" title="Permalink to this heading">¶</a></h2>
<p>Compiling DataFusion from sources requires an installed version of the protobuf compiler, <code class="docutils literal notranslate"><span class="pre">protoc</span></code>.</p>
<p>On most platforms this can be installed from your system’s package manager</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ apt install -y protobuf-compiler
$ dnf install -y protobuf-compiler
$ pacman -S protobuf
$ brew install protobuf
</pre></div>
</div>
<p>You will want to verify the version installed is <code class="docutils literal notranslate"><span class="pre">3.12</span></code> or greater, which introduced support for explicit <a class="reference external" href="https://github.com/protocolbuffers/protobuf/blob/v3.12.0/docs/field_presence.md">field presence</a>. Older versions may fail to compile.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ protoc --version
libprotoc <span class="m">3</span>.12.4
</pre></div>
</div>
<p>Alternatively a binary release can be downloaded from the <a class="reference external" href="https://github.com/protocolbuffers/protobuf/releases">Release Page</a> or <a class="reference external" href="https://github.com/protocolbuffers/protobuf/blob/main/src/README.md">built from source</a>.</p>
</section>
<section id="bootstrap-environment">
<h2>Bootstrap environment<a class="headerlink" href="#bootstrap-environment" title="Permalink to this heading">¶</a></h2>
<p>DataFusion is written in Rust and it uses a standard rust toolkit:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">build</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">fmt</span></code> to format the code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">test</span></code> to test</p></li>
<li><p>etc.</p></li>
</ul>
<p>Testing setup:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rustup</span> <span class="pre">update</span> <span class="pre">stable</span></code> DataFusion uses the latest stable release of rust</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">init</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span></code></p></li>
</ul>
<p>Formatting instructions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/ci/scripts/rust_fmt.sh">ci/scripts/rust_fmt.sh</a></p></li>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/ci/scripts/rust_clippy.sh">ci/scripts/rust_clippy.sh</a></p></li>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/ci/scripts/rust_toml_fmt.sh">ci/scripts/rust_toml_fmt.sh</a></p></li>
</ul>
<p>or run them all at once:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/dev/rust_lint.sh">dev/rust_lint.sh</a></p></li>
</ul>
</section>
<section id="test-organization">
<h2>Test Organization<a class="headerlink" href="#test-organization" title="Permalink to this heading">¶</a></h2>
<p>DataFusion has several levels of tests in its <a class="reference external" href="https://martinfowler.com/articles/practical-test-pyramid.html">Test
Pyramid</a>
and tries to follow <a class="reference external" href="https://doc.rust-lang.org/book/ch11-03-test-organization.html">Testing Organization</a> in the The Book.</p>
<p>This section highlights the most important test modules that exist</p>
<section id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this heading">¶</a></h3>
<p>Tests for the code in an individual module are defined in the same source file with a <code class="docutils literal notranslate"><span class="pre">test</span></code> module, following Rust convention</p>
</section>
<section id="rust-integration-tests">
<h3>Rust Integration Tests<a class="headerlink" href="#rust-integration-tests" title="Permalink to this heading">¶</a></h3>
<p>There are several tests of the public interface of the DataFusion library in the <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/core/tests">tests</a> directory.</p>
<p>You can run these tests individually using a command such as</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cargo <span class="nb">test</span> -p datafusion --tests sql_integration
</pre></div>
</div>
<p>One very important test is the <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/core/tests/sql_integration.rs">sql_integration</a> test which validates DataFusion’s ability to run a large assortment of SQL queries against an assortment of data setups.</p>
</section>
<section id="sqllogictests-tests">
<h3>sqllogictests Tests<a class="headerlink" href="#sqllogictests-tests" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/core/tests/sqllogictests">sqllogictests</a> also validate DataFusion SQL against an assortment of data setups.</p>
<p>Data Driven tests have many benefits including being easier to write and maintain. We are in the process of <a class="reference external" href="https://github.com/apache/arrow-datafusion/issues/4460">migrating sql_integration tests</a> and encourage
you to add new tests using sqllogictests if possible.</p>
</section>
</section>
<section id="benchmarks">
<h2>Benchmarks<a class="headerlink" href="#benchmarks" title="Permalink to this heading">¶</a></h2>
<section id="criterion-benchmarks">
<h3>Criterion Benchmarks<a class="headerlink" href="#criterion-benchmarks" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://docs.rs/criterion/latest/criterion/index.html">Criterion</a> is a statistics-driven micro-benchmarking framework used by DataFusion for evaluating the performance of specific code-paths. In particular, the criterion benchmarks help to both guide optimisation efforts, and prevent performance regressions within DataFusion.</p>
<p>Criterion integrates with Cargo’s built-in <a class="reference external" href="https://doc.rust-lang.org/cargo/commands/cargo-bench.html">benchmark support</a> and a given benchmark can be run with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cargo</span> <span class="n">bench</span> <span class="o">--</span><span class="n">bench</span> <span class="n">BENCHMARK_NAME</span>
</pre></div>
</div>
<p>A full list of benchmarks can be found <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/core/benches">here</a>.</p>
<p><em><a class="reference external" href="https://github.com/bheisler/cargo-criterion">cargo-criterion</a> may also be used for more advanced reporting.</em></p>
<section id="parquet-sql-benchmarks">
<h4>Parquet SQL Benchmarks<a class="headerlink" href="#parquet-sql-benchmarks" title="Permalink to this heading">¶</a></h4>
<p>The parquet SQL benchmarks can be run with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">cargo</span> <span class="n">bench</span> <span class="o">--</span><span class="n">bench</span> <span class="n">parquet_query_sql</span>
</pre></div>
</div>
<p>These randomly generate a parquet file, and then benchmark queries sourced from <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/core/benches/parquet_query_sql.sql">parquet_query_sql.sql</a> against it. This can therefore be a quick way to add coverage of particular query and/or data paths.</p>
<p>If the environment variable <code class="docutils literal notranslate"><span class="pre">PARQUET_FILE</span></code> is set, the benchmark will run queries against this file instead of a randomly generated one. This can be useful for performing multiple runs, potentially with different code, against the same source data, or for testing against a custom dataset.</p>
<p>The benchmark will automatically remove any generated parquet file on exit, however, if interrupted (e.g. by CTRL+C) it will not. This can be useful for analysing the particular file after the fact, or preserving it to use with <code class="docutils literal notranslate"><span class="pre">PARQUET_FILE</span></code> in subsequent runs.</p>
</section>
</section>
<section id="upstream-benchmark-suites">
<h3>Upstream Benchmark Suites<a class="headerlink" href="#upstream-benchmark-suites" title="Permalink to this heading">¶</a></h3>
<p>Instructions and tooling for running upstream benchmark suites against DataFusion can be found in <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/benchmarks">benchmarks</a>.</p>
<p>These are valuable for comparative evaluation against alternative Arrow implementations and query engines.</p>
</section>
</section>
<section id="how-to-add-a-new-scalar-function">
<h2>How to add a new scalar function<a class="headerlink" href="#how-to-add-a-new-scalar-function" title="Permalink to this heading">¶</a></h2>
<p>Below is a checklist of what you need to do to add a new scalar function to DataFusion:</p>
<ul class="simple">
<li><p>Add the actual implementation of the function:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src/string_expressions.rs">here</a> for string functions</p></li>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src/math_expressions.rs">here</a> for math functions</p></li>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src/datetime_expressions.rs">here</a> for datetime functions</p></li>
<li><p>create a new module <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src">here</a> for other functions</p></li>
</ul>
</li>
<li><p>In <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src/functions.rs">physical-expr/src</a>, add:</p>
<ul>
<li><p>a new variant to <code class="docutils literal notranslate"><span class="pre">BuiltinScalarFunction</span></code></p></li>
<li><p>a new entry to <code class="docutils literal notranslate"><span class="pre">FromStr</span></code> with the name of the function as called by SQL</p></li>
<li><p>a new line in <code class="docutils literal notranslate"><span class="pre">return_type</span></code> with the expected return type of the function, given an incoming type</p></li>
<li><p>a new line in <code class="docutils literal notranslate"><span class="pre">signature</span></code> with the signature of the function (number and types of its arguments)</p></li>
<li><p>a new line in <code class="docutils literal notranslate"><span class="pre">create_physical_expr</span></code>/<code class="docutils literal notranslate"><span class="pre">create_physical_fun</span></code> mapping the built-in to the implementation</p></li>
<li><p>tests to the function.</p></li>
</ul>
</li>
<li><p>In <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/core/tests/sql">core/tests/sql</a>, add a new test where the function is called through SQL against well known data and returns the expected result.</p></li>
<li><p>In <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/expr/src/expr_fn.rs">expr/src/expr_fn.rs</a>, add:</p>
<ul>
<li><p>a new entry of the <code class="docutils literal notranslate"><span class="pre">unary_scalar_expr!</span></code> macro for the new function.</p></li>
</ul>
</li>
</ul>
</section>
<section id="how-to-add-a-new-aggregate-function">
<h2>How to add a new aggregate function<a class="headerlink" href="#how-to-add-a-new-aggregate-function" title="Permalink to this heading">¶</a></h2>
<p>Below is a checklist of what you need to do to add a new aggregate function to DataFusion:</p>
<ul class="simple">
<li><p>Add the actual implementation of an <code class="docutils literal notranslate"><span class="pre">Accumulator</span></code> and <code class="docutils literal notranslate"><span class="pre">AggregateExpr</span></code>:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src/string_expressions.rs">here</a> for string functions</p></li>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src/math_expressions.rs">here</a> for math functions</p></li>
<li><p><a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src/datetime_expressions.rs">here</a> for datetime functions</p></li>
<li><p>create a new module <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/physical-expr/src">here</a> for other functions</p></li>
</ul>
</li>
<li><p>In <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/expr/src/aggregate_function.rs">datafusion/expr/src</a>, add:</p>
<ul>
<li><p>a new variant to <code class="docutils literal notranslate"><span class="pre">AggregateFunction</span></code></p></li>
<li><p>a new entry to <code class="docutils literal notranslate"><span class="pre">FromStr</span></code> with the name of the function as called by SQL</p></li>
<li><p>a new line in <code class="docutils literal notranslate"><span class="pre">return_type</span></code> with the expected return type of the function, given an incoming type</p></li>
<li><p>a new line in <code class="docutils literal notranslate"><span class="pre">signature</span></code> with the signature of the function (number and types of its arguments)</p></li>
<li><p>a new line in <code class="docutils literal notranslate"><span class="pre">create_aggregate_expr</span></code> mapping the built-in to the implementation</p></li>
<li><p>tests to the function.</p></li>
</ul>
</li>
<li><p>In <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/master/datafusion/core/tests/sql">tests/sql</a>, add a new test where the function is called through SQL against well known data and returns the expected result.</p></li>
</ul>
</section>
<section id="how-to-display-plans-graphically">
<h2>How to display plans graphically<a class="headerlink" href="#how-to-display-plans-graphically" title="Permalink to this heading">¶</a></h2>
<p>The query plans represented by <code class="docutils literal notranslate"><span class="pre">LogicalPlan</span></code> nodes can be graphically
rendered using <a class="reference external" href="https://www.graphviz.org/">Graphviz</a>.</p>
<p>To do so, save the output of the <code class="docutils literal notranslate"><span class="pre">display_graphviz</span></code> function to a file.:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create plan somehow...</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">create</span><span class="p">(</span><span class="s">&quot;/tmp/plan.dot&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="fm">write!</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plan</span><span class="p">.</span><span class="n">display_graphviz</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
<p>Then, use the <code class="docutils literal notranslate"><span class="pre">dot</span></code> command line tool to render it into a file that
can be displayed. For example, the following command creates a
<code class="docutils literal notranslate"><span class="pre">/tmp/plan.pdf</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dot -Tpdf &lt; /tmp/plan.dot &gt; /tmp/plan.pdf
</pre></div>
</div>
</section>
<section id="specifications">
<h2>Specifications<a class="headerlink" href="#specifications" title="Permalink to this heading">¶</a></h2>
<p>We formalize DataFusion semantics and behaviors through specification
documents. These specifications are useful to be used as references to help
resolve ambiguities during development or code reviews.</p>
<p>You are also welcome to propose changes to existing specifications or create
new specifications as you see fit.</p>
<p>Here is the list current active specifications:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://arrow.apache.org/datafusion/contributor-guide/specification/output-field-name-semantic.html">Output field name semantic</a></p></li>
<li><p><a class="reference external" href="https://arrow.apache.org/datafusion/contributor-guide/specification/invariants.html">Invariants</a></p></li>
</ul>
<p>All specifications are stored in the <code class="docutils literal notranslate"><span class="pre">docs/source/specification</span></code> folder.</p>
</section>
<section id="how-to-format-md-document">
<h2>How to format <code class="docutils literal notranslate"><span class="pre">.md</span></code> document<a class="headerlink" href="#how-to-format-md-document" title="Permalink to this heading">¶</a></h2>
<p>We are using <code class="docutils literal notranslate"><span class="pre">prettier</span></code> to format <code class="docutils literal notranslate"><span class="pre">.md</span></code> files.</p>
<p>You can either use <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">i</span> <span class="pre">-g</span> <span class="pre">prettier</span></code> to install it globally or use <code class="docutils literal notranslate"><span class="pre">npx</span></code> to run it as a standalone binary. Using <code class="docutils literal notranslate"><span class="pre">npx</span></code> required a working node environment. Upgrading to the latest prettier is recommended (by adding <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code> to the <code class="docutils literal notranslate"><span class="pre">npm</span></code> command).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ prettier --version
<span class="m">2</span>.3.0
</pre></div>
</div>
<p>After you’ve confirmed your prettier version, you can format all the <code class="docutils literal notranslate"><span class="pre">.md</span></code> files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>prettier -w <span class="o">{</span>datafusion,datafusion-cli,datafusion-examples,dev,docs<span class="o">}</span>/**/*.md
</pre></div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../user-guide/faq.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Frequently Asked Questions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="communication.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Communication</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Apache Software Foundation.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>